<!DOCTYPE html>  <html> <head>   <title>opentip.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="adapter.ender.html">                 adapter.ender.coffee               </a>                                           <a class="source" href="adapter.jquery.html">                 adapter.jquery.coffee               </a>                                           <a class="source" href="adapter.native.html">                 adapter.native.coffee               </a>                                           <a class="source" href="adapter.prototype.html">                 adapter.prototype.coffee               </a>                                           <a class="source" href="opentip.html">                 opentip.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               opentip.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <h1>#</h1>

<p>More info at <a href="http://www.opentip.org">www.opentip.org</a></p>

<p>Copyright (c) 2012, Matias Meno <br />
Graphics by Tjandra Mayerhold</p>

<p>Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:</p>

<p>The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.</p>

<p>THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.</p>

<h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <h2>Opentip</h2>

<p>Usage:</p>

<pre><code>&lt;div data-ot="This will be viewed in tooltip"&gt;&lt;/div&gt;
</code></pre>

<p>or externally:</p>

<pre><code>new Opentip(element, content, title, options);
</code></pre>

<p>For a full documentation, please visit <a href="http://www.opentip.org">www.opentip.org</a></p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">Opentip</span>

  <span class="nv">STICKS_OUT_TOP: </span><span class="mi">1</span>
  <span class="nv">STICKS_OUT_BOTTOM: </span><span class="mi">2</span>
  <span class="nv">STICKS_OUT_LEFT: </span><span class="mi">1</span>
  <span class="nv">STICKS_OUT_RIGHT: </span><span class="mi">2</span>


  <span class="k">class</span><span class="o">:</span>
    <span class="nv">container: </span><span class="s">&quot;opentip-container&quot;</span>
    <span class="nv">opentip: </span><span class="s">&quot;opentip&quot;</span>
    <span class="nv">content: </span><span class="s">&quot;content&quot;</span>
    <span class="nv">loadingIndicator: </span><span class="s">&quot;loading-indicator&quot;</span>
    <span class="nv">close: </span><span class="s">&quot;close&quot;</span>

    <span class="nv">goingToHide: </span><span class="s">&quot;going-to-hide&quot;</span>
    <span class="nv">hidden: </span><span class="s">&quot;hidden&quot;</span>
    <span class="nv">hiding: </span><span class="s">&quot;hiding&quot;</span>
    <span class="nv">goingToShow: </span><span class="s">&quot;going-to-show&quot;</span>
    <span class="nv">showing: </span><span class="s">&quot;showing&quot;</span>
    <span class="nv">visible: </span><span class="s">&quot;visible&quot;</span>

    <span class="nv">loading: </span><span class="s">&quot;loading&quot;</span>
    <span class="nv">ajaxError: </span><span class="s">&quot;ajax-error&quot;</span>
    <span class="nv">fixed: </span><span class="s">&quot;fixed&quot;</span>
    <span class="nv">showEffectPrefix: </span><span class="s">&quot;show-effect-&quot;</span>
    <span class="nv">hideEffectPrefix: </span><span class="s">&quot;hide-effect-&quot;</span>
    <span class="nv">stylePrefix: </span><span class="s">&quot;style-&quot;</span>
  </pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Sets up and configures the tooltip but does <strong>not</strong> build the html elements.</p>

<p><code>content</code>, <code>title</code> and <code>options</code> are optional but have to be in this order.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">constructor: </span><span class="nf">(element, content, title, options) -&gt;</span>
    <span class="vi">@id = </span><span class="o">++</span><span class="nx">Opentip</span><span class="p">.</span><span class="nx">lastId</span>

    <span class="nx">@debug</span> <span class="s">&quot;Creating Opentip.&quot;</span>

    <span class="vi">@adapter = </span><span class="nx">Opentip</span><span class="p">.</span><span class="nx">adapter</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Add the ID to the element</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">elementsOpentips = </span><span class="nx">@adapter</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="s">&quot;opentips&quot;</span><span class="p">)</span> <span class="o">||</span> <span class="p">[</span> <span class="p">]</span>
    <span class="nx">elementsOpentips</span><span class="p">.</span><span class="nx">push</span> <span class="k">this</span>
    <span class="nx">@adapter</span><span class="p">.</span><span class="nx">data</span> <span class="nx">element</span><span class="p">,</span> <span class="s">&quot;opentips&quot;</span><span class="p">,</span> <span class="nx">elementsOpentips</span>

    <span class="vi">@triggerElement = </span><span class="nx">@adapter</span><span class="p">.</span><span class="nx">wrap</span> <span class="nx">element</span>

    <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span> <span class="s">&quot;You can&#39;t call Opentip on multiple elements.&quot;</span> <span class="k">if</span> <span class="nx">@triggerElement</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span> <span class="s">&quot;Invalid element.&quot;</span> <span class="k">if</span> <span class="nx">@triggerElement</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;</span> <span class="mi">1</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>AJAX</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@loaded = </span><span class="kc">no</span>
    <span class="vi">@loading = </span><span class="kc">no</span>

    <span class="vi">@visible = </span><span class="kc">no</span>
    <span class="vi">@waitingToShow = </span><span class="kc">no</span>
    <span class="vi">@waitingToHide = </span><span class="kc">no</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Some initial values</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@currentPosition = </span><span class="nv">left: </span><span class="mi">0</span><span class="p">,</span> <span class="nv">top: </span><span class="mi">0</span>
    <span class="vi">@dimensions = </span><span class="nv">width: </span><span class="mi">100</span><span class="p">,</span> <span class="nv">height: </span><span class="mi">50</span>

    <span class="vi">@content = </span><span class="s">&quot;&quot;</span>

    <span class="vi">@redraw = </span><span class="kc">on</span>

    <span class="vi">@currentObservers =</span>
      <span class="nv">showing: </span><span class="kc">no</span>
      <span class="nv">visible: </span><span class="kc">no</span>
      <span class="nv">hiding: </span><span class="kc">no</span>
      <span class="nv">hidden: </span><span class="kc">no</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Make sure to not overwrite the users options object</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">options = </span><span class="nx">@adapter</span><span class="p">.</span><span class="nx">clone</span> <span class="nx">options</span>

    <span class="k">if</span> <span class="k">typeof</span> <span class="nx">content</span> <span class="o">==</span> <span class="s">&quot;object&quot;</span>
      <span class="nv">options = </span><span class="nx">content</span>
      <span class="nv">content = title = </span><span class="kc">undefined</span>
    <span class="k">else</span> <span class="k">if</span> <span class="k">typeof</span> <span class="nx">title</span> <span class="o">==</span> <span class="s">&quot;object&quot;</span>
      <span class="nv">options = </span><span class="nx">title</span>
      <span class="nv">title = </span><span class="kc">undefined</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Now build the complete options object from the styles</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">options.title = </span><span class="nx">title</span> <span class="k">if</span> <span class="nx">title</span><span class="o">?</span>
    <span class="nx">@setContent</span> <span class="nx">content</span> <span class="k">if</span> <span class="nx">content</span><span class="o">?</span>

    <span class="nv">options.style = </span><span class="nx">Opentip</span><span class="p">.</span><span class="nx">defaultStyle</span> <span class="nx">unless</span> <span class="nx">options</span><span class="p">.</span><span class="nx">style</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>All options are based on the standard style</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">styleOptions = </span><span class="nx">@adapter</span><span class="p">.</span><span class="nx">extend</span> <span class="p">{</span> <span class="p">},</span> <span class="nx">Opentip</span><span class="p">.</span><span class="nx">styles</span><span class="p">.</span><span class="nx">standard</span>

    <span class="nv">optionSources = </span><span class="p">[</span> <span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>All options are based on the standard style</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">optionSources</span><span class="p">.</span><span class="nx">push</span> <span class="nx">Opentip</span><span class="p">.</span><span class="nx">styles</span><span class="p">.</span><span class="nx">standard</span>
    <span class="nx">optionSources</span><span class="p">.</span><span class="nx">push</span> <span class="nx">Opentip</span><span class="p">.</span><span class="nx">styles</span><span class="p">[</span><span class="nx">options</span><span class="p">.</span><span class="nx">style</span><span class="p">]</span> <span class="nx">unless</span> <span class="nx">options</span><span class="p">.</span><span class="nx">style</span> <span class="o">==</span> <span class="s">&quot;standard&quot;</span>
    <span class="nx">optionSources</span><span class="p">.</span><span class="nx">push</span> <span class="nx">options</span>

    <span class="nv">options = </span><span class="nx">@adapter</span><span class="p">.</span><span class="nx">extend</span> <span class="p">{</span> <span class="p">},</span> <span class="nx">optionSources</span><span class="p">...</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>Deep copying the hideTriggers array</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">options.hideTriggers = </span><span class="p">(</span><span class="nx">hideTrigger</span> <span class="k">for</span> <span class="nx">hideTrigger</span> <span class="k">in</span> <span class="nx">options</span><span class="p">.</span><span class="nx">hideTriggers</span><span class="p">)</span>

    <span class="nx">options</span><span class="p">.</span><span class="nx">hideTriggers</span><span class="p">.</span><span class="nx">push</span> <span class="nx">options</span><span class="p">.</span><span class="nx">hideTrigger</span> <span class="k">if</span> <span class="nx">options</span><span class="p">.</span><span class="nx">hideTrigger</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>Sanitize all positions</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">options</span><span class="p">[</span><span class="nx">prop</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Opentip</span><span class="p">.</span><span class="nx">Joint</span><span class="p">(</span><span class="nx">options</span><span class="p">[</span><span class="nx">prop</span><span class="p">])</span> <span class="k">for</span> <span class="nx">prop</span> <span class="k">in</span> <span class="p">[</span>
      <span class="s">&quot;tipJoint&quot;</span>
      <span class="s">&quot;targetJoint&quot;</span>
      <span class="s">&quot;stem&quot;</span>
    <span class="p">]</span> <span class="k">when</span> <span class="nx">options</span><span class="p">[</span><span class="nx">prop</span><span class="p">]</span> <span class="o">and</span> <span class="k">typeof</span> <span class="nx">options</span><span class="p">[</span><span class="nx">prop</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;string&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>If the url of an Ajax request is not set, get it from the link it's attached to.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">options</span><span class="p">.</span><span class="nx">ajax</span> <span class="o">and</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">ajax</span> <span class="o">==</span> <span class="kc">on</span> <span class="o">or</span> <span class="o">not</span> <span class="nx">options</span><span class="p">.</span><span class="nx">ajax</span><span class="p">)</span>
      <span class="k">if</span> <span class="nx">@adapter</span><span class="p">.</span><span class="nx">tagName</span><span class="p">(</span><span class="nx">@triggerElement</span><span class="p">)</span> <span class="o">==</span> <span class="s">&quot;A&quot;</span>
        <span class="nv">options.ajax = </span><span class="nx">@adapter</span><span class="p">.</span><span class="nx">attr</span> <span class="nx">@triggerElement</span><span class="p">,</span> <span class="s">&quot;href&quot;</span>
      <span class="k">else</span> 
        <span class="nv">options.ajax = </span><span class="kc">off</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>If the event is 'click', no point in following a link</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">options</span><span class="p">.</span><span class="nx">showOn</span> <span class="o">==</span> <span class="s">&quot;click&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">@adapter</span><span class="p">.</span><span class="nx">tagName</span><span class="p">(</span><span class="nx">@triggerElement</span><span class="p">)</span> <span class="o">==</span> <span class="s">&quot;A&quot;</span>
      <span class="nx">@adapter</span><span class="p">.</span><span class="nx">observe</span> <span class="nx">@triggerElement</span><span class="p">,</span> <span class="s">&quot;click&quot;</span><span class="p">,</span> <span class="nf">(e) -&gt;</span>
        <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>
        <span class="nx">e</span><span class="p">.</span><span class="nx">stopPropagation</span><span class="p">()</span>
        <span class="nv">e.stopped = </span><span class="kc">yes</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>Doesn't make sense to use a target without the opentip being fixed</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">options.fixed = </span><span class="kc">yes</span> <span class="k">if</span> <span class="nx">options</span><span class="p">.</span><span class="nx">target</span>

    <span class="nv">options.stem = </span><span class="k">new</span> <span class="nx">Opentip</span><span class="p">.</span><span class="nx">Joint</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">tipJoint</span><span class="p">)</span> <span class="k">if</span> <span class="nx">options</span><span class="p">.</span><span class="nx">stem</span> <span class="o">==</span> <span class="kc">yes</span>

    <span class="k">if</span> <span class="nx">options</span><span class="p">.</span><span class="nx">target</span> <span class="o">==</span> <span class="kc">yes</span>
      <span class="nv">options.target = </span><span class="nx">@triggerElement</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">options</span><span class="p">.</span><span class="nx">target</span>
      <span class="nv">options.target = </span><span class="nx">@adapter</span><span class="p">.</span><span class="nx">wrap</span> <span class="nx">options</span><span class="p">.</span><span class="nx">target</span>

    <span class="vi">@currentStem = </span><span class="nx">options</span><span class="p">.</span><span class="nx">stem</span>

    <span class="nx">unless</span> <span class="nx">options</span><span class="p">.</span><span class="nx">delay</span><span class="o">?</span>
      <span class="nv">options.delay = </span><span class="k">if</span> <span class="nx">options</span><span class="p">.</span><span class="nx">showOn</span> <span class="o">==</span> <span class="s">&quot;mouseover&quot;</span> <span class="k">then</span> <span class="mf">0.2</span> <span class="k">else</span> <span class="mi">0</span>

    <span class="nx">unless</span> <span class="nx">options</span><span class="p">.</span><span class="nx">targetJoint</span><span class="o">?</span>
      <span class="nv">options.targetJoint = </span><span class="k">new</span> <span class="nx">Opentip</span><span class="p">.</span><span class="nx">Joint</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">tipJoint</span><span class="p">).</span><span class="nx">flip</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>Used to show the opentip obviously</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@showTriggersWhenHidden = </span><span class="p">[</span> <span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>Those ensure that opentip doesn't disappear when hovering other related elements</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@showTriggersWhenVisible = </span><span class="p">[</span> <span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>Elements that hide Opentip</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@hideTriggers = </span><span class="p">[</span> <span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>The obvious showTriggerELementWhenHidden is the options.showOn</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">options</span><span class="p">.</span><span class="nx">showOn</span> <span class="o">and</span> <span class="nx">options</span><span class="p">.</span><span class="nx">showOn</span> <span class="o">!=</span> <span class="s">&quot;creation&quot;</span>
      <span class="nx">@showTriggersWhenHidden</span><span class="p">.</span><span class="nx">push</span>
        <span class="nv">element: </span><span class="nx">@triggerElement</span>
        <span class="nv">event: </span><span class="nx">options</span><span class="p">.</span><span class="nx">showOn</span>

    <span class="vi">@options = </span><span class="nx">options</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>Build the HTML elements when the dom is ready.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@adapter</span><span class="p">.</span><span class="nx">domReady</span> <span class="o">=&gt;</span> <span class="nx">@_init</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>Initializes the tooltip by creating the container and setting up the event
listeners.</p>

<p>This does not yet create all elements. They are created when the tooltip
actually shows for the first time.</p>

<p>This function activates the tooltip as well.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">_init: </span><span class="o">-&gt;</span>
    <span class="nx">@_buildContainer</span><span class="p">()</span>

    <span class="k">for</span> <span class="nx">hideTrigger</span><span class="p">,</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">hideTriggers</span>
      <span class="nv">hideTriggerElement = </span><span class="kc">null</span>

      <span class="nv">hideOn = </span><span class="k">if</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">hideOn</span> <span class="k">instanceof</span> <span class="nb">Array</span> <span class="k">then</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">hideOn</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="k">else</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">hideOn</span>

      <span class="k">if</span> <span class="k">typeof</span> <span class="nx">hideTrigger</span> <span class="o">==</span> <span class="s">&quot;string&quot;</span>
        <span class="k">switch</span> <span class="nx">hideTrigger</span>
          <span class="k">when</span> <span class="s">&quot;trigger&quot;</span>
            <span class="nv">hideOn = </span><span class="nx">hideOn</span> <span class="o">||</span> <span class="s">&quot;mouseout&quot;</span>
            <span class="nv">hideTriggerElement = </span><span class="nx">@triggerElement</span>
          <span class="k">when</span> <span class="s">&quot;tip&quot;</span>
            <span class="nv">hideOn = </span><span class="nx">hideOn</span> <span class="o">||</span> <span class="s">&quot;mouseover&quot;</span>
            <span class="nv">hideTriggerElement = </span><span class="nx">@container</span>
          <span class="k">when</span> <span class="s">&quot;target&quot;</span>
            <span class="nv">hideOn = </span><span class="nx">hideOn</span> <span class="o">||</span> <span class="s">&quot;mouseover&quot;</span>
            <span class="nv">hideTriggerElement = </span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">target</span>
          <span class="k">when</span> <span class="s">&quot;closeButton&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>The close button gets handled later</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="k">else</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span> <span class="s">&quot;Unknown hide trigger: </span><span class="si">#{</span><span class="nx">hideTrigger</span><span class="si">}</span><span class="s">.&quot;</span>
      <span class="k">else</span>
        <span class="nv">hideOn = </span><span class="nx">hideOn</span> <span class="o">||</span> <span class="s">&quot;mouseover&quot;</span>
        <span class="nv">hideTriggerElement = </span><span class="nx">@adapter</span><span class="p">.</span><span class="nx">wrap</span> <span class="nx">hideTrigger</span>

      <span class="k">if</span> <span class="nx">hideTriggerElement</span>
        <span class="nx">@hideTriggers</span><span class="p">.</span><span class="nx">push</span>
          <span class="nv">element: </span><span class="nx">hideTriggerElement</span>
          <span class="nv">event: </span><span class="nx">hideOn</span>

        <span class="k">if</span> <span class="nx">hideOn</span> <span class="o">==</span> <span class="s">&quot;mouseout&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>When the hide trigger is mouseout, we have to attach a mouseover
trigger to that element, so the tooltip doesn't disappear when
hovering child elements. (Hovering children fires a mouseout
mouseover event)</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nx">@showTriggersWhenVisible</span><span class="p">.</span><span class="nx">push</span>
            <span class="nv">element: </span><span class="nx">hideTriggerElement</span>
            <span class="nv">event: </span><span class="s">&quot;mouseover&quot;</span>

    <span class="vi">@bound = </span><span class="p">{</span> <span class="p">}</span>
    <span class="nx">@bound</span><span class="p">[</span><span class="nx">methodToBind</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nx">do</span> <span class="p">(</span><span class="nx">methodToBind</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">return</span> <span class="o">=&gt;</span> <span class="nx">@</span><span class="p">[</span><span class="nx">methodToBind</span><span class="p">].</span><span class="nx">apply</span> <span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">)</span> <span class="k">for</span> <span class="nx">methodToBind</span> <span class="k">in</span> <span class="p">[</span>
      <span class="s">&quot;prepareToShow&quot;</span>
      <span class="s">&quot;prepareToHide&quot;</span>
      <span class="s">&quot;show&quot;</span>
      <span class="s">&quot;hide&quot;</span>
      <span class="s">&quot;reposition&quot;</span>
    <span class="p">]</span>

    <span class="nx">@activate</span><span class="p">()</span>

    <span class="nx">@prepareToShow</span><span class="p">()</span> <span class="k">if</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">showOn</span> <span class="o">==</span> <span class="s">&quot;creation&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>This just builds the opentip container, which is the absolute minimum to
attach events to it.</p>

<p>The actual creation of the elements is in buildElements()</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">_buildContainer: </span><span class="o">-&gt;</span>
    <span class="vi">@container = </span><span class="nx">@adapter</span><span class="p">.</span><span class="nx">create</span> <span class="s">&quot;&quot;&quot;&lt;div id=&quot;opentip-</span><span class="si">#{</span><span class="nx">@id</span><span class="si">}</span><span class="s">&quot; class=&quot;</span><span class="si">#{</span><span class="nx">@</span><span class="k">class</span><span class="p">.</span><span class="nx">container</span><span class="si">}</span><span class="s"> </span><span class="si">#{</span><span class="nx">@</span><span class="k">class</span><span class="p">.</span><span class="nx">hidden</span><span class="si">}</span><span class="s"> </span><span class="si">#{</span><span class="nx">@</span><span class="k">class</span><span class="p">.</span><span class="nx">stylePrefix</span><span class="si">}#{</span><span class="nx">@options</span><span class="p">.</span><span class="nx">className</span><span class="si">}</span><span class="s">&quot;&gt;&lt;/div&gt;&quot;&quot;&quot;</span>

    <span class="nx">@adapter</span><span class="p">.</span><span class="nx">css</span> <span class="nx">@container</span><span class="p">,</span> <span class="nv">position: </span><span class="s">&quot;absolute&quot;</span>

    <span class="nx">@adapter</span><span class="p">.</span><span class="nx">addClass</span> <span class="nx">@container</span><span class="p">,</span> <span class="nx">@</span><span class="k">class</span><span class="p">.</span><span class="nx">loading</span> <span class="k">if</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">ajax</span>
    <span class="nx">@adapter</span><span class="p">.</span><span class="nx">addClass</span> <span class="nx">@container</span><span class="p">,</span> <span class="nx">@</span><span class="k">class</span><span class="p">.</span><span class="nx">fixed</span> <span class="k">if</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">fixed</span>
    <span class="nx">@adapter</span><span class="p">.</span><span class="nx">addClass</span> <span class="nx">@container</span><span class="p">,</span> <span class="s">&quot;</span><span class="si">#{</span><span class="nx">@</span><span class="k">class</span><span class="p">.</span><span class="nx">showEffectPrefix</span><span class="si">}#{</span><span class="nx">@options</span><span class="p">.</span><span class="nx">showEffect</span><span class="si">}</span><span class="s">&quot;</span> <span class="k">if</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">showEffect</span>
    <span class="nx">@adapter</span><span class="p">.</span><span class="nx">addClass</span> <span class="nx">@container</span><span class="p">,</span> <span class="s">&quot;</span><span class="si">#{</span><span class="nx">@</span><span class="k">class</span><span class="p">.</span><span class="nx">hideEffectPrefix</span><span class="si">}#{</span><span class="nx">@options</span><span class="p">.</span><span class="nx">hideEffect</span><span class="si">}</span><span class="s">&quot;</span> <span class="k">if</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">hideEffect</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>Builds all elements inside the container and put the container in body.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">_buildElements: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>The actual content will be set by <code>_updateElementContent()</code></p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@tooltipElement = </span><span class="nx">@adapter</span><span class="p">.</span><span class="nx">create</span> <span class="s">&quot;&quot;&quot;&lt;div class=&quot;</span><span class="si">#{</span><span class="nx">@</span><span class="k">class</span><span class="p">.</span><span class="nx">opentip</span><span class="si">}</span><span class="s">&quot;&gt;&lt;header&gt;&lt;/header&gt;&lt;div class=&quot;</span><span class="si">#{</span><span class="nx">@</span><span class="k">class</span><span class="p">.</span><span class="nx">content</span><span class="si">}</span><span class="s">&quot;&gt;&lt;/div&gt;&lt;/div&gt;&quot;&quot;&quot;</span>

    <span class="vi">@backgroundCanvas = </span><span class="nx">@adapter</span><span class="p">.</span><span class="nx">create</span> <span class="s">&quot;&quot;&quot;&lt;canvas style=&quot;position: absolute;&quot;&gt;&lt;/canvas&gt;&quot;&quot;&quot;</span>

    <span class="nv">headerElement = </span><span class="nx">@adapter</span><span class="p">.</span><span class="nx">find</span> <span class="nx">@tooltipElement</span><span class="p">,</span> <span class="s">&quot;header&quot;</span>

    <span class="k">if</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">title</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>Create the title element and append it to the header</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nv">titleElement = </span><span class="nx">@adapter</span><span class="p">.</span><span class="nx">create</span> <span class="s">&quot;&quot;&quot;&lt;h1&gt;&lt;/h1&gt;&quot;&quot;&quot;</span>
      <span class="nx">@adapter</span><span class="p">.</span><span class="nx">update</span> <span class="nx">titleElement</span><span class="p">,</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">title</span><span class="p">,</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">escapeTitle</span>
      <span class="nx">@adapter</span><span class="p">.</span><span class="nx">append</span> <span class="nx">headerElement</span><span class="p">,</span> <span class="nx">titleElement</span>

    <span class="k">if</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">ajax</span>
      <span class="nx">@adapter</span><span class="p">.</span><span class="nx">append</span> <span class="nx">@tooltipElement</span><span class="p">,</span> <span class="nx">@adapter</span><span class="p">.</span><span class="nx">create</span> <span class="s">&quot;&quot;&quot;&lt;div class=&quot;</span><span class="si">#{</span><span class="nx">@</span><span class="k">class</span><span class="p">.</span><span class="nx">loadingIndicator</span><span class="si">}</span><span class="s">&quot;&gt;&lt;span&gt;Loading...&lt;/span&gt;&lt;/div&gt;&quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="s">&quot;closeButton&quot;</span> <span class="k">in</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">hideTriggers</span>
      <span class="vi">@closeButtonElement = </span><span class="nx">@adapter</span><span class="p">.</span><span class="nx">create</span> <span class="s">&quot;&quot;&quot;&lt;a href=&quot;javascript:undefined;&quot; class=&quot;</span><span class="si">#{</span><span class="nx">@</span><span class="k">class</span><span class="p">.</span><span class="nx">close</span><span class="si">}</span><span class="s">&quot;&gt;&lt;span&gt;Close&lt;/span&gt;&lt;/a&gt;&quot;&quot;&quot;</span>
      <span class="nx">@adapter</span><span class="p">.</span><span class="nx">append</span> <span class="nx">headerElement</span><span class="p">,</span> <span class="nx">@closeButtonElement</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>Now put the tooltip and the canvas in the container and the container in the body</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@adapter</span><span class="p">.</span><span class="nx">append</span> <span class="nx">@container</span><span class="p">,</span> <span class="nx">@backgroundCanvas</span>
    <span class="nx">@adapter</span><span class="p">.</span><span class="nx">append</span> <span class="nx">@container</span><span class="p">,</span> <span class="nx">@tooltipElement</span>
    <span class="nx">@adapter</span><span class="p">.</span><span class="nx">append</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">,</span> <span class="nx">@container</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>Sets the content and updates the HTML element if currently visible</p>

<p>This can be a function or a string. The function will be executed, and the
result used as new content of the tooltip.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">setContent: </span><span class="nf">(@content) -&gt;</span> <span class="nx">@_updateElementContent</span><span class="p">()</span> <span class="k">if</span> <span class="nx">@visible</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>Actually updates the content.</p>

<p>If content is a function it is evaluated here.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">_updateElementContent: </span><span class="o">-&gt;</span>
    <span class="nv">contentDiv = </span><span class="nx">@adapter</span><span class="p">.</span><span class="nx">find</span> <span class="nx">@container</span><span class="p">,</span> <span class="s">&quot;.content&quot;</span>

    <span class="k">if</span> <span class="nx">contentDiv</span><span class="o">?</span>
      <span class="k">if</span> <span class="k">typeof</span> <span class="nx">@content</span> <span class="o">==</span> <span class="s">&quot;function&quot;</span>
        <span class="nx">@debug</span> <span class="s">&quot;Executing content function.&quot;</span>
        <span class="vi">@content = </span><span class="nx">@content</span> <span class="k">this</span>
      <span class="nx">@adapter</span><span class="p">.</span><span class="nx">update</span> <span class="nx">contentDiv</span><span class="p">,</span> <span class="nx">@content</span><span class="p">,</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">escapeContent</span>

    <span class="nx">@_storeAndLockDimensions</span><span class="p">()</span>
    <span class="nx">@reposition</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>Sets width auto to the element so it uses the appropriate width, gets the
dimensions and sets them so the tolltip won't change in size (which can be
annoying when the tooltip gets too close to the browser edge)</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">_storeAndLockDimensions: </span><span class="o">-&gt;</span>
    <span class="nv">prevDimension = </span><span class="nx">@dimensions</span>

    <span class="nx">@adapter</span><span class="p">.</span><span class="nx">css</span> <span class="nx">@container</span><span class="p">,</span>
      <span class="nv">width: </span><span class="s">&quot;auto&quot;</span>
      <span class="nv">left: </span><span class="s">&quot;0px&quot;</span> <span class="c1"># So it doesn&#39;t force wrapping</span>
      <span class="nv">top: </span><span class="s">&quot;0px&quot;</span>
    <span class="vi">@dimensions = </span><span class="nx">@adapter</span><span class="p">.</span><span class="nx">dimensions</span> <span class="nx">@container</span>

    <span class="nx">@adapter</span><span class="p">.</span><span class="nx">css</span> <span class="nx">@container</span><span class="p">,</span>
      <span class="nv">width: </span><span class="s">&quot;</span><span class="si">#{</span><span class="nx">@dimensions</span><span class="p">.</span><span class="nx">width</span><span class="si">}</span><span class="s">px&quot;</span>
      <span class="nv">top: </span><span class="s">&quot;</span><span class="si">#{</span><span class="nx">@currentPosition</span><span class="p">.</span><span class="nx">top</span><span class="si">}</span><span class="s">px&quot;</span>
      <span class="nv">left: </span><span class="s">&quot;</span><span class="si">#{</span><span class="nx">@currentPosition</span><span class="p">.</span><span class="nx">left</span><span class="si">}</span><span class="s">px&quot;</span>

    <span class="nx">unless</span> <span class="nx">@_dimensionsEqual</span> <span class="nx">@dimensions</span><span class="p">,</span> <span class="nx">prevDimension</span>
      <span class="vi">@redraw = </span><span class="kc">on</span> 
      <span class="nx">@_draw</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>Sets up appropriate observers</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">activate: </span><span class="o">-&gt;</span>
    <span class="nx">@_setupObservers</span> <span class="s">&quot;-showing&quot;</span><span class="p">,</span> <span class="s">&quot;-visible&quot;</span><span class="p">,</span> <span class="s">&quot;hidden&quot;</span><span class="p">,</span> <span class="s">&quot;hiding&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>Hides the tooltip and sets up appropriate observers</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">deactivate: </span><span class="o">-&gt;</span>
    <span class="nx">@debug</span> <span class="s">&quot;Deactivating tooltip.&quot;</span>
    <span class="nx">@hide</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p>If a state starts with a minus all observers are removed instead of set.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">_setupObservers: </span><span class="nf">(states...) -&gt;</span>
    <span class="k">for</span> <span class="nx">state</span> <span class="k">in</span> <span class="nx">states</span>

      <span class="nv">removeObserver = </span><span class="kc">no</span>
      <span class="k">if</span> <span class="nx">state</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="s">&quot;-&quot;</span>
        <span class="nv">removeObserver = </span><span class="kc">yes</span>
        <span class="nv">state = </span><span class="nx">state</span><span class="p">.</span><span class="nx">substr</span> <span class="mi">1</span> <span class="c1"># Remove leading -</span></pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p>Do nothing if the state is already achieved</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">continue</span> <span class="k">if</span> <span class="nx">@currentObservers</span><span class="p">[</span><span class="nx">state</span><span class="p">]</span> <span class="o">is</span> <span class="o">not</span> <span class="nx">removeObserver</span>
      <span class="nx">@currentObservers</span><span class="p">[</span><span class="nx">state</span><span class="p">]</span> <span class="o">=</span> <span class="o">not</span> <span class="nx">removeObserver</span>

      <span class="nv">observeOrStop = </span><span class="p">(</span><span class="nx">args</span><span class="p">...)</span> <span class="o">=&gt;</span>
        <span class="k">if</span> <span class="nx">removeObserver</span> <span class="k">then</span> <span class="nx">@adapter</span><span class="p">.</span><span class="nx">stopObserving</span> <span class="nx">args</span><span class="p">...</span>
        <span class="k">else</span> <span class="nx">@adapter</span><span class="p">.</span><span class="nx">observe</span> <span class="nx">args</span><span class="p">...</span>

      <span class="k">switch</span> <span class="nx">state</span>
        <span class="k">when</span> <span class="s">&quot;showing&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p>Setup the triggers to hide the tip</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="k">for</span> <span class="nx">trigger</span> <span class="k">in</span> <span class="nx">@hideTriggers</span>
            <span class="nx">observeOrStop</span> <span class="nx">trigger</span><span class="p">.</span><span class="nx">element</span><span class="p">,</span> <span class="nx">trigger</span><span class="p">.</span><span class="nx">event</span><span class="p">,</span> <span class="nx">@bound</span><span class="p">.</span><span class="nx">prepareToHide</span></pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p>Start listening to window changes</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nx">observeOrStop</span> <span class="p">(</span><span class="k">if</span> <span class="nb">document</span><span class="p">.</span><span class="nx">onresize</span><span class="o">?</span> <span class="k">then</span> <span class="nb">document</span> <span class="k">else</span> <span class="nb">window</span><span class="p">),</span> <span class="s">&quot;resize&quot;</span><span class="p">,</span> <span class="nx">@bound</span><span class="p">.</span><span class="nx">reposition</span>
          <span class="nx">observeOrStop</span> <span class="nb">window</span><span class="p">,</span> <span class="s">&quot;scroll&quot;</span><span class="p">,</span> <span class="nx">@bound</span><span class="p">.</span><span class="nx">reposition</span>

        <span class="k">when</span> <span class="s">&quot;visible&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p>Most of the observers have already been handled by "showing"
Add the triggers that make sure opentip doesn't hide prematurely</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="k">for</span> <span class="nx">trigger</span> <span class="k">in</span> <span class="nx">@showTriggersWhenVisible</span>
            <span class="nx">observeOrStop</span> <span class="nx">trigger</span><span class="p">.</span><span class="nx">element</span><span class="p">,</span> <span class="nx">trigger</span><span class="p">.</span><span class="nx">event</span><span class="p">,</span> <span class="nx">@bound</span><span class="p">.</span><span class="nx">prepareToShow</span>

        <span class="k">when</span> <span class="s">&quot;hiding&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p>Setup the triggers to show the tip</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="k">for</span> <span class="nx">trigger</span> <span class="k">in</span> <span class="nx">@showTriggersWhenHidden</span>
            <span class="nx">observeOrStop</span> <span class="nx">trigger</span><span class="p">.</span><span class="nx">element</span><span class="p">,</span> <span class="nx">trigger</span><span class="p">.</span><span class="nx">event</span><span class="p">,</span> <span class="nx">@bound</span><span class="p">.</span><span class="nx">prepareToShow</span>
          
        <span class="k">when</span> <span class="s">&quot;hidden&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <p>Nothing to do since all observers are setup in "hiding"</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">else</span>
          <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span> <span class="s">&quot;Unknown state: </span><span class="si">#{</span><span class="nx">state</span><span class="si">}</span><span class="s">&quot;</span>

    <span class="kc">null</span> <span class="c1"># No unnecessary array collection</span>

  <span class="nv">prepareToShow: </span><span class="o">-&gt;</span>
    <span class="nx">@_abortHiding</span><span class="p">()</span>
    <span class="k">return</span> <span class="k">if</span> <span class="nx">@visible</span>

    <span class="nx">@debug</span> <span class="s">&quot;Showing in </span><span class="si">#{</span><span class="nx">@options</span><span class="p">.</span><span class="nx">delay</span><span class="si">}</span><span class="s">s.&quot;</span>

    <span class="nx">Opentip</span><span class="p">.</span><span class="nx">_abortShowingGroup</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">group</span> <span class="k">if</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">group</span>

    <span class="vi">@preparingToShow = </span><span class="kc">true</span></pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <p>Even though it is not yet visible, I already attach the observers, so the
tooltip won't show if a hideEvent is triggered.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@_setupObservers</span> <span class="s">&quot;-hidden&quot;</span><span class="p">,</span> <span class="s">&quot;-hiding&quot;</span><span class="p">,</span> <span class="s">&quot;showing&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <p>Making sure the tooltip is at the right position as soon as it shows</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@_followMousePosition</span><span class="p">()</span>
    <span class="nx">@reposition</span><span class="p">()</span>

    <span class="vi">@_showTimeoutId = </span><span class="nx">@setTimeout</span> <span class="nx">@bound</span><span class="p">.</span><span class="nx">show</span><span class="p">,</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">delay</span> <span class="o">||</span> <span class="mi">0</span>

  <span class="nv">show: </span><span class="o">-&gt;</span>
    <span class="nx">@_clearTimeouts</span><span class="p">()</span>
    <span class="k">return</span> <span class="k">if</span> <span class="nx">@visible</span>

    <span class="k">return</span> <span class="nx">@deactivate</span><span class="p">()</span> <span class="nx">unless</span> <span class="nx">@_triggerElementExists</span><span class="p">()</span>

    <span class="nx">@debug</span> <span class="s">&quot;Showing now.&quot;</span>

    <span class="nx">Opentip</span><span class="p">.</span><span class="nx">_hideGroup</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">group</span> <span class="k">if</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">group</span>

    <span class="vi">@visible = </span><span class="kc">yes</span>
    <span class="vi">@preparingToShow = </span><span class="kc">no</span>

    <span class="nx">@_buildElements</span><span class="p">()</span> <span class="nx">unless</span> <span class="nx">@tooltipElement</span><span class="o">?</span>
    <span class="nx">@_updateElementContent</span><span class="p">()</span>

    <span class="nx">@_loadAjax</span><span class="p">()</span> <span class="k">if</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">ajax</span> <span class="o">and</span> <span class="p">(</span><span class="o">not</span> <span class="nx">@loaded</span> <span class="o">or</span> <span class="o">not</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">ajaxCache</span><span class="p">)</span>

    <span class="nx">@_searchAndActivateCloseButtons</span><span class="p">()</span>

    <span class="nx">@_startEnsureTriggerElement</span><span class="p">()</span>

    <span class="nx">@adapter</span><span class="p">.</span><span class="nx">css</span> <span class="nx">@container</span><span class="p">,</span> <span class="nv">zIndex: </span><span class="nx">Opentip</span><span class="p">.</span><span class="nx">lastZIndex</span><span class="o">++</span></pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>               <p>The order is important here! Do not reverse.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@_setupObservers</span> <span class="s">&quot;-hidden&quot;</span><span class="p">,</span> <span class="s">&quot;-hiding&quot;</span><span class="p">,</span> <span class="s">&quot;showing&quot;</span><span class="p">,</span> <span class="s">&quot;visible&quot;</span>

    <span class="nx">@reposition</span><span class="p">()</span>

    <span class="nx">@adapter</span><span class="p">.</span><span class="nx">removeClass</span> <span class="nx">@container</span><span class="p">,</span> <span class="nx">@</span><span class="k">class</span><span class="p">.</span><span class="nx">hiding</span>
    <span class="nx">@adapter</span><span class="p">.</span><span class="nx">removeClass</span> <span class="nx">@container</span><span class="p">,</span> <span class="nx">@</span><span class="k">class</span><span class="p">.</span><span class="nx">hidden</span>
    <span class="nx">@adapter</span><span class="p">.</span><span class="nx">addClass</span> <span class="nx">@container</span><span class="p">,</span> <span class="nx">@</span><span class="k">class</span><span class="p">.</span><span class="nx">goingToShow</span>
    <span class="nx">@setCss3Style</span> <span class="nx">@container</span><span class="p">,</span> <span class="nv">transitionDuration: </span><span class="s">&quot;0s&quot;</span>

    <span class="nx">@defer</span> <span class="o">=&gt;</span>
      <span class="nx">@adapter</span><span class="p">.</span><span class="nx">removeClass</span> <span class="nx">@container</span><span class="p">,</span> <span class="nx">@</span><span class="k">class</span><span class="p">.</span><span class="nx">goingToShow</span>
      <span class="nx">@adapter</span><span class="p">.</span><span class="nx">addClass</span> <span class="nx">@container</span><span class="p">,</span> <span class="nx">@</span><span class="k">class</span><span class="p">.</span><span class="nx">showing</span>

      <span class="nv">delay = </span><span class="mi">0</span>
      <span class="nv">delay = </span><span class="nx">@options</span><span class="p">.</span><span class="nx">showEffectDuration</span> <span class="k">if</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">showEffect</span> <span class="o">and</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">showEffectDuration</span>
      <span class="nx">@setCss3Style</span> <span class="nx">@container</span><span class="p">,</span> <span class="nv">transitionDuration: </span><span class="s">&quot;</span><span class="si">#{</span><span class="nx">delay</span><span class="si">}</span><span class="s">s&quot;</span>

      <span class="vi">@_visibilityStateTimeoutId = </span><span class="nx">@setTimeout</span> <span class="o">=&gt;</span>
        <span class="nx">@adapter</span><span class="p">.</span><span class="nx">removeClass</span> <span class="nx">@container</span><span class="p">,</span> <span class="nx">@</span><span class="k">class</span><span class="p">.</span><span class="nx">showing</span>
        <span class="nx">@adapter</span><span class="p">.</span><span class="nx">addClass</span> <span class="nx">@container</span><span class="p">,</span> <span class="nx">@</span><span class="k">class</span><span class="p">.</span><span class="nx">visible</span>
      <span class="p">,</span> <span class="nx">delay</span>

      <span class="nx">@_activateFirstInput</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-44">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>               <p>Just making sure the canvas has been drawn initially.
It could happen that the canvas isn't drawn yet when reposition is called
once before the canvas element has been created. If the position
doesn't change after it will never call @_draw() again.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@_draw</span><span class="p">()</span>

  <span class="nv">_abortShowing: </span><span class="o">-&gt;</span>
    <span class="k">if</span> <span class="nx">@preparingToShow</span>
      <span class="nx">@debug</span> <span class="s">&quot;Aborting showing.&quot;</span>
      <span class="nx">@_clearTimeouts</span><span class="p">()</span>
      <span class="nx">@_stopFollowingMousePosition</span><span class="p">()</span>
      <span class="vi">@preparingToShow = </span><span class="kc">false</span>
      <span class="nx">@_setupObservers</span> <span class="s">&quot;-showing&quot;</span><span class="p">,</span> <span class="s">&quot;-visible&quot;</span><span class="p">,</span> <span class="s">&quot;hiding&quot;</span><span class="p">,</span> <span class="s">&quot;hidden&quot;</span>

  <span class="nv">prepareToHide: </span><span class="o">-&gt;</span>
    <span class="nx">@_abortShowing</span><span class="p">()</span>

    <span class="k">return</span> <span class="nx">unless</span> <span class="nx">@visible</span>

    <span class="nx">@debug</span> <span class="s">&quot;Hiding in </span><span class="si">#{</span><span class="nx">@options</span><span class="p">.</span><span class="nx">hideDelay</span><span class="si">}</span><span class="s">s&quot;</span>

    <span class="vi">@preparingToHide = </span><span class="kc">yes</span></pre></div>             </td>           </tr>                               <tr id="section-45">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>               <p>We start observing even though it is not yet hidden, so the tooltip does
not disappear when a showEvent is triggered.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@_setupObservers</span> <span class="s">&quot;-showing&quot;</span><span class="p">,</span> <span class="s">&quot;-visible&quot;</span><span class="p">,</span> <span class="s">&quot;-hidden&quot;</span><span class="p">,</span> <span class="s">&quot;hiding&quot;</span>

    <span class="vi">@_hideTimeoutId = </span><span class="nx">@setTimeout</span> <span class="nx">@bound</span><span class="p">.</span><span class="nx">hide</span><span class="p">,</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">hideDelay</span>

  <span class="nv">hide: </span><span class="o">-&gt;</span>
    <span class="nx">@_clearTimeouts</span><span class="p">()</span>

    <span class="k">return</span> <span class="nx">unless</span> <span class="nx">@visible</span>

    <span class="nx">@debug</span> <span class="s">&quot;Hiding!&quot;</span>

    <span class="vi">@visible = </span><span class="kc">no</span>

    <span class="vi">@preparingToHide = </span><span class="kc">no</span>

    <span class="nx">@_stopEnsureTriggerElement</span><span class="p">()</span>

    <span class="nx">@_setupObservers</span> <span class="s">&quot;-showing&quot;</span><span class="p">,</span> <span class="s">&quot;-visible&quot;</span><span class="p">,</span> <span class="s">&quot;hiding&quot;</span><span class="p">,</span> <span class="s">&quot;hidden&quot;</span>

    <span class="nx">@_stopFollowingMousePosition</span><span class="p">()</span> <span class="nx">unless</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">fixed</span>

 
    <span class="nx">@adapter</span><span class="p">.</span><span class="nx">removeClass</span> <span class="nx">@container</span><span class="p">,</span> <span class="nx">@</span><span class="k">class</span><span class="p">.</span><span class="nx">visible</span>
    <span class="nx">@adapter</span><span class="p">.</span><span class="nx">removeClass</span> <span class="nx">@container</span><span class="p">,</span> <span class="nx">@</span><span class="k">class</span><span class="p">.</span><span class="nx">showing</span>
    <span class="nx">@adapter</span><span class="p">.</span><span class="nx">addClass</span> <span class="nx">@container</span><span class="p">,</span> <span class="nx">@</span><span class="k">class</span><span class="p">.</span><span class="nx">goingToHide</span>
    <span class="nx">@setCss3Style</span> <span class="nx">@container</span><span class="p">,</span> <span class="nv">transitionDuration: </span><span class="s">&quot;0s&quot;</span>

    <span class="nx">@defer</span> <span class="o">=&gt;</span>
      <span class="nx">@adapter</span><span class="p">.</span><span class="nx">removeClass</span> <span class="nx">@container</span><span class="p">,</span> <span class="nx">@</span><span class="k">class</span><span class="p">.</span><span class="nx">goingToHide</span>
      <span class="nx">@adapter</span><span class="p">.</span><span class="nx">addClass</span> <span class="nx">@container</span><span class="p">,</span> <span class="nx">@</span><span class="k">class</span><span class="p">.</span><span class="nx">hiding</span>

      <span class="nv">hideDelay = </span><span class="mi">0</span>
      <span class="nv">hideDelay = </span><span class="nx">@options</span><span class="p">.</span><span class="nx">hideEffectDuration</span> <span class="k">if</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">hideEffect</span> <span class="o">and</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">hideEffectDuration</span>
      <span class="nx">@setCss3Style</span> <span class="nx">@container</span><span class="p">,</span> <span class="p">{</span> <span class="nv">transitionDuration: </span><span class="s">&quot;</span><span class="si">#{</span><span class="nx">hideDelay</span><span class="si">}</span><span class="s">s&quot;</span> <span class="p">}</span>

      <span class="vi">@_visibilityStateTimeoutId = </span><span class="nx">@setTimeout</span> <span class="o">=&gt;</span>
        <span class="nx">@adapter</span><span class="p">.</span><span class="nx">removeClass</span> <span class="nx">@container</span><span class="p">,</span> <span class="nx">@</span><span class="k">class</span><span class="p">.</span><span class="nx">hiding</span>
        <span class="nx">@adapter</span><span class="p">.</span><span class="nx">addClass</span> <span class="nx">@container</span><span class="p">,</span> <span class="nx">@</span><span class="k">class</span><span class="p">.</span><span class="nx">hidden</span>
        <span class="nx">@setCss3Style</span> <span class="nx">@container</span><span class="p">,</span> <span class="p">{</span> <span class="nv">transitionDuration: </span><span class="s">&quot;0s&quot;</span> <span class="p">}</span>
      <span class="p">,</span> <span class="nx">hideDelay</span>

  <span class="nv">_abortHiding: </span><span class="o">-&gt;</span>
    <span class="k">if</span> <span class="nx">@preparingToHide</span>
      <span class="nx">@debug</span> <span class="s">&quot;Aborting hiding.&quot;</span>
      <span class="nx">@_clearTimeouts</span><span class="p">()</span>
      <span class="vi">@preparingToHide = </span><span class="kc">no</span>
      <span class="nx">@_setupObservers</span> <span class="s">&quot;-hiding&quot;</span><span class="p">,</span> <span class="s">&quot;showing&quot;</span><span class="p">,</span> <span class="s">&quot;visible&quot;</span>

  <span class="nv">reposition: </span><span class="nf">(e) -&gt;</span>
    <span class="nx">e</span> <span class="o">?=</span> <span class="nx">@lastEvent</span>

    <span class="nv">position = </span><span class="nx">@getPosition</span> <span class="nx">e</span>
    <span class="k">return</span> <span class="nx">unless</span> <span class="nx">position</span><span class="o">?</span>

    <span class="p">{</span><span class="nx">position</span><span class="p">,</span> <span class="nx">stem</span><span class="p">}</span> <span class="o">=</span> <span class="nx">@_ensureViewportContainment</span> <span class="nx">e</span><span class="p">,</span> <span class="nx">position</span></pre></div>             </td>           </tr>                               <tr id="section-46">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>               <p>If the position didn't change, no need to do anything    </p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">return</span> <span class="k">if</span> <span class="nx">@_positionsEqual</span> <span class="nx">position</span><span class="p">,</span> <span class="nx">@currentPosition</span></pre></div>             </td>           </tr>                               <tr id="section-47">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-47">&#182;</a>               </div>               <p>The only time the canvas has to bee redrawn is when the stem changes.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@redraw = </span><span class="kc">on</span> <span class="nx">unless</span> <span class="o">!</span><span class="nx">@options</span><span class="p">.</span><span class="nx">stem</span> <span class="o">or</span> <span class="nx">stem</span><span class="p">.</span><span class="nx">eql</span> <span class="nx">@currentStem</span>

    <span class="vi">@currentPosition = </span><span class="nx">position</span>
    <span class="vi">@currentStem = </span><span class="nx">stem</span></pre></div>             </td>           </tr>                               <tr id="section-48">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-48">&#182;</a>               </div>               <p>_draw() itself tests if it has to be redrawn.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@_draw</span><span class="p">()</span>

    <span class="nx">@adapter</span><span class="p">.</span><span class="nx">css</span> <span class="nx">@container</span><span class="p">,</span> <span class="p">{</span> <span class="nv">left: </span><span class="s">&quot;</span><span class="si">#{</span><span class="nx">position</span><span class="p">.</span><span class="nx">left</span><span class="si">}</span><span class="s">px&quot;</span><span class="p">,</span> <span class="nv">top: </span><span class="s">&quot;</span><span class="si">#{</span><span class="nx">position</span><span class="p">.</span><span class="nx">top</span><span class="si">}</span><span class="s">px&quot;</span> <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-49">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-49">&#182;</a>               </div>               <p>Following is a redraw fix, because I noticed some drawing errors in
some browsers when tooltips where overlapping.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@defer</span> <span class="o">=&gt;</span>
      <span class="nv">rawContainer = </span><span class="nx">@adapter</span><span class="p">.</span><span class="nx">unwrap</span> <span class="nx">@container</span></pre></div>             </td>           </tr>                               <tr id="section-50">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-50">&#182;</a>               </div>               <p>I chose visibility instead of display so that I don't interfere with
appear/disappear effects.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nv">rawContainer.style.visibility = </span><span class="s">&quot;hidden&quot;</span>
      <span class="nv">redrawFix = </span><span class="nx">rawContainer</span><span class="p">.</span><span class="nx">offsetHeight</span>
      <span class="nv">rawContainer.style.visibility = </span><span class="s">&quot;visible&quot;</span>


  <span class="nv">getPosition: </span><span class="nf">(e, tipJoint, targetJoint, stem) -&gt;</span>

    <span class="nx">tipJoint</span> <span class="o">?=</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">tipJoint</span>
    <span class="nx">targetJoint</span> <span class="o">?=</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">targetJoint</span>

    <span class="nv">position = </span><span class="p">{</span> <span class="p">}</span>

    <span class="k">if</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">target</span></pre></div>             </td>           </tr>                               <tr id="section-51">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-51">&#182;</a>               </div>               <p>Position is fixed</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nv">targetPosition = </span><span class="nx">@adapter</span><span class="p">.</span><span class="nx">offset</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">target</span>
      <span class="nv">targetDimensions = </span><span class="nx">@adapter</span><span class="p">.</span><span class="nx">dimensions</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">target</span>

      <span class="nv">position = </span><span class="nx">targetPosition</span>

      <span class="k">if</span> <span class="nx">targetJoint</span><span class="p">.</span><span class="nx">right</span></pre></div>             </td>           </tr>                               <tr id="section-52">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-52">&#182;</a>               </div>               <p>For wrapping inline elements, left + width does not give the right
border, because left is where the element started, not its most left
position.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nv">unwrappedTarget = </span><span class="nx">@adapter</span><span class="p">.</span><span class="nx">unwrap</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">target</span>
        <span class="k">if</span> <span class="nx">unwrappedTarget</span><span class="p">.</span><span class="nx">getBoundingClientRect</span><span class="o">?</span></pre></div>             </td>           </tr>                               <tr id="section-53">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-53">&#182;</a>               </div>               <p>TODO: make sure this actually works.</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nv">position.left = </span><span class="nx">unwrappedTarget</span><span class="p">.</span><span class="nx">getBoundingClientRect</span><span class="p">().</span><span class="nx">right</span> <span class="o">+</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">pageXOffset</span> <span class="o">?</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">scrollLeft</span><span class="p">)</span>
        <span class="k">else</span></pre></div>             </td>           </tr>                               <tr id="section-54">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-54">&#182;</a>               </div>               <p>Well... browser doesn't support it</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nx">position</span><span class="p">.</span><span class="nx">left</span> <span class="o">+=</span> <span class="nx">targetDimensions</span><span class="p">.</span><span class="nx">width</span>
      <span class="k">else</span> <span class="k">if</span> <span class="nx">targetJoint</span><span class="p">.</span><span class="nx">center</span></pre></div>             </td>           </tr>                               <tr id="section-55">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-55">&#182;</a>               </div>               <p>Center</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">position</span><span class="p">.</span><span class="nx">left</span> <span class="o">+=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span> <span class="nx">targetDimensions</span><span class="p">.</span><span class="nx">width</span> <span class="o">/</span> <span class="mi">2</span>

      <span class="k">if</span> <span class="nx">targetJoint</span><span class="p">.</span><span class="nx">bottom</span>
        <span class="nx">position</span><span class="p">.</span><span class="nx">top</span> <span class="o">+=</span> <span class="nx">targetDimensions</span><span class="p">.</span><span class="nx">height</span>
      <span class="k">else</span> <span class="k">if</span> <span class="nx">targetJoint</span><span class="p">.</span><span class="nx">middle</span></pre></div>             </td>           </tr>                               <tr id="section-56">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-56">&#182;</a>               </div>               <p>Middle</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">position</span><span class="p">.</span><span class="nx">top</span> <span class="o">+=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span> <span class="nx">targetDimensions</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="mi">2</span>

      <span class="k">if</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">borderWidth</span>
        <span class="k">if</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">tipJoint</span><span class="p">.</span><span class="nx">left</span>
          <span class="nx">position</span><span class="p">.</span><span class="nx">left</span> <span class="o">+=</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">borderWidth</span>
        <span class="k">if</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">tipJoint</span><span class="p">.</span><span class="nx">right</span>
          <span class="nx">position</span><span class="p">.</span><span class="nx">left</span> <span class="o">-=</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">borderWidth</span>
        <span class="k">if</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">tipJoint</span><span class="p">.</span><span class="nx">top</span>
          <span class="nx">position</span><span class="p">.</span><span class="nx">top</span> <span class="o">+=</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">borderWidth</span>
        <span class="k">else</span> <span class="k">if</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">tipJoint</span><span class="p">.</span><span class="nx">bottom</span>
          <span class="nx">position</span><span class="p">.</span><span class="nx">top</span> <span class="o">-=</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">borderWidth</span>
        

    <span class="k">else</span></pre></div>             </td>           </tr>                               <tr id="section-57">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-57">&#182;</a>               </div>               <p>Follow mouse</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="vi">@lastEvent = </span><span class="nx">e</span> <span class="k">if</span> <span class="nx">e</span><span class="o">?</span>
      <span class="nv">mousePosition = </span><span class="nx">@adapter</span><span class="p">.</span><span class="nx">mousePosition</span> <span class="nx">e</span>
      <span class="k">return</span> <span class="nx">unless</span> <span class="nx">mousePosition</span><span class="o">?</span>
      <span class="nv">position = top: </span><span class="nx">mousePosition</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nv">left: </span><span class="nx">mousePosition</span><span class="p">.</span><span class="nx">x</span>

    <span class="k">if</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">autoOffset</span>
      <span class="nv">stemLength = </span><span class="k">if</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">stem</span> <span class="k">then</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">stemLength</span> <span class="k">else</span> <span class="mi">0</span></pre></div>             </td>           </tr>                               <tr id="section-58">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-58">&#182;</a>               </div>               <p>If there is as stem offsets dont need to be that big if fixed.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nv">offsetDistance = </span><span class="k">if</span> <span class="nx">stemLength</span> <span class="o">and</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">fixed</span> <span class="k">then</span> <span class="mi">2</span> <span class="k">else</span> <span class="mi">10</span></pre></div>             </td>           </tr>                               <tr id="section-59">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-59">&#182;</a>               </div>               <p>Corners can be closer but when middle or center they are too close</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nv">additionalHorizontal = </span><span class="k">if</span> <span class="nx">tipJoint</span><span class="p">.</span><span class="nx">middle</span> <span class="o">and</span> <span class="o">not</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">fixed</span> <span class="k">then</span> <span class="mi">15</span> <span class="k">else</span> <span class="mi">0</span>
      <span class="nv">additionalVertical = </span><span class="k">if</span> <span class="nx">tipJoint</span><span class="p">.</span><span class="nx">center</span> <span class="o">and</span> <span class="o">not</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">fixed</span> <span class="k">then</span> <span class="mi">15</span> <span class="k">else</span> <span class="mi">0</span>

      <span class="k">if</span> <span class="nx">tipJoint</span><span class="p">.</span><span class="nx">right</span> <span class="k">then</span> <span class="nx">position</span><span class="p">.</span><span class="nx">left</span> <span class="o">-=</span> <span class="nx">offsetDistance</span> <span class="o">+</span> <span class="nx">additionalHorizontal</span>
      <span class="k">else</span> <span class="k">if</span> <span class="nx">tipJoint</span><span class="p">.</span><span class="nx">left</span> <span class="k">then</span> <span class="nx">position</span><span class="p">.</span><span class="nx">left</span> <span class="o">+=</span> <span class="nx">offsetDistance</span> <span class="o">+</span> <span class="nx">additionalHorizontal</span>

      <span class="k">if</span> <span class="nx">tipJoint</span><span class="p">.</span><span class="nx">bottom</span> <span class="k">then</span> <span class="nx">position</span><span class="p">.</span><span class="nx">top</span> <span class="o">-=</span> <span class="nx">offsetDistance</span> <span class="o">+</span> <span class="nx">additionalVertical</span>
      <span class="k">else</span> <span class="k">if</span> <span class="nx">tipJoint</span><span class="p">.</span><span class="nx">top</span> <span class="k">then</span> <span class="nx">position</span><span class="p">.</span><span class="nx">top</span> <span class="o">+=</span> <span class="nx">offsetDistance</span> <span class="o">+</span> <span class="nx">additionalVertical</span>

      <span class="k">if</span> <span class="nx">stemLength</span>
        <span class="nx">stem</span> <span class="o">?=</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">stem</span>
        <span class="k">if</span> <span class="nx">stem</span><span class="p">.</span><span class="nx">right</span> <span class="k">then</span> <span class="nx">position</span><span class="p">.</span><span class="nx">left</span> <span class="o">-=</span> <span class="nx">stemLength</span>
        <span class="k">else</span> <span class="k">if</span> <span class="nx">stem</span><span class="p">.</span><span class="nx">left</span> <span class="k">then</span> <span class="nx">position</span><span class="p">.</span><span class="nx">left</span> <span class="o">+=</span> <span class="nx">stemLength</span>

        <span class="k">if</span> <span class="nx">stem</span><span class="p">.</span><span class="nx">bottom</span> <span class="k">then</span> <span class="nx">position</span><span class="p">.</span><span class="nx">top</span> <span class="o">-=</span> <span class="nx">stemLength</span>
        <span class="k">else</span> <span class="k">if</span> <span class="nx">stem</span><span class="p">.</span><span class="nx">top</span> <span class="k">then</span> <span class="nx">position</span><span class="p">.</span><span class="nx">top</span> <span class="o">+=</span> <span class="nx">stemLength</span>

    <span class="nx">position</span><span class="p">.</span><span class="nx">left</span> <span class="o">+=</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">offset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="nx">position</span><span class="p">.</span><span class="nx">top</span> <span class="o">+=</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">offset</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">if</span> <span class="nx">tipJoint</span><span class="p">.</span><span class="nx">right</span> <span class="k">then</span> <span class="nx">position</span><span class="p">.</span><span class="nx">left</span> <span class="o">-=</span> <span class="nx">@dimensions</span><span class="p">.</span><span class="nx">width</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">tipJoint</span><span class="p">.</span><span class="nx">center</span> <span class="k">then</span> <span class="nx">position</span><span class="p">.</span><span class="nx">left</span> <span class="o">-=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span> <span class="nx">@dimensions</span><span class="p">.</span><span class="nx">width</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="k">if</span> <span class="nx">tipJoint</span><span class="p">.</span><span class="nx">bottom</span> <span class="k">then</span> <span class="nx">position</span><span class="p">.</span><span class="nx">top</span> <span class="o">-=</span> <span class="nx">@dimensions</span><span class="p">.</span><span class="nx">height</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">tipJoint</span><span class="p">.</span><span class="nx">middle</span> <span class="k">then</span> <span class="nx">position</span><span class="p">.</span><span class="nx">top</span> <span class="o">-=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span> <span class="nx">@dimensions</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="nx">position</span>

  <span class="nv">_ensureViewportContainment: </span><span class="nf">(e, position) -&gt;</span>

    <span class="nv">stem = </span><span class="nx">@options</span><span class="p">.</span><span class="nx">stem</span>

    <span class="nv">originals = </span><span class="p">{</span>
      <span class="nv">position: </span><span class="nx">position</span>
      <span class="nv">stem: </span><span class="nx">stem</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-60">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-60">&#182;</a>               </div>               <p>Sometimes the element is theoretically visible, but an effect is not yet showing it.
So the calculation of the offsets is incorrect sometimes, which results in faulty repositioning.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">return</span> <span class="nx">originals</span> <span class="nx">unless</span> <span class="nx">@visible</span> <span class="o">and</span> <span class="nx">position</span>
    
    <span class="nv">sticksOut = </span><span class="nx">@_sticksOut</span> <span class="nx">position</span>

    <span class="k">return</span> <span class="nx">originals</span> <span class="nx">unless</span> <span class="nx">sticksOut</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">or</span> <span class="nx">sticksOut</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="nv">tipJoint = </span><span class="k">new</span> <span class="nx">Opentip</span><span class="p">.</span><span class="nx">Joint</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">tipJoint</span>
    <span class="nv">targetJoint = </span><span class="k">new</span> <span class="nx">Opentip</span><span class="p">.</span><span class="nx">Joint</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">targetJoint</span> <span class="k">if</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">targetJoint</span>

    <span class="nv">scrollOffset = </span><span class="nx">@adapter</span><span class="p">.</span><span class="nx">scrollOffset</span><span class="p">()</span>
    <span class="nv">viewportDimensions = </span><span class="nx">@adapter</span><span class="p">.</span><span class="nx">viewportDimensions</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-61">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-61">&#182;</a>               </div>               <p>The opentip's position inside the viewport</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">viewportPosition = </span><span class="p">[</span>
      <span class="nx">position</span><span class="p">.</span><span class="nx">left</span> <span class="o">-</span> <span class="nx">scrollOffset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="nx">position</span><span class="p">.</span><span class="nx">top</span> <span class="o">-</span> <span class="nx">scrollOffset</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="p">]</span>

    <span class="nv">needsRepositioning = </span><span class="kc">no</span>



    <span class="k">if</span> <span class="nx">viewportDimensions</span><span class="p">.</span><span class="nx">width</span> <span class="o">&gt;=</span> <span class="nx">@dimensions</span><span class="p">.</span><span class="nx">width</span></pre></div>             </td>           </tr>                               <tr id="section-62">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-62">&#182;</a>               </div>               <p>Well if the viewport is smaller than the tooltip there's not much to do</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="nx">sticksOut</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="nv">needsRepositioning = </span><span class="kc">yes</span>

        <span class="k">switch</span> <span class="nx">sticksOut</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
          <span class="k">when</span> <span class="nx">@STICKS_OUT_LEFT</span>
            <span class="nx">tipJoint</span><span class="p">.</span><span class="nx">setHorizontal</span> <span class="s">&quot;left&quot;</span>
            <span class="nx">targetJoint</span><span class="p">.</span><span class="nx">setHorizontal</span> <span class="s">&quot;right&quot;</span> <span class="k">if</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">targetJoint</span>
          <span class="k">when</span> <span class="nx">@STICKS_OUT_RIGHT</span>
            <span class="nx">tipJoint</span><span class="p">.</span><span class="nx">setHorizontal</span> <span class="s">&quot;right&quot;</span>
            <span class="nx">targetJoint</span><span class="p">.</span><span class="nx">setHorizontal</span> <span class="s">&quot;left&quot;</span> <span class="k">if</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">targetJoint</span>

    <span class="k">if</span> <span class="nx">viewportDimensions</span><span class="p">.</span><span class="nx">height</span> <span class="o">&gt;=</span> <span class="nx">@dimensions</span><span class="p">.</span><span class="nx">height</span></pre></div>             </td>           </tr>                               <tr id="section-63">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-63">&#182;</a>               </div>               <p>Well if the viewport is smaller than the tooltip there's not much to do</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="nx">sticksOut</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="nv">needsRepositioning = </span><span class="kc">yes</span>

        <span class="k">switch</span> <span class="nx">sticksOut</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
          <span class="k">when</span> <span class="nx">@STICKS_OUT_TOP</span>
            <span class="nx">tipJoint</span><span class="p">.</span><span class="nx">setVertical</span> <span class="s">&quot;top&quot;</span>
            <span class="nx">targetJoint</span><span class="p">.</span><span class="nx">setVertical</span> <span class="s">&quot;bottom&quot;</span> <span class="k">if</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">targetJoint</span>
          <span class="k">when</span> <span class="nx">@STICKS_OUT_BOTTOM</span>
            <span class="nx">tipJoint</span><span class="p">.</span><span class="nx">setVertical</span> <span class="s">&quot;bottom&quot;</span>
            <span class="nx">targetJoint</span><span class="p">.</span><span class="nx">setVertical</span> <span class="s">&quot;top&quot;</span> <span class="k">if</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">targetJoint</span>

    <span class="k">return</span> <span class="nx">originals</span> <span class="nx">unless</span> <span class="nx">needsRepositioning</span></pre></div>             </td>           </tr>                               <tr id="section-64">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-64">&#182;</a>               </div>               <p>Needs to reposition</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-65">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-65">&#182;</a>               </div>               <p>TODO: actually handle the stem here</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">stem = </span><span class="nx">tipJoint</span> <span class="k">if</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">stem</span>
    <span class="nv">position = </span><span class="nx">@getPosition</span> <span class="nx">e</span><span class="p">,</span> <span class="nx">tipJoint</span><span class="p">,</span> <span class="nx">targetJoint</span><span class="p">,</span> <span class="nx">stem</span>

    <span class="nv">newSticksOut = </span><span class="nx">@_sticksOut</span> <span class="nx">position</span>

    <span class="nv">revertedX = </span><span class="kc">no</span>
    <span class="nv">revertedY = </span><span class="kc">no</span>

    <span class="k">if</span> <span class="nx">newSticksOut</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">and</span> <span class="p">(</span><span class="nx">newSticksOut</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">isnt</span> <span class="nx">sticksOut</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></pre></div>             </td>           </tr>                               <tr id="section-66">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-66">&#182;</a>               </div>               <p>The tooltip changed sides, but now is sticking out the other side of
the window.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nv">revertedX = </span><span class="kc">yes</span>
      <span class="nx">tipJoint</span><span class="p">.</span><span class="nx">setHorizontal</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">tipJoint</span><span class="p">.</span><span class="nx">horizontal</span>
      <span class="nx">targetJoint</span><span class="p">.</span><span class="nx">setHorizontal</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">targetJoint</span><span class="p">.</span><span class="nx">horizontal</span> <span class="k">if</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">targetJoint</span>
    <span class="k">if</span> <span class="nx">newSticksOut</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">and</span> <span class="p">(</span><span class="nx">newSticksOut</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">isnt</span> <span class="nx">sticksOut</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
      <span class="nv">revertedY = </span><span class="kc">yes</span>
      <span class="nx">tipJoint</span><span class="p">.</span><span class="nx">setVertical</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">tipJoint</span><span class="p">.</span><span class="nx">vertical</span>
      <span class="nx">targetJoint</span><span class="p">.</span><span class="nx">setVertical</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">targetJoint</span><span class="p">.</span><span class="nx">vertical</span> <span class="k">if</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">targetJoint</span>


    <span class="k">return</span> <span class="nx">originals</span> <span class="k">if</span> <span class="nx">revertedX</span> <span class="o">and</span> <span class="nx">revertedY</span>
      
    <span class="k">if</span> <span class="nx">revertedX</span> <span class="o">or</span> <span class="nx">revertedY</span></pre></div>             </td>           </tr>                               <tr id="section-67">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-67">&#182;</a>               </div>               <p>One of the positions have been reverted. So get the position again.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nv">stem = </span><span class="nx">tipJoint</span> <span class="k">if</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">stem</span>
      <span class="nv">position = </span><span class="nx">@getPosition</span> <span class="nx">e</span><span class="p">,</span> <span class="nx">tipJoint</span><span class="p">,</span> <span class="nx">targetJoint</span><span class="p">,</span> <span class="nx">stem</span>

    <span class="p">{</span>
      <span class="nv">position: </span><span class="nx">position</span>
      <span class="nv">stem: </span><span class="nx">stem</span>
    <span class="p">}</span>



  <span class="nv">_sticksOut: </span><span class="nf">(position) -&gt;</span>
    <span class="nv">scrollOffset = </span><span class="nx">@adapter</span><span class="p">.</span><span class="nx">scrollOffset</span><span class="p">()</span>
      
    <span class="nv">viewportDimensions = </span><span class="nx">@adapter</span><span class="p">.</span><span class="nx">viewportDimensions</span><span class="p">()</span>
   
    <span class="nv">positionOffset = </span><span class="p">[</span>
      <span class="nx">position</span><span class="p">.</span><span class="nx">left</span> <span class="o">-</span> <span class="nx">scrollOffset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="nx">position</span><span class="p">.</span><span class="nx">top</span> <span class="o">-</span> <span class="nx">scrollOffset</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="p">]</span>

    <span class="nv">sticksOut = </span><span class="p">[</span> <span class="kc">no</span><span class="p">,</span> <span class="kc">no</span> <span class="p">]</span>

    <span class="k">if</span> <span class="nx">positionOffset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span>
      <span class="nx">sticksOut</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">@STICKS_OUT_LEFT</span> 
    <span class="k">else</span> <span class="k">if</span> <span class="nx">positionOffset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nx">@dimensions</span><span class="p">.</span><span class="nx">width</span> <span class="o">&gt;</span> <span class="nx">viewportDimensions</span><span class="p">.</span><span class="nx">width</span>
      <span class="nx">sticksOut</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">@STICKS_OUT_RIGHT</span>

    <span class="k">if</span> <span class="nx">positionOffset</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span>
      <span class="nx">sticksOut</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nx">@STICKS_OUT_TOP</span> 
    <span class="k">else</span> <span class="k">if</span> <span class="nx">positionOffset</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="nx">@dimensions</span><span class="p">.</span><span class="nx">height</span> <span class="o">&gt;</span> <span class="nx">viewportDimensions</span><span class="p">.</span><span class="nx">height</span>
      <span class="nx">sticksOut</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nx">@STICKS_OUT_BOTTOM</span> 

    <span class="nx">sticksOut</span></pre></div>             </td>           </tr>                               <tr id="section-68">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-68">&#182;</a>               </div>               <p>This is by far the most complex and difficult function to understand.
I tried to comment everything as good as possible</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">_draw: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-69">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-69">&#182;</a>               </div>               <p>This function could be called before _buildElements()</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">return</span> <span class="nx">unless</span> <span class="nx">@backgroundCanvas</span> <span class="o">and</span> <span class="nx">@redraw</span>

    <span class="nx">@debug</span> <span class="s">&quot;Drawing background.&quot;</span>

    <span class="vi">@redraw = </span><span class="kc">off</span></pre></div>             </td>           </tr>                               <tr id="section-70">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-70">&#182;</a>               </div>               <p>Prepare for the close button</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">closeButtonInner = </span><span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">]</span>
    <span class="nv">closeButtonOuter = </span><span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">]</span>
    <span class="k">if</span> <span class="s">&quot;closeButton&quot;</span> <span class="k">in</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">hideTriggers</span>
      <span class="nv">closeButton = </span><span class="k">new</span> <span class="nx">Opentip</span><span class="p">.</span><span class="nx">Joint</span><span class="p">(</span><span class="k">if</span> <span class="nx">@currentStem</span><span class="o">?</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;top right&quot;</span> <span class="k">then</span> <span class="s">&quot;top left&quot;</span> <span class="k">else</span> <span class="s">&quot;top right&quot;</span><span class="p">)</span>
      <span class="nv">closeButtonInner = </span><span class="p">[</span>
        <span class="nx">@options</span><span class="p">.</span><span class="nx">closeButtonRadius</span> <span class="o">+</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">closeButtonOffset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="nx">@options</span><span class="p">.</span><span class="nx">closeButtonRadius</span> <span class="o">+</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">closeButtonOffset</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
      <span class="p">]</span>
      <span class="nv">closeButtonOuter = </span><span class="p">[</span>
        <span class="nx">@options</span><span class="p">.</span><span class="nx">closeButtonRadius</span> <span class="o">-</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">closeButtonOffset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="nx">@options</span><span class="p">.</span><span class="nx">closeButtonRadius</span> <span class="o">-</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">closeButtonOffset</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
      <span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-71">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-71">&#182;</a>               </div>               <p>Now for the canvas dimensions and position</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">canvasDimensions = </span><span class="nx">@adapter</span><span class="p">.</span><span class="nx">clone</span> <span class="nx">@dimensions</span>
    <span class="nv">canvasPosition = </span><span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-72">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-72">&#182;</a>               </div>               <p>Account for border</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">borderWidth</span>
      <span class="nx">canvasDimensions</span><span class="p">.</span><span class="nx">width</span> <span class="o">+=</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">borderWidth</span> <span class="o">*</span> <span class="mi">2</span>
      <span class="nx">canvasDimensions</span><span class="p">.</span><span class="nx">height</span> <span class="o">+=</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">borderWidth</span> <span class="o">*</span> <span class="mi">2</span>
      <span class="nx">canvasPosition</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-=</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">borderWidth</span>
      <span class="nx">canvasPosition</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-=</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">borderWidth</span></pre></div>             </td>           </tr>                               <tr id="section-73">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-73">&#182;</a>               </div>               <p>Account for the shadow</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">shadow</span>
      <span class="nx">canvasDimensions</span><span class="p">.</span><span class="nx">width</span> <span class="o">+=</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">shadowBlur</span> <span class="o">*</span> <span class="mi">2</span></pre></div>             </td>           </tr>                               <tr id="section-74">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-74">&#182;</a>               </div>               <p>If the shadow offset is bigger than the actual shadow blur, the whole canvas gets bigger</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">canvasDimensions</span><span class="p">.</span><span class="nx">width</span> <span class="o">+=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">shadowOffset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">shadowBlur</span> <span class="o">*</span> <span class="mi">2</span>
      
      <span class="nx">canvasDimensions</span><span class="p">.</span><span class="nx">height</span> <span class="o">+=</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">shadowBlur</span> <span class="o">*</span> <span class="mi">2</span>
      <span class="nx">canvasDimensions</span><span class="p">.</span><span class="nx">height</span> <span class="o">+=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">shadowOffset</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">shadowBlur</span> <span class="o">*</span> <span class="mi">2</span>

      <span class="nx">canvasPosition</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">shadowBlur</span> <span class="o">-</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">shadowOffset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="nx">canvasPosition</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">shadowBlur</span> <span class="o">-</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">shadowOffset</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-75">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-75">&#182;</a>               </div>               <hr />             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-76">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-76">&#182;</a>               </div>               <p>Bulges could be caused by stems or close buttons</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">bulge = left: </span><span class="mi">0</span><span class="p">,</span> <span class="nv">right: </span><span class="mi">0</span><span class="p">,</span> <span class="nv">top: </span><span class="mi">0</span><span class="p">,</span> <span class="nv">bottom: </span><span class="mi">0</span></pre></div>             </td>           </tr>                               <tr id="section-77">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-77">&#182;</a>               </div>               <p>Account for the stem</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">@currentStem</span>
      <span class="k">if</span> <span class="nx">@currentStem</span><span class="p">.</span><span class="nx">left</span> <span class="k">then</span> <span class="nv">bulge.left = </span><span class="nx">@options</span><span class="p">.</span><span class="nx">stemLength</span>
      <span class="k">else</span> <span class="k">if</span> <span class="nx">@currentStem</span><span class="p">.</span><span class="nx">right</span> <span class="k">then</span> <span class="nv">bulge.right = </span><span class="nx">@options</span><span class="p">.</span><span class="nx">stemLength</span>

      <span class="k">if</span> <span class="nx">@currentStem</span><span class="p">.</span><span class="nx">top</span> <span class="k">then</span> <span class="nv">bulge.top = </span><span class="nx">@options</span><span class="p">.</span><span class="nx">stemLength</span>
      <span class="k">else</span> <span class="k">if</span> <span class="nx">@currentStem</span><span class="p">.</span><span class="nx">bottom</span> <span class="k">then</span> <span class="nv">bulge.bottom = </span><span class="nx">@options</span><span class="p">.</span><span class="nx">stemLength</span></pre></div>             </td>           </tr>                               <tr id="section-78">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-78">&#182;</a>               </div>               <p>Account for the close button</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">closeButton</span>
      <span class="k">if</span> <span class="nx">closeButton</span><span class="p">.</span><span class="nx">left</span> <span class="k">then</span> <span class="nv">bulge.left = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span> <span class="nx">bulge</span><span class="p">.</span><span class="nx">left</span><span class="p">,</span> <span class="nx">closeButtonOuter</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="k">else</span> <span class="k">if</span> <span class="nx">closeButton</span><span class="p">.</span><span class="nx">right</span> <span class="k">then</span> <span class="nv">bulge.right = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span> <span class="nx">bulge</span><span class="p">.</span><span class="nx">right</span><span class="p">,</span> <span class="nx">closeButtonOuter</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

      <span class="k">if</span> <span class="nx">closeButton</span><span class="p">.</span><span class="nx">top</span> <span class="k">then</span> <span class="nv">bulge.top = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span> <span class="nx">bulge</span><span class="p">.</span><span class="nx">top</span><span class="p">,</span> <span class="nx">closeButtonOuter</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
      <span class="k">else</span> <span class="k">if</span> <span class="nx">closeButton</span><span class="p">.</span><span class="nx">bottom</span> <span class="k">then</span> <span class="nv">bulge.bottom = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span> <span class="nx">bulge</span><span class="p">.</span><span class="nx">bottom</span><span class="p">,</span> <span class="nx">closeButtonOuter</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>


    <span class="nx">canvasDimensions</span><span class="p">.</span><span class="nx">width</span> <span class="o">+=</span> <span class="nx">bulge</span><span class="p">.</span><span class="nx">left</span> <span class="o">+</span> <span class="nx">bulge</span><span class="p">.</span><span class="nx">right</span>
    <span class="nx">canvasDimensions</span><span class="p">.</span><span class="nx">height</span> <span class="o">+=</span> <span class="nx">bulge</span><span class="p">.</span><span class="nx">top</span> <span class="o">+</span> <span class="nx">bulge</span><span class="p">.</span><span class="nx">bottom</span>
    <span class="nx">canvasPosition</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-=</span> <span class="nx">bulge</span><span class="p">.</span><span class="nx">left</span>
    <span class="nx">canvasPosition</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-=</span> <span class="nx">bulge</span><span class="p">.</span><span class="nx">top</span>


    <span class="k">if</span> <span class="nx">@currentStem</span> <span class="o">and</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">borderWidth</span>
      <span class="p">{</span><span class="nx">stemLength</span><span class="p">,</span> <span class="nx">stemBase</span><span class="p">}</span> <span class="o">=</span> <span class="nx">@_getPathStemMeasures</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">stemBase</span><span class="p">,</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">stemLength</span><span class="p">,</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">borderWidth</span></pre></div>             </td>           </tr>                               <tr id="section-79">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-79">&#182;</a>               </div>               <p>Need to draw on the DOM canvas element itself</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">backgroundCanvas = </span><span class="nx">@adapter</span><span class="p">.</span><span class="nx">unwrap</span> <span class="nx">@backgroundCanvas</span>

    <span class="nv">backgroundCanvas.width = </span><span class="nx">canvasDimensions</span><span class="p">.</span><span class="nx">width</span>
    <span class="nv">backgroundCanvas.height = </span><span class="nx">canvasDimensions</span><span class="p">.</span><span class="nx">height</span>

    <span class="nx">@adapter</span><span class="p">.</span><span class="nx">css</span> <span class="nx">@backgroundCanvas</span><span class="p">,</span>
      <span class="nv">width: </span><span class="s">&quot;</span><span class="si">#{</span><span class="nx">backgroundCanvas</span><span class="p">.</span><span class="nx">width</span><span class="si">}</span><span class="s">px&quot;</span>
      <span class="nv">height: </span><span class="s">&quot;</span><span class="si">#{</span><span class="nx">backgroundCanvas</span><span class="p">.</span><span class="nx">height</span><span class="si">}</span><span class="s">px&quot;</span>
      <span class="nv">left: </span><span class="s">&quot;</span><span class="si">#{</span><span class="nx">canvasPosition</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s">px&quot;</span>
      <span class="nv">top: </span><span class="s">&quot;</span><span class="si">#{</span><span class="nx">canvasPosition</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s">px&quot;</span>


    <span class="nv">ctx = </span><span class="nx">backgroundCanvas</span><span class="p">.</span><span class="nx">getContext</span> <span class="s">&quot;2d&quot;</span>

    <span class="nx">ctx</span><span class="p">.</span><span class="nx">clearRect</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">backgroundCanvas</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">backgroundCanvas</span><span class="p">.</span><span class="nx">height</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">()</span>

    <span class="nv">ctx.fillStyle = </span><span class="nx">@_getColor</span> <span class="nx">ctx</span><span class="p">,</span> <span class="nx">@dimensions</span><span class="p">,</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">background</span><span class="p">,</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">backgroundGradientHorizontal</span>
    <span class="nv">ctx.lineJoin = </span><span class="s">&quot;miter&quot;</span>
    <span class="nv">ctx.miterLimit = </span><span class="mi">500</span></pre></div>             </td>           </tr>                               <tr id="section-80">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-80">&#182;</a>               </div>               <p>Since borders are always in the middle and I want them outside I need to
draw the actual path half the border width outset.</p>

<p>(hb = half border)</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">hb = </span><span class="nx">@options</span><span class="p">.</span><span class="nx">borderWidth</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="k">if</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">borderWidth</span>
      <span class="nv">ctx.strokeStyle = </span><span class="nx">@options</span><span class="p">.</span><span class="nx">borderColor</span>
      <span class="nv">ctx.lineWidth = </span><span class="nx">@options</span><span class="p">.</span><span class="nx">borderWidth</span>
    <span class="k">else</span>
      <span class="nv">stemLength = </span><span class="nx">@options</span><span class="p">.</span><span class="nx">stemLength</span>
      <span class="nv">stemBase = </span><span class="nx">@options</span><span class="p">.</span><span class="nx">stemBase</span></pre></div>             </td>           </tr>                               <tr id="section-81">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-81">&#182;</a>               </div>               <p>Draws a line with stem if necessary</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">drawLine = </span><span class="p">(</span><span class="nx">length</span><span class="p">,</span> <span class="nx">stem</span><span class="p">,</span> <span class="nx">first</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="k">if</span> <span class="nx">first</span></pre></div>             </td>           </tr>                               <tr id="section-82">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-82">&#182;</a>               </div>               <p>This ensures that the outline is properly closed</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">ctx</span><span class="p">.</span><span class="nx">moveTo</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">stemBase</span><span class="p">,</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">borderRadius</span><span class="p">,</span> <span class="nx">closeButtonInner</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="nx">hb</span><span class="p">,</span> <span class="o">-</span><span class="nx">hb</span>
      <span class="k">if</span> <span class="nx">stem</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">lineTo</span> <span class="nx">length</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="nx">stemBase</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="nx">hb</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">lineTo</span> <span class="nx">length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span> <span class="nx">stemLength</span> <span class="o">-</span> <span class="nx">hb</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">lineTo</span> <span class="nx">length</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="nx">stemBase</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="nx">hb</span></pre></div>             </td>           </tr>                               <tr id="section-83">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-83">&#182;</a>               </div>               <p>Draws a corner with stem if necessary</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">drawCorner = </span><span class="p">(</span><span class="nx">stem</span><span class="p">,</span> <span class="nx">closeButton</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="k">if</span> <span class="nx">stem</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">lineTo</span> <span class="o">-</span><span class="nx">stemBase</span> <span class="o">+</span> <span class="nx">hb</span><span class="p">,</span> <span class="mi">0</span> <span class="o">-</span> <span class="nx">hb</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">lineTo</span> <span class="nx">stemLength</span> <span class="o">+</span> <span class="nx">hb</span><span class="p">,</span> <span class="o">-</span><span class="nx">stemLength</span> <span class="o">-</span> <span class="nx">hb</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">lineTo</span> <span class="nx">hb</span><span class="p">,</span> <span class="nx">stemBase</span> <span class="o">-</span> <span class="nx">hb</span>
      <span class="k">else</span> <span class="k">if</span> <span class="nx">closeButton</span>
        <span class="nv">offset = </span><span class="nx">@options</span><span class="p">.</span><span class="nx">closeButtonOffset</span>
        <span class="nv">innerWidth = </span><span class="nx">closeButtonInner</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="nx">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">!=</span> <span class="mi">0</span></pre></div>             </td>           </tr>                               <tr id="section-84">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-84">&#182;</a>               </div>               <p>Since the canvas gets rotated for every corner, but the close button
is always defined as [ horizontal, vertical ] offsets, I have to switch
the offsets in case the canvas is rotated by 90degs</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nv">offset = </span><span class="p">[</span> <span class="nx">offset</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nx">offset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">]</span>
          <span class="nv">innerWidth = </span><span class="nx">closeButtonInner</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-85">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-85">&#182;</a>               </div>               <p>Basic math</p>

<p>I added a graphical explanation since it's sometimes hard to understand 
geometrical calculations without visualization:
https://raw.github.com/enyo/opentip/develop/files/close-button-angle.png</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nv">angle1 = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">acos</span><span class="p">(</span><span class="nx">offset</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">closeButtonRadius</span><span class="p">)</span>
        <span class="nv">angle2 = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">acos</span><span class="p">(</span><span class="nx">offset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">closeButtonRadius</span><span class="p">)</span>

        <span class="nx">ctx</span><span class="p">.</span><span class="nx">lineTo</span> <span class="o">-</span><span class="nx">innerWidth</span> <span class="o">+</span> <span class="nx">hb</span><span class="p">,</span> <span class="o">-</span><span class="nx">hb</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">arc</span> <span class="nx">hb</span><span class="o">-</span><span class="nx">offset</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="nx">hb</span><span class="o">+</span><span class="nx">offset</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">closeButtonRadius</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="nx">angle1</span><span class="p">),</span> <span class="nx">angle2</span>
      <span class="k">else</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">lineTo</span> <span class="o">-</span><span class="nx">@options</span><span class="p">.</span><span class="nx">borderRadius</span> <span class="o">+</span> <span class="nx">hb</span><span class="p">,</span> <span class="o">-</span><span class="nx">hb</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">quadraticCurveTo</span> <span class="nx">hb</span><span class="p">,</span> <span class="o">-</span><span class="nx">hb</span><span class="p">,</span> <span class="nx">hb</span><span class="p">,</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">borderRadius</span> <span class="o">-</span> <span class="nx">hb</span></pre></div>             </td>           </tr>                               <tr id="section-86">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-86">&#182;</a>               </div>               <p>Start drawing without caring about the shadows or stems
The canvas position is exactly the amount that has been moved to account
for shadows and stems</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">ctx</span><span class="p">.</span><span class="nx">translate</span> <span class="o">-</span><span class="nx">canvasPosition</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="nx">canvasPosition</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="nx">ctx</span><span class="p">.</span><span class="nx">save</span><span class="p">()</span>

    <span class="nx">do</span> <span class="o">=&gt;</span> <span class="c1"># Wrapping variables</span></pre></div>             </td>           </tr>                               <tr id="section-87">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-87">&#182;</a>               </div>               <p>This part is a bit funky...
All in all I just iterate over all four corners, translate the canvas
to it and rotate it so the next line goes to the right.
This way I can call drawLine and drawCorner withouth them knowing which
line their actually currently drawing.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">Opentip</span><span class="p">.</span><span class="nx">positions</span><span class="p">.</span><span class="nx">length</span><span class="o">/</span><span class="mi">2</span><span class="p">]</span>
        <span class="nv">positionIdx = </span><span class="nx">i</span> <span class="o">*</span> <span class="mi">2</span>

        <span class="nv">positionX = </span><span class="k">if</span> <span class="nx">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">or</span> <span class="nx">i</span> <span class="o">==</span> <span class="mi">3</span> <span class="k">then</span> <span class="mi">0</span> <span class="k">else</span> <span class="nx">@dimensions</span><span class="p">.</span><span class="nx">width</span>
        <span class="nv">positionY = </span><span class="k">if</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="k">then</span> <span class="mi">0</span> <span class="k">else</span> <span class="nx">@dimensions</span><span class="p">.</span><span class="nx">height</span>
        <span class="nv">rotation = </span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="nx">i</span>
        <span class="nv">lineLength = </span><span class="k">if</span> <span class="nx">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">then</span> <span class="nx">@dimensions</span><span class="p">.</span><span class="nx">width</span> <span class="k">else</span> <span class="nx">@dimensions</span><span class="p">.</span><span class="nx">height</span>
        <span class="nv">lineStem = </span><span class="k">new</span> <span class="nx">Opentip</span><span class="p">.</span><span class="nx">Joint</span> <span class="nx">Opentip</span><span class="p">.</span><span class="nx">positions</span><span class="p">[</span><span class="nx">positionIdx</span><span class="p">]</span>
        <span class="nv">cornerStem = </span><span class="k">new</span> <span class="nx">Opentip</span><span class="p">.</span><span class="nx">Joint</span> <span class="nx">Opentip</span><span class="p">.</span><span class="nx">positions</span><span class="p">[</span><span class="nx">positionIdx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>

        <span class="nx">ctx</span><span class="p">.</span><span class="nx">save</span><span class="p">()</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">translate</span> <span class="nx">positionX</span><span class="p">,</span> <span class="nx">positionY</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">rotate</span> <span class="nx">rotation</span>
        <span class="nx">drawLine</span> <span class="nx">lineLength</span><span class="p">,</span> <span class="nx">lineStem</span><span class="p">.</span><span class="nx">eql</span><span class="p">(</span><span class="nx">@currentStem</span><span class="p">),</span> <span class="nx">i</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">translate</span> <span class="nx">lineLength</span><span class="p">,</span> <span class="mi">0</span>
        <span class="nx">drawCorner</span> <span class="nx">cornerStem</span><span class="p">.</span><span class="nx">eql</span><span class="p">(</span><span class="nx">@currentStem</span><span class="p">),</span> <span class="nx">cornerStem</span><span class="p">.</span><span class="nx">eql</span><span class="p">(</span><span class="nx">closeButton</span><span class="p">),</span> <span class="nx">i</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">restore</span><span class="p">()</span>

    <span class="nx">ctx</span><span class="p">.</span><span class="nx">closePath</span><span class="p">()</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">save</span><span class="p">()</span>

    <span class="k">if</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">shadow</span>
      <span class="nv">ctx.shadowColor = </span><span class="nx">@options</span><span class="p">.</span><span class="nx">shadowColor</span>
      <span class="nv">ctx.shadowBlur = </span><span class="nx">@options</span><span class="p">.</span><span class="nx">shadowBlur</span>
      <span class="nv">ctx.shadowOffsetX = </span><span class="nx">@options</span><span class="p">.</span><span class="nx">shadowOffset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="nv">ctx.shadowOffsetY = </span><span class="nx">@options</span><span class="p">.</span><span class="nx">shadowOffset</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="nx">ctx</span><span class="p">.</span><span class="nx">fill</span><span class="p">()</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">restore</span><span class="p">()</span> <span class="c1"># Without shadow</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">stroke</span><span class="p">()</span> <span class="k">if</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">borderWidth</span>

    <span class="nx">ctx</span><span class="p">.</span><span class="nx">restore</span><span class="p">()</span> <span class="c1"># Without shadow</span>

    <span class="k">if</span> <span class="nx">closeButton</span>
      <span class="nx">do</span> <span class="o">=&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-88">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-88">&#182;</a>               </div>               <p>Draw the cross</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nv">crossWidth = crossHeight = </span><span class="nx">@options</span><span class="p">.</span><span class="nx">closeButtonRadius</span> <span class="o">*</span> <span class="mi">2</span>

        <span class="k">if</span> <span class="nx">closeButton</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;top right&quot;</span>
          <span class="nv">linkCenter = </span><span class="p">[</span>
            <span class="nx">@dimensions</span><span class="p">.</span><span class="nx">width</span> <span class="o">-</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">closeButtonOffset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="nx">@options</span><span class="p">.</span><span class="nx">closeButtonOffset</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
          <span class="p">]</span>
          <span class="nv">crossCenter = </span><span class="p">[</span>
            <span class="nx">linkCenter</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nx">hb</span>
            <span class="nx">linkCenter</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="nx">hb</span>
          <span class="p">]</span>
        <span class="k">else</span>
          <span class="nv">linkCenter = </span><span class="p">[</span>
            <span class="nx">@options</span><span class="p">.</span><span class="nx">closeButtonOffset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="nx">@options</span><span class="p">.</span><span class="nx">closeButtonOffset</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
          <span class="p">]</span>
          <span class="nv">crossCenter = </span><span class="p">[</span>
            <span class="nx">linkCenter</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="nx">hb</span>
            <span class="nx">linkCenter</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="nx">hb</span>
          <span class="p">]</span>

        <span class="nx">ctx</span><span class="p">.</span><span class="nx">translate</span> <span class="nx">crossCenter</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">crossCenter</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="nv">hcs = </span><span class="nx">@options</span><span class="p">.</span><span class="nx">closeButtonCrossSize</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="nx">ctx</span><span class="p">.</span><span class="nx">save</span><span class="p">()</span>

        <span class="nx">ctx</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">()</span>

        <span class="nv">ctx.strokeStyle = </span><span class="nx">@options</span><span class="p">.</span><span class="nx">closeButtonCrossColor</span>
        <span class="nv">ctx.lineWidth = </span><span class="nx">@options</span><span class="p">.</span><span class="nx">closeButtonCrossLineWidth</span>
        <span class="nv">ctx.lineCap = </span><span class="s">&quot;round&quot;</span>

        <span class="nx">ctx</span><span class="p">.</span><span class="nx">moveTo</span> <span class="o">-</span><span class="nx">hcs</span><span class="p">,</span> <span class="o">-</span><span class="nx">hcs</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">lineTo</span> <span class="nx">hcs</span><span class="p">,</span> <span class="nx">hcs</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">stroke</span><span class="p">()</span>

        <span class="nx">ctx</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">()</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">moveTo</span> <span class="nx">hcs</span><span class="p">,</span> <span class="o">-</span><span class="nx">hcs</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">lineTo</span> <span class="o">-</span><span class="nx">hcs</span><span class="p">,</span> <span class="nx">hcs</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">stroke</span><span class="p">()</span>

        <span class="nx">ctx</span><span class="p">.</span><span class="nx">restore</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-89">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-89">&#182;</a>               </div>               <p>Position the link</p>             </td>             <td class="code">               <div class="highlight"><pre>        
        <span class="nx">@adapter</span><span class="p">.</span><span class="nx">css</span> <span class="nx">@closeButtonElement</span><span class="p">,</span>
          <span class="nv">left: </span><span class="s">&quot;</span><span class="si">#{</span><span class="nx">linkCenter</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="nx">hcs</span> <span class="o">-</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">closeButtonLinkOverscan</span><span class="si">}</span><span class="s">px&quot;</span>
          <span class="nv">top: </span><span class="s">&quot;</span><span class="si">#{</span><span class="nx">linkCenter</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="nx">hcs</span> <span class="o">-</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">closeButtonLinkOverscan</span><span class="si">}</span><span class="s">px&quot;</span>
          <span class="nv">width: </span><span class="s">&quot;</span><span class="si">#{</span><span class="nx">@options</span><span class="p">.</span><span class="nx">closeButtonCrossSize</span> <span class="o">+</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">closeButtonLinkOverscan</span> <span class="o">*</span> <span class="mi">2</span><span class="si">}</span><span class="s">px&quot;</span>
          <span class="nv">height: </span><span class="s">&quot;</span><span class="si">#{</span><span class="nx">@options</span><span class="p">.</span><span class="nx">closeButtonCrossSize</span> <span class="o">+</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">closeButtonLinkOverscan</span> <span class="o">*</span> <span class="mi">2</span><span class="si">}</span><span class="s">px&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-90">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-90">&#182;</a>               </div>               <p>I have to account for the border width when implementing the stems. The
tip height &amp; width obviously should be added to the outer border, but
the path is drawn in the middle of the border.
If I just draw the stem size specified on the path, the stem will be
bigger than requested.</p>

<p>So I have to calculate the stemBase and stemLength of the <strong>path</strong>
stem.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">_getPathStemMeasures: </span><span class="nf">(outerStemBase, outerStemLength, borderWidth) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-91">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-91">&#182;</a>               </div>               <p>Now for some math!</p>

<pre><code> /
/|\
</code></pre>

<p>/ | angle
  /  |  \
 /   |   \
/<strong><em>_|</em>_</strong>\</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">hb = </span><span class="nx">borderWidth</span> <span class="o">/</span> <span class="mi">2</span></pre></div>             </td>           </tr>                               <tr id="section-92">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-92">&#182;</a>               </div>               <p>This is the angle of the tip</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">halfAngle = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">atan</span> <span class="p">(</span><span class="nx">outerStemBase</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="nx">outerStemLength</span>
    <span class="nv">angle = </span><span class="nx">halfAngle</span> <span class="o">*</span> <span class="mi">2</span></pre></div>             </td>           </tr>                               <tr id="section-93">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-93">&#182;</a>               </div>               <p>The rhombus from the border tip to the path tip</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">rhombusSide = </span><span class="nx">hb</span> <span class="o">/</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span> <span class="nx">angle</span>

    <span class="nv">distanceBetweenTips = </span><span class="mi">2</span> <span class="o">*</span> <span class="nx">rhombusSide</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">cos</span> <span class="nx">halfAngle</span>
    <span class="nv">stemLength = </span><span class="nx">hb</span> <span class="o">+</span> <span class="nx">outerStemLength</span> <span class="o">-</span> <span class="nx">distanceBetweenTips</span>

    <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span> <span class="s">&quot;Sorry but your stemLength / stemBase ratio is strange.&quot;</span> <span class="k">if</span> <span class="nx">stemLength</span> <span class="o">&lt;</span> <span class="mi">0</span></pre></div>             </td>           </tr>                               <tr id="section-94">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-94">&#182;</a>               </div>               <p>Now calculate the new base</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">stemBase = </span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">tan</span><span class="p">(</span><span class="nx">halfAngle</span><span class="p">)</span> <span class="o">*</span> <span class="nx">stemLength</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span>

    <span class="p">{</span> <span class="nv">stemLength: </span><span class="nx">stemLength</span><span class="p">,</span> <span class="nv">stemBase: </span><span class="nx">stemBase</span> <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-95">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-95">&#182;</a>               </div>               <p>Turns a color string into a possible gradient</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">_getColor: </span><span class="nf">(ctx, dimensions, color, horizontal = no) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-96">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-96">&#182;</a>               </div>               <p>There is no comma so just return</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">return</span> <span class="nx">color</span> <span class="k">if</span> <span class="k">typeof</span> <span class="nx">color</span> <span class="o">==</span> <span class="s">&quot;string&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-97">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-97">&#182;</a>               </div>               <p>Create gradient</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">horizontal</span>
      <span class="nv">gradient = </span><span class="nx">ctx</span><span class="p">.</span><span class="nx">createLinearGradient</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">dimensions</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="mi">0</span>
    <span class="k">else</span>
      <span class="nv">gradient = </span><span class="nx">ctx</span><span class="p">.</span><span class="nx">createLinearGradient</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">dimensions</span><span class="p">.</span><span class="nx">height</span>

    <span class="k">for</span> <span class="nx">colorStop</span><span class="p">,</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">color</span>
      <span class="nx">gradient</span><span class="p">.</span><span class="nx">addColorStop</span> <span class="nx">colorStop</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">colorStop</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="nx">gradient</span>


  <span class="nv">_searchAndActivateCloseButtons: </span><span class="o">-&gt;</span>
    <span class="k">for</span> <span class="nx">element</span> <span class="k">in</span> <span class="nx">@adapter</span><span class="p">.</span><span class="nx">findAll</span> <span class="nx">@container</span><span class="p">,</span> <span class="s">&quot;.</span><span class="si">#{</span><span class="nx">@</span><span class="k">class</span><span class="p">.</span><span class="nx">close</span><span class="si">}</span><span class="s">&quot;</span>
      <span class="nx">@hideTriggers</span><span class="p">.</span><span class="nx">push</span>
        <span class="nv">element: </span><span class="nx">@adapter</span><span class="p">.</span><span class="nx">wrap</span> <span class="nx">element</span>
        <span class="nv">event: </span><span class="s">&quot;click&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-98">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-98">&#182;</a>               </div>               <p>Creating the observers for the new close buttons</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@_setupObservers</span> <span class="s">&quot;-showing&quot;</span><span class="p">,</span> <span class="s">&quot;showing&quot;</span> <span class="k">if</span> <span class="nx">@currentObservers</span><span class="p">.</span><span class="nx">showing</span>
    <span class="nx">@_setupObservers</span> <span class="s">&quot;-visible&quot;</span><span class="p">,</span> <span class="s">&quot;visible&quot;</span> <span class="k">if</span> <span class="nx">@currentObservers</span><span class="p">.</span><span class="nx">visible</span>

  <span class="nv">_activateFirstInput: </span><span class="o">-&gt;</span>
    <span class="nv">input = </span><span class="nx">@adapter</span><span class="p">.</span><span class="nx">unwrap</span> <span class="nx">@adapter</span><span class="p">.</span><span class="nx">find</span> <span class="nx">@container</span><span class="p">,</span> <span class="s">&quot;input, textarea&quot;</span>
    <span class="nx">input</span><span class="o">?</span><span class="p">.</span><span class="nx">focus</span><span class="o">?</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-99">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-99">&#182;</a>               </div>               <p>Calls reposition() everytime the mouse moves</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">_followMousePosition: </span><span class="o">-&gt;</span> <span class="nx">@adapter</span><span class="p">.</span><span class="nx">observe</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">,</span> <span class="s">&quot;mousemove&quot;</span><span class="p">,</span> <span class="nx">@bound</span><span class="p">.</span><span class="nx">reposition</span> <span class="nx">unless</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">fixed</span></pre></div>             </td>           </tr>                               <tr id="section-100">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-100">&#182;</a>               </div>               <p>Removes observer</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">_stopFollowingMousePosition: </span><span class="o">-&gt;</span> <span class="nx">@adapter</span><span class="p">.</span><span class="nx">stopObserving</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">,</span> <span class="s">&quot;mousemove&quot;</span><span class="p">,</span> <span class="nx">@bound</span><span class="p">.</span><span class="nx">reposition</span> <span class="nx">unless</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">fixed</span></pre></div>             </td>           </tr>                               <tr id="section-101">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-101">&#182;</a>               </div>               <p>I thinks those are self explanatory</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">_clearShowTimeout: </span><span class="o">-&gt;</span> <span class="nx">clearTimeout</span> <span class="nx">@_showTimeoutId</span>
  <span class="nv">_clearHideTimeout: </span><span class="o">-&gt;</span> <span class="nx">clearTimeout</span> <span class="nx">@_hideTimeoutId</span>
  <span class="nv">_clearTimeouts: </span><span class="o">-&gt;</span>
    <span class="nx">clearTimeout</span> <span class="nx">@_visibilityStateTimeoutId</span>
    <span class="nx">@_clearShowTimeout</span><span class="p">()</span>
    <span class="nx">@_clearHideTimeout</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-102">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-102">&#182;</a>               </div>               <p>Makes sure the trigger element exists, is visible, and part of this world.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">_triggerElementExists: </span><span class="o">-&gt;</span>
    <span class="nv">el = </span><span class="nx">@adapter</span><span class="p">.</span><span class="nx">unwrap</span> <span class="nx">@triggerElement</span>
    <span class="k">while</span> <span class="nx">el</span><span class="p">.</span><span class="nx">parentNode</span>
      <span class="k">return</span> <span class="kc">yes</span> <span class="k">if</span> <span class="nx">el</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">tagName</span> <span class="o">==</span> <span class="s">&quot;BODY&quot;</span>
      <span class="nv">el = </span><span class="nx">el</span><span class="p">.</span><span class="nx">parentNode</span></pre></div>             </td>           </tr>                               <tr id="section-103">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-103">&#182;</a>               </div>               <p>TODO: Add a check if the element is actually visible</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">return</span> <span class="kc">no</span>

  <span class="nv">_loadAjax: </span><span class="o">-&gt;</span>
    <span class="k">return</span> <span class="k">if</span> <span class="nx">@loading</span>

    <span class="vi">@loaded = </span><span class="kc">no</span>
    <span class="vi">@loading = </span><span class="kc">yes</span>
    <span class="nx">@adapter</span><span class="p">.</span><span class="nx">addClass</span> <span class="nx">@container</span><span class="p">,</span> <span class="nx">@</span><span class="k">class</span><span class="p">.</span><span class="nx">loading</span>

    <span class="nx">@debug</span> <span class="s">&quot;Loading content from </span><span class="si">#{</span><span class="nx">@options</span><span class="p">.</span><span class="nx">ajax</span><span class="si">}</span><span class="s">&quot;</span>

    <span class="nx">@adapter</span><span class="p">.</span><span class="nx">ajax</span>
      <span class="nv">url: </span><span class="nx">@options</span><span class="p">.</span><span class="nx">ajax</span>
      <span class="nv">method: </span><span class="nx">@options</span><span class="p">.</span><span class="nx">ajaxMethod</span>
      <span class="nv">onSuccess: </span><span class="p">(</span><span class="nx">responseText</span><span class="p">)</span> <span class="o">=&gt;</span>
        <span class="nx">@debug</span> <span class="s">&quot;Loading successful.&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-104">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-104">&#182;</a>               </div>               <p>This has to happen before setting the content since loading indicators
may still be visible.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">@adapter</span><span class="p">.</span><span class="nx">removeClass</span> <span class="nx">@container</span><span class="p">,</span> <span class="nx">@</span><span class="k">class</span><span class="p">.</span><span class="nx">loading</span>
        <span class="nx">@setContent</span> <span class="nx">responseText</span>
      <span class="nv">onError: </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="o">=&gt;</span>
        <span class="nv">message = </span><span class="s">&quot;There was a problem downloading the content.&quot;</span>
        <span class="nx">@debug</span> <span class="nx">message</span><span class="p">,</span> <span class="nx">error</span>
        <span class="nx">@setContent</span> <span class="nx">message</span>
        <span class="nx">@adapter</span><span class="p">.</span><span class="nx">addClass</span> <span class="nx">@container</span><span class="p">,</span> <span class="nx">@</span><span class="k">class</span><span class="p">.</span><span class="nx">ajaxError</span>
      <span class="nv">onComplete: </span><span class="o">=&gt;</span>
        <span class="nx">@adapter</span><span class="p">.</span><span class="nx">removeClass</span> <span class="nx">@container</span><span class="p">,</span> <span class="nx">@</span><span class="k">class</span><span class="p">.</span><span class="nx">loading</span>
        <span class="vi">@loading = </span><span class="kc">no</span>
        <span class="vi">@loaded = </span><span class="kc">yes</span>
        <span class="nx">@_searchAndActivateCloseButtons</span><span class="p">()</span>
        <span class="nx">@_activateFirstInput</span><span class="p">()</span>
        <span class="nx">@reposition</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-105">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-105">&#182;</a>               </div>               <p>Regularely checks if the element is still in the dom.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">_ensureTriggerElement: </span><span class="o">-&gt;</span>
    <span class="nx">unless</span> <span class="nx">@_triggerElementExists</span><span class="p">()</span>
      <span class="nx">@deactivate</span><span class="p">()</span>
      <span class="nx">@_stopEnsureTriggerElement</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-106">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-106">&#182;</a>               </div>               <p>In milliseconds, how often opentip should check for the existance of the element</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">_ensureTriggerElementInterval: </span><span class="mi">1000</span></pre></div>             </td>           </tr>                               <tr id="section-107">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-107">&#182;</a>               </div>               <p>Sets up an interval to call _ensureTriggerElement regularely</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">_startEnsureTriggerElement: </span><span class="o">-&gt;</span>
    <span class="vi">@_ensureTriggerElementTimeoutId = </span><span class="nx">setInterval</span> <span class="p">(</span><span class="o">=&gt;</span> <span class="nx">@_ensureTriggerElement</span><span class="p">()),</span> <span class="nx">@_ensureTriggerElementInterval</span></pre></div>             </td>           </tr>                               <tr id="section-108">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-108">&#182;</a>               </div>               <p>Stops the interval</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">_stopEnsureTriggerElement: </span><span class="o">-&gt;</span>
    <span class="nx">clearInterval</span> <span class="nx">@_ensureTriggerElementTimeoutId</span></pre></div>             </td>           </tr>                               <tr id="section-109">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-109">&#182;</a>               </div>               <h2>Utils</h2>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">vendors = </span><span class="p">[</span>
  <span class="s">&quot;khtml&quot;</span>
  <span class="s">&quot;ms&quot;</span>
  <span class="s">&quot;o&quot;</span>
  <span class="s">&quot;moz&quot;</span>
  <span class="s">&quot;webkit&quot;</span>
<span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-110">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-110">&#182;</a>               </div>               <p>Sets a sepcific css3 value for all vendors</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">Opentip::setCss3Style = </span><span class="nf">(element, styles) -&gt;</span>
  <span class="nv">element = </span><span class="nx">@adapter</span><span class="p">.</span><span class="nx">unwrap</span> <span class="nx">element</span>
  <span class="k">for</span> <span class="nx">own</span> <span class="nx">prop</span><span class="p">,</span> <span class="nx">value</span> <span class="k">of</span> <span class="nx">styles</span>
    <span class="k">if</span> <span class="nx">element</span><span class="p">.</span><span class="nx">style</span><span class="p">[</span><span class="nx">prop</span><span class="p">]</span><span class="o">?</span>
      <span class="nx">element</span><span class="p">.</span><span class="nx">style</span><span class="p">[</span><span class="nx">prop</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span>
    <span class="k">else</span>
      <span class="k">for</span> <span class="nx">vendor</span> <span class="k">in</span> <span class="nx">vendors</span>
        <span class="nv">vendorProp = </span><span class="s">&quot;</span><span class="si">#{</span><span class="nx">@ucfirst</span> <span class="nx">vendor</span><span class="si">}#{</span><span class="nx">@ucfirst</span> <span class="nx">prop</span><span class="si">}</span><span class="s">&quot;</span>
        <span class="nx">element</span><span class="p">.</span><span class="nx">style</span><span class="p">[</span><span class="nx">vendorProp</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span> <span class="k">if</span> <span class="nx">element</span><span class="p">.</span><span class="nx">style</span><span class="p">[</span><span class="nx">vendorProp</span><span class="p">]</span><span class="o">?</span></pre></div>             </td>           </tr>                               <tr id="section-111">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-111">&#182;</a>               </div>               <p>Defers the call</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">Opentip::defer = </span><span class="nf">(func) -&gt;</span> <span class="nx">setTimeout</span> <span class="nx">func</span><span class="p">,</span> <span class="mi">0</span></pre></div>             </td>           </tr>                               <tr id="section-112">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-112">&#182;</a>               </div>               <p>Changes seconds to milliseconds</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">Opentip::setTimeout = </span><span class="nf">(func, seconds) -&gt;</span> <span class="nx">setTimeout</span> <span class="nx">func</span><span class="p">,</span> <span class="k">if</span> <span class="nx">seconds</span> <span class="k">then</span> <span class="nx">seconds</span> <span class="o">*</span> <span class="mi">1000</span> <span class="k">else</span> <span class="mi">0</span></pre></div>             </td>           </tr>                               <tr id="section-113">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-113">&#182;</a>               </div>               <p>Turns only the first character uppercase</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">Opentip::ucfirst = </span><span class="nf">(string) -&gt;</span>
  <span class="k">return</span> <span class="s">&quot;&quot;</span> <span class="nx">unless</span> <span class="nx">string</span><span class="o">?</span>
  <span class="nx">string</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nx">toUpperCase</span><span class="p">()</span> <span class="o">+</span> <span class="nx">string</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-114">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-114">&#182;</a>               </div>               <p>Converts a camelized string into a dasherized one</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">Opentip::dasherize = </span><span class="nf">(string) -&gt;</span>
  <span class="nx">string</span><span class="p">.</span><span class="nx">replace</span> <span class="sr">/([A-Z])/g</span><span class="p">,</span> <span class="nf">(_, char) -&gt;</span> <span class="s">&quot;-</span><span class="si">#{</span><span class="nx">char</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span><span class="si">}</span><span class="s">&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-115">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-115">&#182;</a>               </div>               <p>Every position is converted to this class</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">Opentip</span><span class="p">.</span><span class="nx">Joint</span></pre></div>             </td>           </tr>                               <tr id="section-116">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-116">&#182;</a>               </div>               <p>Accepts pointer in nearly every form.</p>

<ul>
<li>"top left"</li>
<li>"topLeft"</li>
<li>"top-left"</li>
<li>"RIGHT to TOP"</li>
</ul>

<p>All that counts is that the words top, bottom, left or right are present.</p>

<p>It also accepts a Pointer object, creating a new object then</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">constructor: </span><span class="nf">(pointerString) -&gt;</span>
    <span class="k">return</span> <span class="nx">unless</span> <span class="nx">pointerString</span><span class="o">?</span>

    <span class="k">if</span> <span class="nx">pointerString</span> <span class="k">instanceof</span> <span class="nx">Opentip</span><span class="p">.</span><span class="nx">Joint</span>
      <span class="nv">pointerString = </span><span class="nx">pointerString</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>

    <span class="nx">@set</span> <span class="nx">pointerString</span>

    <span class="nx">@</span>

  <span class="nv">set: </span><span class="nf">(string) -&gt;</span>
    <span class="nv">string = </span><span class="nx">string</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span>

    <span class="nx">@setHorizontal</span> <span class="nx">string</span>
    <span class="nx">@setVertical</span> <span class="nx">string</span>

    <span class="nx">@</span>

  <span class="nv">setHorizontal: </span><span class="nf">(string) -&gt;</span>
    <span class="nv">valid = </span><span class="p">[</span> <span class="s">&quot;left&quot;</span><span class="p">,</span> <span class="s">&quot;center&quot;</span><span class="p">,</span> <span class="s">&quot;right&quot;</span> <span class="p">]</span>
    <span class="vi">@horizontal = </span><span class="nx">i</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span> <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">valid</span> <span class="k">when</span> <span class="o">~</span><span class="nx">string</span><span class="p">.</span><span class="nx">indexOf</span> <span class="nx">i</span>
    <span class="vi">@horizontal = </span><span class="s">&quot;center&quot;</span> <span class="nx">unless</span> <span class="nx">@horizontal</span><span class="o">?</span>

    <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">valid</span>
      <span class="k">this</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="k">if</span> <span class="nx">@horizontal</span> <span class="o">==</span> <span class="nx">i</span> <span class="k">then</span> <span class="nx">i</span> <span class="k">else</span> <span class="kc">undefined</span>

  <span class="nv">setVertical: </span><span class="nf">(string) -&gt;</span>
    <span class="nv">valid = </span><span class="p">[</span> <span class="s">&quot;top&quot;</span><span class="p">,</span> <span class="s">&quot;middle&quot;</span><span class="p">,</span> <span class="s">&quot;bottom&quot;</span> <span class="p">]</span>
    <span class="vi">@vertical = </span><span class="nx">i</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span> <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">valid</span> <span class="k">when</span> <span class="o">~</span><span class="nx">string</span><span class="p">.</span><span class="nx">indexOf</span> <span class="nx">i</span>
    <span class="vi">@vertical = </span><span class="s">&quot;middle&quot;</span> <span class="nx">unless</span> <span class="nx">@vertical</span><span class="o">?</span>
    <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">valid</span>
      <span class="k">this</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="k">if</span> <span class="nx">@vertical</span> <span class="o">==</span> <span class="nx">i</span> <span class="k">then</span> <span class="nx">i</span> <span class="k">else</span> <span class="kc">undefined</span></pre></div>             </td>           </tr>                               <tr id="section-117">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-117">&#182;</a>               </div>               <p>Checks if two pointers point in the same direction</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">eql: </span><span class="nf">(pointer) -&gt;</span>
    <span class="nx">pointer</span><span class="o">?</span> <span class="o">and</span> <span class="nx">@horizontal</span> <span class="o">==</span> <span class="nx">pointer</span><span class="p">.</span><span class="nx">horizontal</span> <span class="o">and</span> <span class="nx">@vertical</span> <span class="o">==</span> <span class="nx">pointer</span><span class="p">.</span><span class="nx">vertical</span></pre></div>             </td>           </tr>                               <tr id="section-118">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-118">&#182;</a>               </div>               <p>Turns topLeft into bottomRight</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">flip: </span><span class="o">-&gt;</span>
    <span class="nv">positionIdx = </span><span class="nx">Opentip</span><span class="p">.</span><span class="nx">position</span><span class="p">[</span><span class="nx">@toString</span> <span class="kc">yes</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-119">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-119">&#182;</a>               </div>               <p>There are 8 positions, and smart as I am I layed them out in a circle.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">flippedIndex = </span><span class="p">(</span><span class="nx">positionIdx</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span> <span class="o">%</span> <span class="mi">8</span>
    <span class="nx">@set</span> <span class="nx">Opentip</span><span class="p">.</span><span class="nx">positions</span><span class="p">[</span><span class="nx">flippedIndex</span><span class="p">]</span>
    <span class="nx">@</span>

  <span class="nv">toString: </span><span class="nf">(camelized = no) -&gt;</span>
    <span class="nv">vertical = </span><span class="k">if</span> <span class="nx">@vertical</span> <span class="o">==</span> <span class="s">&quot;middle&quot;</span> <span class="k">then</span> <span class="s">&quot;&quot;</span> <span class="k">else</span> <span class="nx">@vertical</span>
    <span class="nv">horizontal = </span><span class="k">if</span> <span class="nx">@horizontal</span> <span class="o">==</span> <span class="s">&quot;center&quot;</span> <span class="k">then</span> <span class="s">&quot;&quot;</span> <span class="k">else</span> <span class="nx">@horizontal</span>

    <span class="k">if</span> <span class="nx">vertical</span> <span class="o">and</span> <span class="nx">horizontal</span>
      <span class="k">if</span> <span class="nx">camelized</span> <span class="k">then</span> <span class="nv">horizontal = </span><span class="nx">Opentip</span><span class="o">::</span><span class="nx">ucfirst</span> <span class="nx">horizontal</span>
      <span class="k">else</span> <span class="nv">horizontal = </span><span class="s">&quot; </span><span class="si">#{</span><span class="nx">horizontal</span><span class="si">}</span><span class="s">&quot;</span>

    <span class="s">&quot;</span><span class="si">#{</span><span class="nx">vertical</span><span class="si">}#{</span><span class="nx">horizontal</span><span class="si">}</span><span class="s">&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-120">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-120">&#182;</a>               </div>               <p>Returns true if top and left are equal</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">Opentip::_positionsEqual = </span><span class="nf">(posA, posB) -&gt;</span>
  <span class="nx">posA</span><span class="o">?</span> <span class="o">and</span> <span class="nx">posB</span><span class="o">?</span> <span class="o">and</span> <span class="nx">posA</span><span class="p">.</span><span class="nx">left</span> <span class="o">==</span> <span class="nx">posB</span><span class="p">.</span><span class="nx">left</span> <span class="o">and</span> <span class="nx">posA</span><span class="p">.</span><span class="nx">top</span> <span class="o">==</span> <span class="nx">posB</span><span class="p">.</span><span class="nx">top</span></pre></div>             </td>           </tr>                               <tr id="section-121">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-121">&#182;</a>               </div>               <p>Returns true if width and height are equal</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">Opentip::_dimensionsEqual = </span><span class="nf">(dimA, dimB) -&gt;</span>
  <span class="nx">dimA</span><span class="o">?</span> <span class="o">and</span> <span class="nx">dimB</span><span class="o">?</span> <span class="o">and</span> <span class="nx">dimA</span><span class="p">.</span><span class="nx">width</span> <span class="o">==</span> <span class="nx">dimB</span><span class="p">.</span><span class="nx">width</span> <span class="o">and</span> <span class="nx">dimA</span><span class="p">.</span><span class="nx">height</span> <span class="o">==</span> <span class="nx">dimB</span><span class="p">.</span><span class="nx">height</span></pre></div>             </td>           </tr>                               <tr id="section-122">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-122">&#182;</a>               </div>               <p>Just forwards to console.debug if Opentip.debug is true and console.debug exists.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">Opentip::debug = </span><span class="nf">(args...) -&gt;</span>
  <span class="k">if</span> <span class="nx">Opentip</span><span class="p">.</span><span class="nx">debug</span> <span class="o">and</span> <span class="nx">console</span><span class="o">?</span><span class="p">.</span><span class="nx">debug</span><span class="o">?</span>
    <span class="nx">args</span><span class="p">.</span><span class="nx">unshift</span> <span class="s">&quot;</span><span class="err">#</span><span class="si">#{</span><span class="nx">@id</span><span class="si">}</span><span class="s"> |&quot;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">debug</span> <span class="nx">args</span><span class="p">...</span> </pre></div>             </td>           </tr>                               <tr id="section-123">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-123">&#182;</a>               </div>               <h2>Startup</h2>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">Opentip.findElements = </span><span class="o">-&gt;</span>
  <span class="nv">adapter = </span><span class="nx">Opentip</span><span class="p">.</span><span class="nx">adapter</span></pre></div>             </td>           </tr>                               <tr id="section-124">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-124">&#182;</a>               </div>               <p>Go through all elements with <code>data-ot="[...]"</code></p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">for</span> <span class="nx">element</span> <span class="k">in</span> <span class="nx">adapter</span><span class="p">.</span><span class="nx">findAll</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">,</span> <span class="s">&quot;[data-ot]&quot;</span>
    <span class="nv">options = </span><span class="p">{</span> <span class="p">}</span>

    <span class="nv">content = </span><span class="nx">adapter</span><span class="p">.</span><span class="nx">data</span> <span class="nx">element</span><span class="p">,</span> <span class="s">&quot;ot&quot;</span>

    <span class="k">if</span> <span class="nx">content</span> <span class="k">in</span> <span class="p">[</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;true&quot;</span><span class="p">,</span> <span class="s">&quot;yes&quot;</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-125">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-125">&#182;</a>               </div>               <p>Take the content from the title attribute</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nv">content = </span><span class="nx">adapter</span><span class="p">.</span><span class="nx">attr</span> <span class="nx">element</span><span class="p">,</span> <span class="s">&quot;title&quot;</span>
      <span class="nx">adapter</span><span class="p">.</span><span class="nx">attr</span> <span class="nx">element</span><span class="p">,</span> <span class="s">&quot;title&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>

    <span class="nv">content = </span><span class="nx">content</span> <span class="o">||</span> <span class="s">&quot;&quot;</span>

    <span class="k">for</span> <span class="nx">optionName</span> <span class="k">of</span> <span class="nx">Opentip</span><span class="p">.</span><span class="nx">styles</span><span class="p">.</span><span class="nx">standard</span>
      <span class="k">if</span> <span class="nv">optionValue = </span><span class="nx">adapter</span><span class="p">.</span><span class="nx">data</span> <span class="nx">element</span><span class="p">,</span> <span class="s">&quot;ot</span><span class="si">#{</span><span class="nx">Opentip</span><span class="o">::</span><span class="nx">ucfirst</span> <span class="nx">optionName</span><span class="si">}</span><span class="s">&quot;</span>
        <span class="k">if</span> <span class="nx">optionValue</span> <span class="k">in</span> <span class="p">[</span> <span class="s">&quot;yes&quot;</span><span class="p">,</span> <span class="s">&quot;true&quot;</span><span class="p">,</span> <span class="s">&quot;on&quot;</span> <span class="p">]</span> <span class="k">then</span> <span class="nv">optionValue = </span><span class="kc">true</span> 
        <span class="k">else</span> <span class="k">if</span> <span class="nx">optionValue</span> <span class="k">in</span> <span class="p">[</span> <span class="s">&quot;no&quot;</span><span class="p">,</span> <span class="s">&quot;false&quot;</span><span class="p">,</span> <span class="s">&quot;off&quot;</span> <span class="p">]</span> <span class="k">then</span> <span class="nv">optionValue = </span><span class="kc">false</span>
        <span class="nx">options</span><span class="p">[</span><span class="nx">optionName</span><span class="p">]</span> <span class="o">=</span> <span class="nx">optionValue</span>

    <span class="k">new</span> <span class="nx">Opentip</span> <span class="nx">element</span><span class="p">,</span> <span class="nx">content</span><span class="p">,</span> <span class="nx">options</span></pre></div>             </td>           </tr>                               <tr id="section-126">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-126">&#182;</a>               </div>               <h2>Publicly available</h2>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">Opentip.version = </span><span class="s">&quot;2.0.0-dev&quot;</span>

<span class="nv">Opentip.debug = </span><span class="kc">off</span>

<span class="nv">Opentip.lastId = </span><span class="mi">0</span>

<span class="nv">Opentip.lastZIndex = </span><span class="mi">100</span>


<span class="nv">Opentip.tips = </span><span class="p">[</span> <span class="p">]</span>

<span class="nv">Opentip._abortShowingGroup = </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-127">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-127">&#182;</a>               </div>               <p>TODO</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">Opentip._hideGroup = </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-128">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-128">&#182;</a>               </div>               <p>TODO</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-129">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-129">&#182;</a>               </div>               <p>A list of possible adapters. Used for testing</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">Opentip.adapters = </span><span class="p">{</span> <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-130">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-130">&#182;</a>               </div>               <p>The current adapter used.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">Opentip.adapter = </span><span class="kc">null</span>

<span class="nv">firstAdapter = </span><span class="kc">yes</span>
<span class="nv">Opentip.addAdapter = </span><span class="nf">(adapter) -&gt;</span>
  <span class="nx">Opentip</span><span class="p">.</span><span class="nx">adapters</span><span class="p">[</span><span class="nx">adapter</span><span class="p">.</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">adapter</span>
  <span class="k">if</span> <span class="nx">firstAdapter</span>
    <span class="nv">Opentip.adapter = </span><span class="nx">adapter</span>
    <span class="nx">adapter</span><span class="p">.</span><span class="nx">domReady</span> <span class="nx">Opentip</span><span class="p">.</span><span class="nx">findElements</span>
    <span class="nv">firstAdapter = </span><span class="kc">no</span>

<span class="nv">Opentip.positions = </span><span class="p">[</span>
  <span class="s">&quot;top&quot;</span>
  <span class="s">&quot;topRight&quot;</span>
  <span class="s">&quot;right&quot;</span>
  <span class="s">&quot;bottomRight&quot;</span>
  <span class="s">&quot;bottom&quot;</span>
  <span class="s">&quot;bottomLeft&quot;</span>
  <span class="s">&quot;left&quot;</span>
  <span class="s">&quot;topLeft&quot;</span>
<span class="p">]</span>
<span class="nv">Opentip.position = </span><span class="p">{</span> <span class="p">}</span>
<span class="k">for</span> <span class="nx">position</span><span class="p">,</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">Opentip</span><span class="p">.</span><span class="nx">positions</span>
  <span class="nx">Opentip</span><span class="p">.</span><span class="nx">position</span><span class="p">[</span><span class="nx">position</span><span class="p">]</span> <span class="o">=</span> <span class="nx">i</span></pre></div>             </td>           </tr>                               <tr id="section-131">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-131">&#182;</a>               </div>               <p>The standard style.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">Opentip.styles =</span>
  <span class="nv">standard: </span>   </pre></div>             </td>           </tr>                               <tr id="section-132">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-132">&#182;</a>               </div>               <p>This style also contains all default values for other styles.</p>

<p>Following abbreviations are used:</p>

<ul>
<li><code>POINTER</code> : a string that contains at least one of top, bottom, right or left</li>
<li><code>OFFSET</code> : [ XVALUE, YVALUE ] (integers)</li>
<li><code>ELEMENT</code> : element or element id</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-133">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-133">&#182;</a>               </div>               <p>Will be set if provided in constructor</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">title: </span><span class="kc">undefined</span></pre></div>             </td>           </tr>                               <tr id="section-134">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-134">&#182;</a>               </div>               <p>Whether the provided title should be html escaped</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">escapeTitle: </span><span class="kc">yes</span></pre></div>             </td>           </tr>                               <tr id="section-135">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-135">&#182;</a>               </div>               <p>Whether the content should be html escaped</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">escapeContent: </span><span class="kc">no</span></pre></div>             </td>           </tr>                               <tr id="section-136">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-136">&#182;</a>               </div>               <p>The class name to be added to the HTML element</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">className: </span><span class="s">&quot;standard&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-137">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-137">&#182;</a>               </div>               <ul>
<li><code>false</code> (no stem)</li>
<li><code>true</code> (stem at tipJoint position)</li>
<li><code>POINTER</code> (for stems in other directions)</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">stem: </span><span class="kc">yes</span></pre></div>             </td>           </tr>                               <tr id="section-138">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-138">&#182;</a>               </div>               <p><code>float</code> (in seconds)
If null, the default is used: 0.2 for mouseover, 0 for click</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">delay: </span><span class="kc">null</span></pre></div>             </td>           </tr>                               <tr id="section-139">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-139">&#182;</a>               </div>               <p>See delay</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">hideDelay: </span><span class="mf">0.1</span></pre></div>             </td>           </tr>                               <tr id="section-140">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-140">&#182;</a>               </div>               <p>If target is not null, elements are always fixed.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">fixed: </span><span class="kc">no</span></pre></div>             </td>           </tr>                               <tr id="section-141">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-141">&#182;</a>               </div>               <ul>
<li>eventname (eg: <code>"click"</code>, <code>"mouseover"</code>, etc..)</li>
<li><code>"creation"</code> (the tooltip will show when being created)</li>
<li><code>null</code> if you want to handle it yourself (Opentip will not register for any events)</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">showOn: </span><span class="s">&quot;mouseover&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-142">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-142">&#182;</a>               </div>               <ul>
<li><code>"trigger"</code></li>
<li><code>"tip"</code></li>
<li><code>"target"</code></li>
<li><code>"closeButton"</code></li>
<li><code>ELEMENT</code></li>
</ul>

<p>This is just a shortcut, and will be added to hideTriggers</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">hideTrigger: </span><span class="s">&quot;trigger&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-143">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-143">&#182;</a>               </div>               <p>An array of hideTriggers.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">hideTriggers: </span><span class="p">[</span> <span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-144">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-144">&#182;</a>               </div>               <ul>
<li>eventname (eg: <code>"click"</code>)</li>
<li>array of event strings if multiple hideTriggers</li>
<li><code>null</code> (let Opentip decide)</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">hideOn: </span><span class="kc">null</span></pre></div>             </td>           </tr>                               <tr id="section-145">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-145">&#182;</a>               </div>               <p><code>OFFSET</code></p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">offset: </span><span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-146">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-146">&#182;</a>               </div>               <p>Whether the targetJoint/tipJoint should be changed if the tooltip is not in the viewport anymore.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">containInViewport: </span><span class="kc">true</span></pre></div>             </td>           </tr>                               <tr id="section-147">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-147">&#182;</a>               </div>               <p>If set to true, offsets are calculated automatically to position the tooltip. (pixels are added if there are stems for example)</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">autoOffset: </span><span class="kc">true</span>

    <span class="nv">showEffect: </span><span class="s">&quot;appear&quot;</span>
    <span class="nv">hideEffect: </span><span class="s">&quot;fade&quot;</span>
    <span class="nv">showEffectDuration: </span><span class="mf">0.3</span>
    <span class="nv">hideEffectDuration: </span><span class="mf">0.2</span></pre></div>             </td>           </tr>                               <tr id="section-148">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-148">&#182;</a>               </div>               <p>integer</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">stemLength: </span><span class="mi">5</span></pre></div>             </td>           </tr>                               <tr id="section-149">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-149">&#182;</a>               </div>               <p>integer</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">stemBase: </span><span class="mi">8</span></pre></div>             </td>           </tr>                               <tr id="section-150">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-150">&#182;</a>               </div>               <p><code>POINTER</code></p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">tipJoint: </span><span class="s">&quot;top left&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-151">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-151">&#182;</a>               </div>               <ul>
<li><code>null</code> (no target, opentip uses mouse as target)</li>
<li><code>true</code> (target is the triggerElement)</li>
<li><code>ELEMENT</code> (for another element)</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">target: </span><span class="kc">null</span> </pre></div>             </td>           </tr>                               <tr id="section-152">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-152">&#182;</a>               </div>               <ul>
<li><code>POINTER</code> (Ignored if target == <code>null</code>)</li>
<li><code>null</code> (targetJoint is the opposite of tipJoint)</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">targetJoint: </span><span class="kc">null</span> </pre></div>             </td>           </tr>                               <tr id="section-153">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-153">&#182;</a>               </div>               <p>AJAX URL
Set to <code>false</code> if no AJAX or <code>true</code> if it's attached to an <code>&lt;a /&gt;</code>
element. In the latter case the <code>href</code> attribute will be used.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">ajax: </span><span class="kc">off</span></pre></div>             </td>           </tr>                               <tr id="section-154">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-154">&#182;</a>               </div>               <p>Which method should AJAX use.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">ajaxMethod: </span><span class="s">&quot;GET&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-155">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-155">&#182;</a>               </div>               <p>If off, the content will be downloaded every time the tooltip is shown.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">ajaxCache: </span><span class="kc">on</span></pre></div>             </td>           </tr>                               <tr id="section-156">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-156">&#182;</a>               </div>               <p>You can group opentips together. So when a tooltip shows, it looks if there are others in the same group, and hides them.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">group: </span><span class="kc">null</span></pre></div>             </td>           </tr>                               <tr id="section-157">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-157">&#182;</a>               </div>               <p>Will be set automatically in constructor</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">style: </span><span class="kc">null</span></pre></div>             </td>           </tr>                               <tr id="section-158">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-158">&#182;</a>               </div>               <p>The background color of the tip</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">background: </span><span class="s">&quot;</span><span class="err">#</span><span class="s">fff18f&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-159">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-159">&#182;</a>               </div>               <p>Whether the gradient should be horizontal.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">backgroundGradientHorizontal: </span><span class="kc">no</span></pre></div>             </td>           </tr>                               <tr id="section-160">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-160">&#182;</a>               </div>               <p>Positive values offset inside the tooltip</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">closeButtonOffset: </span><span class="p">[</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span> <span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-161">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-161">&#182;</a>               </div>               <p>The little circle that stick out of a tip</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">closeButtonRadius: </span><span class="mi">7</span></pre></div>             </td>           </tr>                               <tr id="section-162">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-162">&#182;</a>               </div>               <p>Size of the cross</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">closeButtonCrossSize: </span><span class="mi">4</span></pre></div>             </td>           </tr>                               <tr id="section-163">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-163">&#182;</a>               </div>               <p>Color of the cross</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">closeButtonCrossColor: </span><span class="s">&quot;</span><span class="err">#</span><span class="s">d2c35b&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-164">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-164">&#182;</a>               </div>               <p>The stroke width of the cross</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">closeButtonCrossLineWidth: </span><span class="mf">1.5</span></pre></div>             </td>           </tr>                               <tr id="section-165">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-165">&#182;</a>               </div>               <p>You will most probably never want to change this.
It specifies how many pixels the invisible <a> element should be larger
than the actual cross</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">closeButtonLinkOverscan: </span><span class="mi">6</span></pre></div>             </td>           </tr>                               <tr id="section-166">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-166">&#182;</a>               </div>               <p>Border radius...</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">borderRadius: </span><span class="mi">5</span></pre></div>             </td>           </tr>                               <tr id="section-167">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-167">&#182;</a>               </div>               <p>Set to 0 or false if you don't want a border</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">borderWidth: </span><span class="mi">1</span></pre></div>             </td>           </tr>                               <tr id="section-168">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-168">&#182;</a>               </div>               <p>Normal CSS value</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">borderColor: </span><span class="s">&quot;</span><span class="err">#</span><span class="s">f2e37b&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-169">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-169">&#182;</a>               </div>               <p>Set to false if you don't want a shadow</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">shadow: </span><span class="kc">yes</span></pre></div>             </td>           </tr>                               <tr id="section-170">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-170">&#182;</a>               </div>               <p>How the shadow should be blurred. Set to 0 if you want a hard drop shadow </p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">shadowBlur: </span><span class="mi">10</span></pre></div>             </td>           </tr>                               <tr id="section-171">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-171">&#182;</a>               </div>               <p>Shadow offset...</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">shadowOffset: </span><span class="p">[</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span> <span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-172">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-172">&#182;</a>               </div>               <p>Shadow color...</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">shadowColor: </span><span class="s">&quot;rgba(0, 0, 0, 0.1)&quot;</span>

  <span class="nv">slick:</span>
    <span class="nv">className: </span><span class="s">&quot;slick&quot;</span>
    <span class="nv">stem: </span><span class="kc">true</span>
  <span class="nv">rounded:</span>
    <span class="nv">className: </span><span class="s">&quot;rounded&quot;</span>
    <span class="nv">stem: </span><span class="kc">true</span>
  <span class="nv">glass:</span>
    <span class="nv">className: </span><span class="s">&quot;glass&quot;</span>
  <span class="nv">dark:</span>
    <span class="nv">className: </span><span class="s">&quot;dark&quot;</span>
    <span class="nv">borderRadius: </span><span class="mi">13</span>
    <span class="nv">borderColor: </span><span class="s">&quot;</span><span class="err">#</span><span class="s">444&quot;</span>

    <span class="nv">closeButtonCrossColor: </span><span class="s">&quot;rgba(240, 240, 240, 1)&quot;</span>

    <span class="nv">shadowColor: </span><span class="s">&quot;rgba(0, 0, 0, 0.3)&quot;</span>
    <span class="nv">shadowOffset: </span><span class="p">[</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span> <span class="p">]</span>
    <span class="nv">background: </span><span class="p">[</span>
      <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;rgba(30, 30, 30, 0.7)&quot;</span> <span class="p">]</span>
      <span class="p">[</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s">&quot;rgba(30, 30, 30, 0.8)&quot;</span> <span class="p">]</span>
      <span class="p">[</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s">&quot;rgba(10, 10, 10, 0.8)&quot;</span> <span class="p">]</span>
      <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;rgba(10, 10, 10, 0.9)&quot;</span> <span class="p">]</span>
    <span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-173">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-173">&#182;</a>               </div>               <p>Change this to the style name you want all your tooltips to have as default.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">Opentip.defaultStyle = </span><span class="s">&quot;standard&quot;</span>



<span class="nb">window</span><span class="p">.</span><span class="nv">Opentip = </span><span class="nx">Opentip</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 