var Twig=function(Twig){return Twig.VERSION="0.8.9",Twig}(Twig||{}),Twig=function(Twig){"use strict";function is(type,obj){var clas=Object.prototype.toString.call(obj).slice(8,-1);return void 0!==obj&&null!==obj&&clas===type}return Twig.trace=!1,Twig.debug=!1,Twig.cache=!0,Twig.placeholders={parent:"{{|PARENT|}}"},Twig.indexOf=function(arr,searchElement){if(Array.prototype.hasOwnProperty("indexOf"))return arr.indexOf(searchElement);if(void 0===arr||null===arr)throw new TypeError;var t=Object(arr),len=t.length>>>0;if(0===len)return-1;var n=0;if(arguments.length>0&&(n=Number(arguments[1]),n!==n?n=0:0!==n&&n!==1/0&&n!==-(1/0)&&(n=(n>0||-1)*Math.floor(Math.abs(n)))),n>=len)return-1;for(var k=n>=0?n:Math.max(len-Math.abs(n),0);k<len;k++)if(k in t&&t[k]===searchElement)return k;return arr==searchElement?0:-1},Twig.forEach=function(arr,callback,thisArg){if(Array.prototype.forEach)return arr.forEach(callback,thisArg);var T,k;if(null==arr)throw new TypeError(" this is null or not defined");var O=Object(arr),len=O.length>>>0;if("[object Function]"!={}.toString.call(callback))throw new TypeError(callback+" is not a function");for(thisArg&&(T=thisArg),k=0;k<len;){var kValue;k in O&&(kValue=O[k],callback.call(T,kValue,k,O)),k++}},Twig.merge=function(target,source,onlyChanged){return Twig.forEach(Object.keys(source),function(key){(!onlyChanged||key in target)&&(target[key]=source[key])}),target},Twig.Error=function(message){this.message=message,this.name="TwigException",this.type="TwigException"},Twig.Error.prototype.toString=function(){var output=this.name+": "+this.message;return output},Twig.log={trace:function(){Twig.trace&&console&&console.log(Array.prototype.slice.call(arguments))},debug:function(){Twig.debug&&console&&console.log(Array.prototype.slice.call(arguments))}},"undefined"!=typeof console?"undefined"!=typeof console.error?Twig.log.error=function(){console.error.apply(console,arguments)}:"undefined"!=typeof console.log&&(Twig.log.error=function(){console.log.apply(console,arguments)}):Twig.log.error=function(){},Twig.ChildContext=function(context){var ChildContext=function(){};return ChildContext.prototype=context,new ChildContext},Twig.token={},Twig.token.type={output:"output",logic:"logic",comment:"comment",raw:"raw",output_whitespace_pre:"output_whitespace_pre",output_whitespace_post:"output_whitespace_post",output_whitespace_both:"output_whitespace_both",logic_whitespace_pre:"logic_whitespace_pre",logic_whitespace_post:"logic_whitespace_post",logic_whitespace_both:"logic_whitespace_both"},Twig.token.definitions=[{type:Twig.token.type.raw,open:"{% raw %}",close:"{% endraw %}"},{type:Twig.token.type.raw,open:"{% verbatim %}",close:"{% endverbatim %}"},{type:Twig.token.type.output_whitespace_pre,open:"{{-",close:"}}"},{type:Twig.token.type.output_whitespace_post,open:"{{",close:"-}}"},{type:Twig.token.type.output_whitespace_both,open:"{{-",close:"-}}"},{type:Twig.token.type.logic_whitespace_pre,open:"{%-",close:"%}"},{type:Twig.token.type.logic_whitespace_post,open:"{%",close:"-%}"},{type:Twig.token.type.logic_whitespace_both,open:"{%-",close:"-%}"},{type:Twig.token.type.output,open:"{{",close:"}}"},{type:Twig.token.type.logic,open:"{%",close:"%}"},{type:Twig.token.type.comment,open:"{#",close:"#}"}],Twig.token.strings=['"',"'"],Twig.token.findStart=function(template){var i,token_template,first_key_position,close_key_position,output={position:null,close_position:null,def:null};for(i=0;i<Twig.token.definitions.length;i++)token_template=Twig.token.definitions[i],first_key_position=template.indexOf(token_template.open),close_key_position=template.indexOf(token_template.close),Twig.log.trace("Twig.token.findStart: ","Searching for ",token_template.open," found at ",first_key_position),first_key_position>=0&&token_template.open.length!==token_template.close.length&&close_key_position<0||(first_key_position>=0&&(null===output.position||first_key_position<output.position)?(output.position=first_key_position,output.def=token_template,output.close_position=close_key_position):first_key_position>=0&&null!==output.position&&first_key_position===output.position&&(token_template.open.length>output.def.open.length?(output.position=first_key_position,output.def=token_template,output.close_position=close_key_position):token_template.open.length===output.def.open.length&&(token_template.close.length>output.def.close.length?close_key_position>=0&&close_key_position<output.close_position&&(output.position=first_key_position,output.def=token_template,output.close_position=close_key_position):close_key_position>=0&&close_key_position<output.close_position&&(output.position=first_key_position,output.def=token_template,output.close_position=close_key_position))));return delete output.close_position,output},Twig.token.findEnd=function(template,token_def,start){for(var i,l,end=null,found=!1,offset=0,str_pos=null,str_found=null,pos=null,end_offset=null,this_str_pos=null,end_str_pos=null;!found;){if(str_pos=null,str_found=null,pos=template.indexOf(token_def.close,offset),!(pos>=0))throw new Twig.Error("Unable to find closing bracket '"+token_def.close+"' opened near template position "+start);if(end=pos,found=!0,token_def.type===Twig.token.type.comment)break;if(token_def.type===Twig.token.type.raw)break;for(l=Twig.token.strings.length,i=0;i<l;i+=1)this_str_pos=template.indexOf(Twig.token.strings[i],offset),this_str_pos>0&&this_str_pos<pos&&(null===str_pos||this_str_pos<str_pos)&&(str_pos=this_str_pos,str_found=Twig.token.strings[i]);if(null!==str_pos)for(end_offset=str_pos+1,end=null,found=!1;;){if(end_str_pos=template.indexOf(str_found,end_offset),end_str_pos<0)throw"Unclosed string in template";if("\\"!==template.substr(end_str_pos-1,1)){offset=end_str_pos+1;break}end_offset=end_str_pos+1}}return end},Twig.tokenize=function(template){for(var tokens=[],error_offset=0,found_token=null,end=null;template.length>0;)if(found_token=Twig.token.findStart(template),Twig.log.trace("Twig.tokenize: ","Found token: ",found_token),null!==found_token.position){if(found_token.position>0&&tokens.push({type:Twig.token.type.raw,value:template.substring(0,found_token.position)}),template=template.substr(found_token.position+found_token.def.open.length),error_offset+=found_token.position+found_token.def.open.length,end=Twig.token.findEnd(template,found_token.def,error_offset),Twig.log.trace("Twig.tokenize: ","Token ends at ",end),tokens.push({type:found_token.def.type,value:template.substring(0,end).trim()}),"\n"===template.substr(end+found_token.def.close.length,1))switch(found_token.def.type){case"logic_whitespace_pre":case"logic_whitespace_post":case"logic_whitespace_both":case"logic":end+=1}template=template.substr(end+found_token.def.close.length),error_offset+=end+found_token.def.close.length}else tokens.push({type:Twig.token.type.raw,value:template}),template="";return tokens},Twig.compile=function(tokens){try{for(var output=[],stack=[],intermediate_output=[],token=null,logic_token=null,unclosed_token=null,prev_token=null,prev_output=null,prev_intermediate_output=null,prev_template=null,next_token=null,tok_output=null,type=null,open=null,next=null,compile_output=function(token){Twig.expression.compile.apply(this,[token]),stack.length>0?intermediate_output.push(token):output.push(token)},compile_logic=function(token){if(logic_token=Twig.logic.compile.apply(this,[token]),type=logic_token.type,open=Twig.logic.handler[type].open,next=Twig.logic.handler[type].next,Twig.log.trace("Twig.compile: ","Compiled logic token to ",logic_token," next is: ",next," open is : ",open),void 0!==open&&!open){if(prev_token=stack.pop(),prev_template=Twig.logic.handler[prev_token.type],Twig.indexOf(prev_template.next,type)<0)throw new Error(type+" not expected after a "+prev_token.type);prev_token.output=prev_token.output||[],prev_token.output=prev_token.output.concat(intermediate_output),intermediate_output=[],tok_output={type:Twig.token.type.logic,token:prev_token},stack.length>0?intermediate_output.push(tok_output):output.push(tok_output)}void 0!==next&&next.length>0?(Twig.log.trace("Twig.compile: ","Pushing ",logic_token," to logic stack."),stack.length>0&&(prev_token=stack.pop(),prev_token.output=prev_token.output||[],prev_token.output=prev_token.output.concat(intermediate_output),stack.push(prev_token),intermediate_output=[]),stack.push(logic_token)):void 0!==open&&open&&(tok_output={type:Twig.token.type.logic,token:logic_token},stack.length>0?intermediate_output.push(tok_output):output.push(tok_output))};tokens.length>0;){switch(token=tokens.shift(),prev_output=output[output.length-1],prev_intermediate_output=intermediate_output[intermediate_output.length-1],next_token=tokens[0],Twig.log.trace("Compiling token ",token),token.type){case Twig.token.type.raw:stack.length>0?intermediate_output.push(token):output.push(token);break;case Twig.token.type.logic:compile_logic.call(this,token);break;case Twig.token.type.comment:break;case Twig.token.type.output:compile_output.call(this,token);break;case Twig.token.type.logic_whitespace_pre:case Twig.token.type.logic_whitespace_post:case Twig.token.type.logic_whitespace_both:case Twig.token.type.output_whitespace_pre:case Twig.token.type.output_whitespace_post:case Twig.token.type.output_whitespace_both:switch(token.type!==Twig.token.type.output_whitespace_post&&token.type!==Twig.token.type.logic_whitespace_post&&(prev_output&&prev_output.type===Twig.token.type.raw&&(output.pop(),null===prev_output.value.match(/^\s*$/)&&(prev_output.value=prev_output.value.trim(),output.push(prev_output))),prev_intermediate_output&&prev_intermediate_output.type===Twig.token.type.raw&&(intermediate_output.pop(),null===prev_intermediate_output.value.match(/^\s*$/)&&(prev_intermediate_output.value=prev_intermediate_output.value.trim(),intermediate_output.push(prev_intermediate_output)))),token.type){case Twig.token.type.output_whitespace_pre:case Twig.token.type.output_whitespace_post:case Twig.token.type.output_whitespace_both:compile_output.call(this,token);break;case Twig.token.type.logic_whitespace_pre:case Twig.token.type.logic_whitespace_post:case Twig.token.type.logic_whitespace_both:compile_logic.call(this,token)}token.type!==Twig.token.type.output_whitespace_pre&&token.type!==Twig.token.type.logic_whitespace_pre&&next_token&&next_token.type===Twig.token.type.raw&&(tokens.shift(),null===next_token.value.match(/^\s*$/)&&(next_token.value=next_token.value.trim(),tokens.unshift(next_token)))}Twig.log.trace("Twig.compile: "," Output: ",output," Logic Stack: ",stack," Pending Output: ",intermediate_output)}if(stack.length>0)throw unclosed_token=stack.pop(),new Error("Unable to find an end tag for "+unclosed_token.type+", expecting one of "+unclosed_token.next);return output}catch(ex){if(Twig.log.error("Error compiling twig template "+this.id+": "),ex.stack?Twig.log.error(ex.stack):Twig.log.error(ex.toString()),this.options.rethrow)throw ex}},Twig.parse=function(tokens,context){try{var output=[],chain=!0,that=this;return Twig.forEach(tokens,function(token){switch(Twig.log.debug("Twig.parse: ","Parsing token: ",token),token.type){case Twig.token.type.raw:output.push(Twig.filters.raw(token.value));break;case Twig.token.type.logic:var logic_token=token.token,logic=Twig.logic.parse.apply(that,[logic_token,context,chain]);void 0!==logic.chain&&(chain=logic.chain),void 0!==logic.context&&(context=logic.context),void 0!==logic.output&&output.push(logic.output);break;case Twig.token.type.comment:break;case Twig.token.type.output_whitespace_pre:case Twig.token.type.output_whitespace_post:case Twig.token.type.output_whitespace_both:case Twig.token.type.output:Twig.log.debug("Twig.parse: ","Output token: ",token.stack),output.push(Twig.expression.parse.apply(that,[token.stack,context]))}}),Twig.output.apply(this,[output])}catch(ex){if(Twig.log.error("Error parsing twig template "+this.id+": "),ex.stack?Twig.log.error(ex.stack):Twig.log.error(ex.toString()),this.options.rethrow)throw ex;if(Twig.debug)return ex.toString()}},Twig.prepare=function(data){var tokens,raw_tokens;return Twig.log.debug("Twig.prepare: ","Tokenizing ",data),raw_tokens=Twig.tokenize.apply(this,[data]),Twig.log.debug("Twig.prepare: ","Compiling ",raw_tokens),tokens=Twig.compile.apply(this,[raw_tokens]),Twig.log.debug("Twig.prepare: ","Compiled ",tokens),tokens},Twig.output=function(output){if(!this.options.autoescape)return output.join("");var strategy="html";"string"==typeof this.options.autoescape&&(strategy=this.options.autoescape);var escaped_output=[];return Twig.forEach(output,function(str){str&&str.twig_markup!==!0&&str.twig_markup!=strategy&&(str=Twig.filters.escape(str,[strategy])),escaped_output.push(str)}),Twig.Markup(escaped_output.join(""))},Twig.Templates={loaders:{},parsers:{},registry:{}},Twig.validateId=function(id){if("prototype"===id)throw new Twig.Error(id+" is not a valid twig identifier");if(Twig.cache&&Twig.Templates.registry.hasOwnProperty(id))throw new Twig.Error("There is already a template with the ID "+id);return!0},Twig.Templates.registerLoader=function(method_name,func,scope){if("function"!=typeof func)throw new Twig.Error("Unable to add loader for "+method_name+": Invalid function reference given.");scope&&(func=func.bind(scope)),this.loaders[method_name]=func},Twig.Templates.unRegisterLoader=function(method_name){this.isRegisteredLoader(method_name)&&delete this.loaders[method_name]},Twig.Templates.isRegisteredLoader=function(method_name){return this.loaders.hasOwnProperty(method_name)},Twig.Templates.registerParser=function(method_name,func,scope){if("function"!=typeof func)throw new Twig.Error("Unable to add parser for "+method_name+": Invalid function regerence given.");scope&&(func=func.bind(scope)),this.parsers[method_name]=func},Twig.Templates.unRegisterParser=function(method_name){this.isRegisteredParser(method_name)&&delete this.parsers[method_name]},Twig.Templates.isRegisteredParser=function(method_name){return this.parsers.hasOwnProperty(method_name)},Twig.Templates.save=function(template){if(void 0===template.id)throw new Twig.Error("Unable to save template with no id");Twig.Templates.registry[template.id]=template},Twig.Templates.load=function(id){return Twig.Templates.registry.hasOwnProperty(id)?Twig.Templates.registry[id]:null},Twig.Templates.loadRemote=function(location,params,callback,error_callback){var loader;return void 0===params.async&&(params.async=!0),void 0===params.id&&(params.id=location),Twig.cache&&Twig.Templates.registry.hasOwnProperty(params.id)?("function"==typeof callback&&callback(Twig.Templates.registry[params.id]),Twig.Templates.registry[params.id]):(params.parser=params.parser||"twig",loader=this.loaders[params.method]||this.loaders.fs,loader.apply(this,arguments))},Twig.Template=function(params){var data=params.data,id=params.id,blocks=params.blocks,macros=params.macros||{},base=params.base,path=params.path,url=params.url,name=params.name,method=params.method,options=params.options;this.id=id,this.method=method,this.base=base,this.path=path,this.url=url,this.name=name,this.macros=macros,this.options=options,this.reset(blocks),is("String",data)?this.tokens=Twig.prepare.apply(this,[data]):this.tokens=data,void 0!==id&&Twig.Templates.save(this)},Twig.Template.prototype.reset=function(blocks){Twig.log.debug("Twig.Template.reset","Reseting template "+this.id),this.blocks={},this.importedBlocks=[],this.originalBlockTokens={},this.child={blocks:blocks||{}},this.extend=null},Twig.Template.prototype.render=function(context,params){params=params||{};var output,url;if(this.context=context||{},this.reset(),params.blocks&&(this.blocks=params.blocks),params.macros&&(this.macros=params.macros),output=Twig.parse.apply(this,[this.tokens,this.context]),this.extend){var ext_template;return this.options.allowInlineIncludes&&(ext_template=Twig.Templates.load(this.extend),ext_template&&(ext_template.options=this.options)),ext_template||(url=Twig.path.parsePath(this,this.extend),ext_template=Twig.Templates.loadRemote(url,{method:this.getLoaderMethod(),base:this.base,async:!1,id:url,options:this.options})),this.parent=ext_template,this.parent.render(this.context,{blocks:this.blocks})}return"blocks"==params.output?this.blocks:"macros"==params.output?this.macros:output},Twig.Template.prototype.importFile=function(file){var url,sub_template;if(!this.url&&this.options.allowInlineIncludes){if(file=this.path?this.path+"/"+file:file,sub_template=Twig.Templates.load(file),!sub_template&&(sub_template=Twig.Templates.loadRemote(url,{id:file,method:this.getLoaderMethod(),async:!1,options:this.options}),!sub_template))throw new Twig.Error("Unable to find the template "+file);return sub_template.options=this.options,sub_template}return url=Twig.path.parsePath(this,file),sub_template=Twig.Templates.loadRemote(url,{method:this.getLoaderMethod(),base:this.base,async:!1,options:this.options,id:url})},Twig.Template.prototype.importBlocks=function(file,override){var sub_template=this.importFile(file),context=this.context,that=this;override=override||!1,sub_template.render(context),Twig.forEach(Object.keys(sub_template.blocks),function(key){(override||void 0===that.blocks[key])&&(that.blocks[key]=sub_template.blocks[key],that.importedBlocks.push(key))})},Twig.Template.prototype.importMacros=function(file){var url=Twig.path.parsePath(this,file),remoteTemplate=Twig.Templates.loadRemote(url,{method:this.getLoaderMethod(),async:!1,id:url});return remoteTemplate},Twig.Template.prototype.getLoaderMethod=function(){return this.path?"fs":this.url?"ajax":this.method||"fs"},Twig.Template.prototype.compile=function(options){return Twig.compiler.compile(this,options)},Twig.Markup=function(content,strategy){return"undefined"==typeof strategy&&(strategy=!0),"string"==typeof content&&content.length>0&&(content=new String(content),content.twig_markup=strategy),content},Twig}(Twig||{});!function(Twig){"use strict";Twig.Templates.registerLoader("ajax",function(location,params,callback,error_callback){var template,xmlhttp,precompiled=params.precompiled,parser=this.parsers[params.parser]||this.parser.twig;if("undefined"==typeof XMLHttpRequest)throw new Twig.Error('Unsupported platform: Unable to do ajax requests because there is no "XMLHTTPRequest" implementation');return xmlhttp=new XMLHttpRequest,xmlhttp.onreadystatechange=function(){var data=null;4===xmlhttp.readyState&&(200===xmlhttp.status||window.cordova&&0==xmlhttp.status?(Twig.log.debug("Got template ",xmlhttp.responseText),data=precompiled===!0?JSON.parse(xmlhttp.responseText):xmlhttp.responseText,params.url=location,params.data=data,template=parser.call(this,params),"function"==typeof callback&&callback(template)):"function"==typeof error_callback&&error_callback(xmlhttp))},xmlhttp.open("GET",location,!!params.async),xmlhttp.send(),!!params.async||template})}(Twig),function(Twig){"use strict";var fs,path;try{fs=require("fs"),path=require("path")}catch(e){}Twig.Templates.registerLoader("fs",function(location,params,callback,error_callback){var template,data=null,precompiled=params.precompiled,parser=this.parsers[params.parser]||this.parser.twig;if(!fs||!path)throw new Twig.Error('Unsupported platform: Unable to load from file because there is no "fs" or "path" implementation');var loadTemplateFn=function(err,data){return err?void("function"==typeof error_callback&&error_callback(err)):(precompiled===!0&&(data=JSON.parse(data)),params.data=data,params.path=params.path||location,template=parser.call(this,params),void("function"==typeof callback&&callback(template)))};if(params.path=params.path||location,params.async)return fs.stat(params.path,function(err,stats){if(err||!stats.isFile())throw new Twig.Error("Unable to find template file "+location);fs.readFile(params.path,"utf8",loadTemplateFn)}),!0;if(!fs.statSync(params.path).isFile())throw new Twig.Error("Unable to find template file "+location);return data=fs.readFileSync(params.path,"utf8"),loadTemplateFn(void 0,data),template})}(Twig),function(Twig){"use strict";Twig.Templates.registerParser("source",function(params){return params.data||""})}(Twig),function(Twig){"use strict";Twig.Templates.registerParser("twig",function(params){return new Twig.Template(params)})}(Twig),function(){"use strict";String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),Object.keys||(Object.keys=function(o){if(o!==Object(o))throw new TypeError("Object.keys called on non-object");var p,ret=[];for(p in o)Object.prototype.hasOwnProperty.call(o,p)&&ret.push(p);return ret})}();var Twig=function(Twig){Twig.lib={};var sprintfLib=function(){function sprintf(){var key=arguments[0],cache=sprintf.cache;return cache[key]&&cache.hasOwnProperty(key)||(cache[key]=sprintf.parse(key)),sprintf.format.call(null,cache[key],arguments)}function get_type(variable){return Object.prototype.toString.call(variable).slice(8,-1).toLowerCase()}function str_repeat(input,multiplier){return Array(multiplier+1).join(input)}var re={not_string:/[^s]/,number:/[diefg]/,json:/[j]/,not_json:/[^j]/,text:/^[^\x25]+/,modulo:/^\x25{2}/,placeholder:/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-gijosuxX])/,key:/^([a-z_][a-z_\d]*)/i,key_access:/^\.([a-z_][a-z_\d]*)/i,index_access:/^\[(\d+)\]/,sign:/^[\+\-]/};sprintf.format=function(parse_tree,argv){var arg,i,k,match,pad,pad_character,pad_length,cursor=1,tree_length=parse_tree.length,node_type="",output=[],is_positive=!0,sign="";for(i=0;i<tree_length;i++)if(node_type=get_type(parse_tree[i]),"string"===node_type)output[output.length]=parse_tree[i];else if("array"===node_type){if(match=parse_tree[i],match[2])for(arg=argv[cursor],k=0;k<match[2].length;k++){if(!arg.hasOwnProperty(match[2][k]))throw new Error(sprintf("[sprintf] property '%s' does not exist",match[2][k]));arg=arg[match[2][k]]}else arg=match[1]?argv[match[1]]:argv[cursor++];if("function"==get_type(arg)&&(arg=arg()),re.not_string.test(match[8])&&re.not_json.test(match[8])&&"number"!=get_type(arg)&&isNaN(arg))throw new TypeError(sprintf("[sprintf] expecting number but found %s",get_type(arg)));switch(re.number.test(match[8])&&(is_positive=arg>=0),match[8]){case"b":arg=arg.toString(2);break;case"c":arg=String.fromCharCode(arg);break;case"d":case"i":arg=parseInt(arg,10);break;case"j":arg=JSON.stringify(arg,null,match[6]?parseInt(match[6]):0);break;case"e":arg=match[7]?arg.toExponential(match[7]):arg.toExponential();break;case"f":arg=match[7]?parseFloat(arg).toFixed(match[7]):parseFloat(arg);break;case"g":arg=match[7]?parseFloat(arg).toPrecision(match[7]):parseFloat(arg);break;case"o":arg=arg.toString(8);break;case"s":arg=(arg=String(arg))&&match[7]?arg.substring(0,match[7]):arg;break;case"u":arg>>>=0;break;case"x":arg=arg.toString(16);break;case"X":arg=arg.toString(16).toUpperCase()}re.json.test(match[8])?output[output.length]=arg:(!re.number.test(match[8])||is_positive&&!match[3]?sign="":(sign=is_positive?"+":"-",arg=arg.toString().replace(re.sign,"")),pad_character=match[4]?"0"===match[4]?"0":match[4].charAt(1):" ",pad_length=match[6]-(sign+arg).length,pad=match[6]&&pad_length>0?str_repeat(pad_character,pad_length):"",output[output.length]=match[5]?sign+arg+pad:"0"===pad_character?sign+pad+arg:pad+sign+arg)}return output.join("")},sprintf.cache={},sprintf.parse=function(fmt){for(var _fmt=fmt,match=[],parse_tree=[],arg_names=0;_fmt;){if(null!==(match=re.text.exec(_fmt)))parse_tree[parse_tree.length]=match[0];else if(null!==(match=re.modulo.exec(_fmt)))parse_tree[parse_tree.length]="%";else{if(null===(match=re.placeholder.exec(_fmt)))throw new SyntaxError("[sprintf] unexpected placeholder");if(match[2]){arg_names|=1;var field_list=[],replacement_field=match[2],field_match=[];if(null===(field_match=re.key.exec(replacement_field)))throw new SyntaxError("[sprintf] failed to parse named argument key");for(field_list[field_list.length]=field_match[1];""!==(replacement_field=replacement_field.substring(field_match[0].length));)if(null!==(field_match=re.key_access.exec(replacement_field)))field_list[field_list.length]=field_match[1];else{if(null===(field_match=re.index_access.exec(replacement_field)))throw new SyntaxError("[sprintf] failed to parse named argument key");field_list[field_list.length]=field_match[1]}match[2]=field_list}else arg_names|=2;if(3===arg_names)throw new Error("[sprintf] mixing positional and named placeholders is not (yet) supported");parse_tree[parse_tree.length]=match}_fmt=_fmt.substring(match[0].length)}return parse_tree};var vsprintf=function(fmt,argv,_argv){return _argv=(argv||[]).slice(0),_argv.splice(0,0,fmt),sprintf.apply(null,_argv)};return{sprintf:sprintf,vsprintf:vsprintf}}(),sprintf=sprintfLib.sprintf,vsprintf=sprintfLib.vsprintf;return Twig.lib.sprintf=sprintf,Twig.lib.vsprintf=vsprintf,function(){function getOrdinalFor(intNum){return(intNum=Math.abs(intNum)%100)%10==1&&11!=intNum?"st":intNum%10==2&&12!=intNum?"nd":intNum%10==3&&13!=intNum?"rd":"th"}function getISO8601Year(aDate){var d=new Date(aDate.getFullYear()+1,0,4);return(d-aDate)/864e5<7&&(aDate.getDay()+6)%7<(d.getDay()+6)%7?d.getFullYear():aDate.getMonth()>0||aDate.getDate()>=4?aDate.getFullYear():aDate.getFullYear()-((aDate.getDay()+6)%7-aDate.getDate()>2?1:0)}function getISO8601Week(aDate){var d=new Date(getISO8601Year(aDate),0,4);return d.setDate(d.getDate()-(d.getDay()+6)%7),parseInt((aDate-d)/6048e5)+1}var shortDays="Sun,Mon,Tue,Wed,Thu,Fri,Sat".split(","),fullDays="Sunday,Monday,Tuesday,Wednesday,Thursday,Friday,Saturday".split(","),shortMonths="Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sep,Oct,Nov,Dec".split(","),fullMonths="January,February,March,April,May,June,July,August,September,October,November,December".split(",");Twig.lib.formatDate=function(date,format){if("string"!=typeof format||/^\s*$/.test(format))return date+"";var jan1st=new Date(date.getFullYear(),0,1),me=date;return format.replace(/[dDjlNSwzWFmMntLoYyaABgGhHisuU]/g,function(option){switch(option){case"d":return("0"+me.getDate()).replace(/^.+(..)$/,"$1");case"D":return shortDays[me.getDay()];case"j":return me.getDate();case"l":return fullDays[me.getDay()];case"N":return(me.getDay()+6)%7+1;case"S":return getOrdinalFor(me.getDate());case"w":return me.getDay();case"z":return Math.ceil((jan1st-me)/864e5);case"W":return("0"+getISO8601Week(me)).replace(/^.(..)$/,"$1");case"F":return fullMonths[me.getMonth()];case"m":return("0"+(me.getMonth()+1)).replace(/^.+(..)$/,"$1");case"M":return shortMonths[me.getMonth()];case"n":return me.getMonth()+1;case"t":return new Date(me.getFullYear(),me.getMonth()+1,(-1)).getDate();case"L":return 29==new Date(me.getFullYear(),1,29).getDate()?1:0;case"o":return getISO8601Year(me);case"Y":return me.getFullYear();case"y":return(me.getFullYear()+"").replace(/^.+(..)$/,"$1");case"a":return me.getHours()<12?"am":"pm";case"A":return me.getHours()<12?"AM":"PM";case"B":return Math.floor(1e3*((me.getUTCHours()+1)%24+me.getUTCMinutes()/60+me.getUTCSeconds()/3600)/24);case"g":return me.getHours()%12!=0?me.getHours()%12:12;case"G":return me.getHours();case"h":return("0"+(me.getHours()%12!=0?me.getHours()%12:12)).replace(/^.+(..)$/,"$1");case"H":return("0"+me.getHours()).replace(/^.+(..)$/,"$1");case"i":return("0"+me.getMinutes()).replace(/^.+(..)$/,"$1");case"s":return("0"+me.getSeconds()).replace(/^.+(..)$/,"$1");case"u":return me.getMilliseconds();case"U":return me.getTime()/1e3}})}}(),Twig.lib.strip_tags=function(input,allowed){allowed=(((allowed||"")+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join("");var tags=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,commentsAndPhpTags=/<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi;return input.replace(commentsAndPhpTags,"").replace(tags,function($0,$1){return allowed.indexOf("<"+$1.toLowerCase()+">")>-1?$0:""})},Twig.lib.parseISO8601Date=function(s){var re=/(\d{4})-(\d\d)-(\d\d)T(\d\d):(\d\d):(\d\d)(\.\d+)?(Z|([+-])(\d\d):(\d\d))/,d=[];if(d=s.match(re),!d)throw"Couldn't parse ISO 8601 date string '"+s+"'";var a=[1,2,3,4,5,6,10,11];for(var i in a)d[a[i]]=parseInt(d[a[i]],10);d[7]=parseFloat(d[7]);var ms=Date.UTC(d[1],d[2]-1,d[3],d[4],d[5],d[6]);if(d[7]>0&&(ms+=Math.round(1e3*d[7])),"Z"!=d[8]&&d[10]){var offset=60*d[10]*60*1e3;d[11]&&(offset+=60*d[11]*1e3),"-"==d[9]?ms-=offset:ms+=offset}return new Date(ms)},Twig.lib.strtotime=function(text,now){function lastNext(type,range,modifier){var diff,day=days[range];"undefined"!=typeof day&&(diff=day-date.getDay(),0===diff?diff=7*modifier:diff>0&&"last"===type?diff-=7:diff<0&&"next"===type&&(diff+=7),date.setDate(date.getDate()+diff))}function process(val){var splt=val.split(" "),type=splt[0],range=splt[1].substring(0,3),typeIsNumber=/\d+/.test(type),ago="ago"===splt[2],num=("last"===type?-1:1)*(ago?-1:1);if(typeIsNumber&&(num*=parseInt(type,10)),ranges.hasOwnProperty(range)&&!splt[1].match(/^mon(day|\.)?$/i))return date["set"+ranges[range]](date["get"+ranges[range]]()+num);if("wee"===range)return date.setDate(date.getDate()+7*num);if("next"===type||"last"===type)lastNext(type,range,num);else if(!typeIsNumber)return!1;return!0}var parsed,match,today,year,date,days,ranges,len,times,regex,i,fail=!1;if(!text)return fail;if(text=text.replace(/^\s+|\s+$/g,"").replace(/\s{2,}/g," ").replace(/[\t\r\n]/g,"").toLowerCase(),match=text.match(/^(\d{1,4})([\-\.\/\:])(\d{1,2})([\-\.\/\:])(\d{1,4})(?:\s(\d{1,2}):(\d{2})?:?(\d{2})?)?(?:\s([A-Z]+)?)?$/),match&&match[2]===match[4])if(match[1]>1901)switch(match[2]){case"-":return match[3]>12||match[5]>31?fail:new Date(match[1],parseInt(match[3],10)-1,match[5],match[6]||0,match[7]||0,match[8]||0,match[9]||0)/1e3;case".":return fail;case"/":return match[3]>12||match[5]>31?fail:new Date(match[1],parseInt(match[3],10)-1,match[5],match[6]||0,match[7]||0,match[8]||0,match[9]||0)/1e3}else if(match[5]>1901)switch(match[2]){case"-":return match[3]>12||match[1]>31?fail:new Date(match[5],parseInt(match[3],10)-1,match[1],match[6]||0,match[7]||0,match[8]||0,match[9]||0)/1e3;case".":return match[3]>12||match[1]>31?fail:new Date(match[5],parseInt(match[3],10)-1,match[1],match[6]||0,match[7]||0,match[8]||0,match[9]||0)/1e3;case"/":return match[1]>12||match[3]>31?fail:new Date(match[5],parseInt(match[1],10)-1,match[3],match[6]||0,match[7]||0,match[8]||0,match[9]||0)/1e3}else switch(match[2]){case"-":return match[3]>12||match[5]>31||match[1]<70&&match[1]>38?fail:(year=match[1]>=0&&match[1]<=38?+match[1]+2e3:match[1],new Date(year,parseInt(match[3],10)-1,match[5],match[6]||0,match[7]||0,match[8]||0,match[9]||0)/1e3);case".":return match[5]>=70?match[3]>12||match[1]>31?fail:new Date(match[5],parseInt(match[3],10)-1,match[1],match[6]||0,match[7]||0,match[8]||0,match[9]||0)/1e3:match[5]<60&&!match[6]?match[1]>23||match[3]>59?fail:(today=new Date,new Date(today.getFullYear(),today.getMonth(),today.getDate(),match[1]||0,match[3]||0,match[5]||0,match[9]||0)/1e3):fail;case"/":return match[1]>12||match[3]>31||match[5]<70&&match[5]>38?fail:(year=match[5]>=0&&match[5]<=38?+match[5]+2e3:match[5],new Date(year,parseInt(match[1],10)-1,match[3],match[6]||0,match[7]||0,match[8]||0,match[9]||0)/1e3);case":":return match[1]>23||match[3]>59||match[5]>59?fail:(today=new Date,new Date(today.getFullYear(),today.getMonth(),today.getDate(),match[1]||0,match[3]||0,match[5]||0)/1e3)}if("now"===text)return null===now||isNaN(now)?(new Date).getTime()/1e3|0:0|now;if(!isNaN(parsed=Date.parse(text)))return parsed/1e3|0;if((match=text.match(/^([0-9]{4}-[0-9]{2}-[0-9]{2})[ t]([0-9]{2}:[0-9]{2}:[0-9]{2}(\.[0-9]+)?)([\+-][0-9]{2}(:[0-9]{2})?|z)/))&&("z"==match[4]?match[4]="Z":match[4].match(/^([\+-][0-9]{2})$/)&&(match[4]=match[4]+":00"),!isNaN(parsed=Date.parse(match[1]+"T"+match[2]+match[4]))))return parsed/1e3|0;if(date=now?new Date(1e3*now):new Date,days={sun:0,mon:1,tue:2,wed:3,thu:4,fri:5,sat:6},ranges={yea:"FullYear",mon:"Month",day:"Date",hou:"Hours",min:"Minutes",sec:"Seconds"},times="(years?|months?|weeks?|days?|hours?|minutes?|min|seconds?|sec|sunday|sun\\.?|monday|mon\\.?|tuesday|tue\\.?|wednesday|wed\\.?|thursday|thu\\.?|friday|fri\\.?|saturday|sat\\.?)",regex="([+-]?\\d+\\s"+times+"|(last|next)\\s"+times+")(\\sago)?",
match=text.match(new RegExp(regex,"gi")),!match)return fail;for(i=0,len=match.length;i<len;i++)if(!process(match[i]))return fail;return date.getTime()/1e3},Twig.lib.is=function(type,obj){var clas=Object.prototype.toString.call(obj).slice(8,-1);return void 0!==obj&&null!==obj&&clas===type},Twig.lib.copy=function(src){var key,target={};for(key in src)target[key]=src[key];return target},Twig.lib.replaceAll=function(string,search,replace){return string.split(search).join(replace)},Twig.lib.chunkArray=function(arr,size){var returnVal=[],x=0,len=arr.length;if(size<1||!Twig.lib.is("Array",arr))return[];for(;x<len;)returnVal.push(arr.slice(x,x+=size));return returnVal},Twig.lib.round=function(value,precision,mode){var m,f,isHalf,sgn;if(precision|=0,m=Math.pow(10,precision),value*=m,sgn=value>0|-(value<0),isHalf=value%1===.5*sgn,f=Math.floor(value),isHalf)switch(mode){case"PHP_ROUND_HALF_DOWN":value=f+(sgn<0);break;case"PHP_ROUND_HALF_EVEN":value=f+f%2*sgn;break;case"PHP_ROUND_HALF_ODD":value=f+!(f%2);break;default:value=f+(sgn>0)}return(isHalf?value:Math.round(value))/m},Twig.lib.max=function(){var ar,retVal,i=0,n=0,argv=arguments,argc=argv.length,_obj2Array=function(obj){if("[object Array]"===Object.prototype.toString.call(obj))return obj;var ar=[];for(var i in obj)obj.hasOwnProperty(i)&&ar.push(obj[i]);return ar},_compare=function(current,next){var i=0,n=0,tmp=0,nl=0,cl=0;if(current===next)return 0;if("object"==typeof current){if("object"==typeof next){if(current=_obj2Array(current),next=_obj2Array(next),cl=current.length,nl=next.length,nl>cl)return 1;if(nl<cl)return-1;for(i=0,n=cl;i<n;++i){if(tmp=_compare(current[i],next[i]),1==tmp)return 1;if(tmp==-1)return-1}return 0}return-1}return"object"==typeof next?1:isNaN(next)&&!isNaN(current)?0==current?0:current<0?1:-1:isNaN(current)&&!isNaN(next)?0==next?0:next>0?1:-1:next==current?0:next>current?1:-1};if(0===argc)throw new Error("At least one value should be passed to max()");if(1===argc){if("object"!=typeof argv[0])throw new Error("Wrong parameter count for max()");if(ar=_obj2Array(argv[0]),0===ar.length)throw new Error("Array must contain at least one element for max()")}else ar=argv;for(retVal=ar[0],i=1,n=ar.length;i<n;++i)1==_compare(retVal,ar[i])&&(retVal=ar[i]);return retVal},Twig.lib.min=function(){var ar,retVal,i=0,n=0,argv=arguments,argc=argv.length,_obj2Array=function(obj){if("[object Array]"===Object.prototype.toString.call(obj))return obj;var ar=[];for(var i in obj)obj.hasOwnProperty(i)&&ar.push(obj[i]);return ar},_compare=function(current,next){var i=0,n=0,tmp=0,nl=0,cl=0;if(current===next)return 0;if("object"==typeof current){if("object"==typeof next){if(current=_obj2Array(current),next=_obj2Array(next),cl=current.length,nl=next.length,nl>cl)return 1;if(nl<cl)return-1;for(i=0,n=cl;i<n;++i){if(tmp=_compare(current[i],next[i]),1==tmp)return 1;if(tmp==-1)return-1}return 0}return-1}return"object"==typeof next?1:isNaN(next)&&!isNaN(current)?0==current?0:current<0?1:-1:isNaN(current)&&!isNaN(next)?0==next?0:next>0?1:-1:next==current?0:next>current?1:-1};if(0===argc)throw new Error("At least one value should be passed to min()");if(1===argc){if("object"!=typeof argv[0])throw new Error("Wrong parameter count for min()");if(ar=_obj2Array(argv[0]),0===ar.length)throw new Error("Array must contain at least one element for min()")}else ar=argv;for(retVal=ar[0],i=1,n=ar.length;i<n;++i)_compare(retVal,ar[i])==-1&&(retVal=ar[i]);return retVal},Twig}(Twig||{}),Twig=function(Twig){"use strict";for(Twig.logic={},Twig.logic.type={if_:"Twig.logic.type.if",endif:"Twig.logic.type.endif",for_:"Twig.logic.type.for",endfor:"Twig.logic.type.endfor",else_:"Twig.logic.type.else",elseif:"Twig.logic.type.elseif",set:"Twig.logic.type.set",setcapture:"Twig.logic.type.setcapture",endset:"Twig.logic.type.endset",filter:"Twig.logic.type.filter",endfilter:"Twig.logic.type.endfilter",shortblock:"Twig.logic.type.shortblock",block:"Twig.logic.type.block",endblock:"Twig.logic.type.endblock",extends_:"Twig.logic.type.extends",use:"Twig.logic.type.use",include:"Twig.logic.type.include",spaceless:"Twig.logic.type.spaceless",endspaceless:"Twig.logic.type.endspaceless",macro:"Twig.logic.type.macro",endmacro:"Twig.logic.type.endmacro",import_:"Twig.logic.type.import",from:"Twig.logic.type.from",embed:"Twig.logic.type.embed",endembed:"Twig.logic.type.endembed"},Twig.logic.definitions=[{type:Twig.logic.type.if_,regex:/^if\s+([\s\S]+)$/,next:[Twig.logic.type.else_,Twig.logic.type.elseif,Twig.logic.type.endif],open:!0,compile:function(token){var expression=token.match[1];return token.stack=Twig.expression.compile.apply(this,[{type:Twig.expression.type.expression,value:expression}]).stack,delete token.match,token},parse:function(token,context,chain){var output="",result=Twig.expression.parse.apply(this,[token.stack,context]);return chain=!0,result&&(chain=!1,output=Twig.parse.apply(this,[token.output,context])),{chain:chain,output:output}}},{type:Twig.logic.type.elseif,regex:/^elseif\s+([^\s].*)$/,next:[Twig.logic.type.else_,Twig.logic.type.elseif,Twig.logic.type.endif],open:!1,compile:function(token){var expression=token.match[1];return token.stack=Twig.expression.compile.apply(this,[{type:Twig.expression.type.expression,value:expression}]).stack,delete token.match,token},parse:function(token,context,chain){var output="";return chain&&Twig.expression.parse.apply(this,[token.stack,context])===!0&&(chain=!1,output=Twig.parse.apply(this,[token.output,context])),{chain:chain,output:output}}},{type:Twig.logic.type.else_,regex:/^else$/,next:[Twig.logic.type.endif,Twig.logic.type.endfor],open:!1,parse:function(token,context,chain){var output="";return chain&&(output=Twig.parse.apply(this,[token.output,context])),{chain:chain,output:output}}},{type:Twig.logic.type.endif,regex:/^endif$/,next:[],open:!1},{type:Twig.logic.type.for_,regex:/^for\s+([a-zA-Z0-9_,\s]+)\s+in\s+([^\s].*?)(?:\s+if\s+([^\s].*))?$/,next:[Twig.logic.type.else_,Twig.logic.type.endfor],open:!0,compile:function(token){var key_value=token.match[1],expression=token.match[2],conditional=token.match[3],kv_split=null;if(token.key_var=null,token.value_var=null,key_value.indexOf(",")>=0){if(kv_split=key_value.split(","),2!==kv_split.length)throw new Twig.Error("Invalid expression in for loop: "+key_value);token.key_var=kv_split[0].trim(),token.value_var=kv_split[1].trim()}else token.value_var=key_value;return token.expression=Twig.expression.compile.apply(this,[{type:Twig.expression.type.expression,value:expression}]).stack,conditional&&(token.conditional=Twig.expression.compile.apply(this,[{type:Twig.expression.type.expression,value:conditional}]).stack),delete token.match,token},parse:function(token,context,continue_chain){var len,keyset,result=Twig.expression.parse.apply(this,[token.expression,context]),output=[],index=0,that=this,conditional=token.conditional,buildLoop=function(index,len){var isConditional=void 0!==conditional;return{index:index+1,index0:index,revindex:isConditional?void 0:len-index,revindex0:isConditional?void 0:len-index-1,first:0===index,last:isConditional?void 0:index===len-1,length:isConditional?void 0:len,parent:context}},loop=function(key,value){var inner_context=Twig.ChildContext(context);inner_context[token.value_var]=value,token.key_var&&(inner_context[token.key_var]=key),inner_context.loop=buildLoop(index,len),(void 0===conditional||Twig.expression.parse.apply(that,[conditional,inner_context]))&&(output.push(Twig.parse.apply(that,[token.output,inner_context])),index+=1),delete inner_context.loop,delete inner_context[token.value_var],delete inner_context[token.key_var],Twig.merge(context,inner_context,!0)};return Twig.lib.is("Array",result)?(len=result.length,Twig.forEach(result,function(value){var key=index;loop(key,value)})):Twig.lib.is("Object",result)&&(keyset=void 0!==result._keys?result._keys:Object.keys(result),len=keyset.length,Twig.forEach(keyset,function(key){"_keys"!==key&&loop(key,result[key])})),continue_chain=0===output.length,{chain:continue_chain,output:Twig.output.apply(this,[output])}}},{type:Twig.logic.type.endfor,regex:/^endfor$/,next:[],open:!1},{type:Twig.logic.type.set,regex:/^set\s+([a-zA-Z0-9_,\s]+)\s*=\s*([\s\S]+)$/,next:[],open:!0,compile:function(token){var key=token.match[1].trim(),expression=token.match[2],expression_stack=Twig.expression.compile.apply(this,[{type:Twig.expression.type.expression,value:expression}]).stack;return token.key=key,token.expression=expression_stack,delete token.match,token},parse:function(token,context,continue_chain){var value=Twig.expression.parse.apply(this,[token.expression,context]),key=token.key;return context[key]=value,{chain:continue_chain,context:context}}},{type:Twig.logic.type.setcapture,regex:/^set\s+([a-zA-Z0-9_,\s]+)$/,next:[Twig.logic.type.endset],open:!0,compile:function(token){var key=token.match[1].trim();return token.key=key,delete token.match,token},parse:function(token,context,continue_chain){var value=Twig.parse.apply(this,[token.output,context]),key=token.key;return this.context[key]=value,context[key]=value,{chain:continue_chain,context:context}}},{type:Twig.logic.type.endset,regex:/^endset$/,next:[],open:!1},{type:Twig.logic.type.filter,regex:/^filter\s+(.+)$/,next:[Twig.logic.type.endfilter],open:!0,compile:function(token){var expression="|"+token.match[1].trim();return token.stack=Twig.expression.compile.apply(this,[{type:Twig.expression.type.expression,value:expression}]).stack,delete token.match,token},parse:function(token,context,chain){var unfiltered=Twig.parse.apply(this,[token.output,context]),stack=[{type:Twig.expression.type.string,value:unfiltered}].concat(token.stack),output=Twig.expression.parse.apply(this,[stack,context]);return{chain:chain,output:output}}},{type:Twig.logic.type.endfilter,regex:/^endfilter$/,next:[],open:!1},{type:Twig.logic.type.block,regex:/^block\s+([a-zA-Z0-9_]+)$/,next:[Twig.logic.type.endblock],open:!0,compile:function(token){return token.block=token.match[1].trim(),delete token.match,token},parse:function(token,context,chain){var block_output,output,isImported=Twig.indexOf(this.importedBlocks,token.block)>-1,hasParent=this.blocks[token.block]&&Twig.indexOf(this.blocks[token.block],Twig.placeholders.parent)>-1;return(void 0===this.blocks[token.block]||isImported||hasParent||context.loop||token.overwrite)&&(block_output=token.expression?Twig.expression.parse.apply(this,[{type:Twig.expression.type.string,value:Twig.expression.parse.apply(this,[token.output,context])},context]):Twig.expression.parse.apply(this,[{type:Twig.expression.type.string,value:Twig.parse.apply(this,[token.output,context])},context]),isImported&&this.importedBlocks.splice(this.importedBlocks.indexOf(token.block),1),hasParent?this.blocks[token.block]=Twig.Markup(this.blocks[token.block].replace(Twig.placeholders.parent,block_output)):this.blocks[token.block]=block_output,this.originalBlockTokens[token.block]={type:token.type,block:token.block,output:token.output,overwrite:!0}),output=this.child.blocks[token.block]?this.child.blocks[token.block]:this.blocks[token.block],{chain:chain,output:output}}},{type:Twig.logic.type.shortblock,regex:/^block\s+([a-zA-Z0-9_]+)\s+(.+)$/,next:[],open:!0,compile:function(token){return token.expression=token.match[2].trim(),token.output=Twig.expression.compile({type:Twig.expression.type.expression,value:token.expression}).stack,token.block=token.match[1].trim(),delete token.match,token},parse:function(token,context,chain){return Twig.logic.handler[Twig.logic.type.block].parse.apply(this,arguments)}},{type:Twig.logic.type.endblock,regex:/^endblock(?:\s+([a-zA-Z0-9_]+))?$/,next:[],open:!1},{type:Twig.logic.type.extends_,regex:/^extends\s+(.+)$/,next:[],open:!0,compile:function(token){var expression=token.match[1].trim();return delete token.match,token.stack=Twig.expression.compile.apply(this,[{type:Twig.expression.type.expression,value:expression}]).stack,token},parse:function(token,context,chain){var file=Twig.expression.parse.apply(this,[token.stack,context]);return this.extend=file,{chain:chain,output:""}}},{type:Twig.logic.type.use,regex:/^use\s+(.+)$/,next:[],open:!0,compile:function(token){var expression=token.match[1].trim();return delete token.match,token.stack=Twig.expression.compile.apply(this,[{type:Twig.expression.type.expression,value:expression}]).stack,token},parse:function(token,context,chain){var file=Twig.expression.parse.apply(this,[token.stack,context]);return this.importBlocks(file),{chain:chain,output:""}}},{type:Twig.logic.type.include,regex:/^include\s+(ignore missing\s+)?(.+?)\s*(?:with\s+([\S\s]+?))?\s*(only)?$/,next:[],open:!0,compile:function(token){var match=token.match,includeMissing=void 0!==match[1],expression=match[2].trim(),withContext=match[3],only=void 0!==match[4]&&match[4].length;return delete token.match,token.only=only,token.includeMissing=includeMissing,token.stack=Twig.expression.compile.apply(this,[{type:Twig.expression.type.expression,value:expression}]).stack,void 0!==withContext&&(token.withStack=Twig.expression.compile.apply(this,[{type:Twig.expression.type.expression,value:withContext.trim()}]).stack),token},parse:function(token,context,chain){var withContext,i,template,innerContext={};if(token.only||(innerContext=Twig.ChildContext(context)),void 0!==token.withStack){withContext=Twig.expression.parse.apply(this,[token.withStack,context]);for(i in withContext)withContext.hasOwnProperty(i)&&(innerContext[i]=withContext[i])}var file=Twig.expression.parse.apply(this,[token.stack,innerContext]);return template=file instanceof Twig.Template?file:this.importFile(file),{chain:chain,output:template.render(innerContext)}}},{type:Twig.logic.type.spaceless,regex:/^spaceless$/,next:[Twig.logic.type.endspaceless],open:!0,parse:function(token,context,chain){var unfiltered=Twig.parse.apply(this,[token.output,context]),rBetweenTagSpaces=/>\s+</g,output=unfiltered.replace(rBetweenTagSpaces,"><").trim();return{chain:chain,output:output}}},{type:Twig.logic.type.endspaceless,regex:/^endspaceless$/,next:[],open:!1},{type:Twig.logic.type.macro,regex:/^macro\s+([a-zA-Z0-9_]+)\s*\(\s*((?:[a-zA-Z0-9_]+(?:,\s*)?)*)\s*\)$/,next:[Twig.logic.type.endmacro],open:!0,compile:function(token){for(var macroName=token.match[1],parameters=token.match[2].split(/[\s,]+/),i=0;i<parameters.length;i++)for(var j=0;j<parameters.length;j++)if(parameters[i]===parameters[j]&&i!==j)throw new Twig.Error("Duplicate arguments for parameter: "+parameters[i]);return token.macroName=macroName,token.parameters=parameters,delete token.match,token},parse:function(token,context,chain){var template=this;return this.macros[token.macroName]=function(){for(var macroContext={_self:template.macros},i=0;i<token.parameters.length;i++){var prop=token.parameters[i];"undefined"!=typeof arguments[i]?macroContext[prop]=arguments[i]:macroContext[prop]=void 0}return Twig.parse.apply(template,[token.output,macroContext])},{chain:chain,output:""}}},{type:Twig.logic.type.endmacro,regex:/^endmacro$/,next:[],open:!1},{type:Twig.logic.type.import_,regex:/^import\s+(.+)\s+as\s+([a-zA-Z0-9_]+)$/,next:[],open:!0,compile:function(token){var expression=token.match[1].trim(),contextName=token.match[2].trim();return delete token.match,token.expression=expression,token.contextName=contextName,token.stack=Twig.expression.compile.apply(this,[{type:Twig.expression.type.expression,value:expression}]).stack,token},parse:function(token,context,chain){if("_self"!==token.expression){var file=Twig.expression.parse.apply(this,[token.stack,context]),template=this.importFile(file||token.expression);context[token.contextName]=template.render({},{output:"macros"})}else context[token.contextName]=this.macros;return{chain:chain,output:""}}},{type:Twig.logic.type.from,regex:/^from\s+(.+)\s+import\s+([a-zA-Z0-9_, ]+)$/,next:[],open:!0,compile:function(token){for(var expression=token.match[1].trim(),macroExpressions=token.match[2].trim().split(/[ ,]+/),macroNames={},i=0;i<macroExpressions.length;i++){var res=macroExpressions[i],macroMatch=res.match(/^([a-zA-Z0-9_]+)\s+(.+)\s+as\s+([a-zA-Z0-9_]+)$/);macroMatch?macroNames[macroMatch[1].trim()]=macroMatch[2].trim():res.match(/^([a-zA-Z0-9_]+)$/)&&(macroNames[res]=res)}return delete token.match,token.expression=expression,token.macroNames=macroNames,token.stack=Twig.expression.compile.apply(this,[{type:Twig.expression.type.expression,value:expression}]).stack,token},parse:function(token,context,chain){var macros;if("_self"!==token.expression){var file=Twig.expression.parse.apply(this,[token.stack,context]),template=this.importFile(file||token.expression);macros=template.render({},{output:"macros"})}else macros=this.macros;for(var macroName in token.macroNames)macros.hasOwnProperty(macroName)&&(context[token.macroNames[macroName]]=macros[macroName]);return{chain:chain,output:""}}},{type:Twig.logic.type.embed,regex:/^embed\s+(ignore missing\s+)?(.+?)\s*(?:with\s+(.+?))?\s*(only)?$/,next:[Twig.logic.type.endembed],open:!0,compile:function(token){var match=token.match,includeMissing=void 0!==match[1],expression=match[2].trim(),withContext=match[3],only=void 0!==match[4]&&match[4].length;return delete token.match,token.only=only,token.includeMissing=includeMissing,token.stack=Twig.expression.compile.apply(this,[{type:Twig.expression.type.expression,value:expression}]).stack,void 0!==withContext&&(token.withStack=Twig.expression.compile.apply(this,[{type:Twig.expression.type.expression,value:withContext.trim()}]).stack),token},parse:function(token,context,chain){var withContext,i,template,innerContext={};if(!token.only)for(i in context)context.hasOwnProperty(i)&&(innerContext[i]=context[i]);if(void 0!==token.withStack){withContext=Twig.expression.parse.apply(this,[token.withStack,context]);for(i in withContext)withContext.hasOwnProperty(i)&&(innerContext[i]=withContext[i])}var file=Twig.expression.parse.apply(this,[token.stack,innerContext]);template=file instanceof Twig.Template?file:this.importFile(file),this.blocks={};Twig.parse.apply(this,[token.output,innerContext]);return{chain:chain,output:template.render(innerContext,{blocks:this.blocks})}}},{type:Twig.logic.type.endembed,regex:/^endembed$/,next:[],open:!1}],Twig.logic.handler={},Twig.logic.extendType=function(type,value){value=value||"Twig.logic.type"+type,Twig.logic.type[type]=value},Twig.logic.extend=function(definition){if(!definition.type)throw new Twig.Error("Unable to extend logic definition. No type provided for "+definition);Twig.logic.extendType(definition.type),Twig.logic.handler[definition.type]=definition};Twig.logic.definitions.length>0;)Twig.logic.extend(Twig.logic.definitions.shift());return Twig.logic.compile=function(raw_token){var expression=raw_token.value.trim(),token=Twig.logic.tokenize.apply(this,[expression]),token_template=Twig.logic.handler[token.type];return token_template.compile&&(token=token_template.compile.apply(this,[token]),Twig.log.trace("Twig.logic.compile: ","Compiled logic token to ",token)),token},Twig.logic.tokenize=function(expression){var token={},token_template_type=null,token_type=null,token_regex=null,regex_array=null,regex=null,match=null;expression=expression.trim();for(token_template_type in Twig.logic.handler)if(Twig.logic.handler.hasOwnProperty(token_template_type))for(token_type=Twig.logic.handler[token_template_type].type,token_regex=Twig.logic.handler[token_template_type].regex,regex_array=[],token_regex instanceof Array?regex_array=token_regex:regex_array.push(token_regex);regex_array.length>0;)if(regex=regex_array.shift(),match=regex.exec(expression.trim()),null!==match)return token.type=token_type,token.match=match,Twig.log.trace("Twig.logic.tokenize: ","Matched a ",token_type," regular expression of ",match),token;throw new Twig.Error("Unable to parse '"+expression.trim()+"'")},Twig.logic.parse=function(token,context,chain){var token_template,output="";return context=context||{},Twig.log.debug("Twig.logic.parse: ","Parsing logic token ",token),token_template=Twig.logic.handler[token.type],token_template.parse&&(output=token_template.parse.apply(this,[token,context,chain])),output},Twig}(Twig||{}),Twig=function(Twig){"use strict";Twig.expression={},Twig.expression.reservedWords=["true","false","null","TRUE","FALSE","NULL","_context"],Twig.expression.type={comma:"Twig.expression.type.comma",operator:{unary:"Twig.expression.type.operator.unary",binary:"Twig.expression.type.operator.binary"},string:"Twig.expression.type.string",bool:"Twig.expression.type.bool",array:{start:"Twig.expression.type.array.start",end:"Twig.expression.type.array.end"},object:{start:"Twig.expression.type.object.start",end:"Twig.expression.type.object.end"},parameter:{start:"Twig.expression.type.parameter.start",end:"Twig.expression.type.parameter.end"},key:{period:"Twig.expression.type.key.period",brackets:"Twig.expression.type.key.brackets"},filter:"Twig.expression.type.filter",_function:"Twig.expression.type._function",variable:"Twig.expression.type.variable",number:"Twig.expression.type.number",_null:"Twig.expression.type.null",context:"Twig.expression.type.context",test:"Twig.expression.type.test"},Twig.expression.set={operations:[Twig.expression.type.filter,Twig.expression.type.operator.unary,Twig.expression.type.operator.binary,Twig.expression.type.array.end,Twig.expression.type.object.end,Twig.expression.type.parameter.end,Twig.expression.type.comma,Twig.expression.type.test],expressions:[Twig.expression.type._function,Twig.expression.type.bool,Twig.expression.type.string,Twig.expression.type.variable,Twig.expression.type.number,Twig.expression.type._null,Twig.expression.type.context,Twig.expression.type.parameter.start,Twig.expression.type.array.start,Twig.expression.type.object.start]},Twig.expression.set.operations_extended=Twig.expression.set.operations.concat([Twig.expression.type.key.period,Twig.expression.type.key.brackets]),Twig.expression.fn={compile:{push:function(token,stack,output){output.push(token)},push_both:function(token,stack,output){output.push(token),stack.push(token)}},parse:{push:function(token,stack,context){stack.push(token)},push_value:function(token,stack,context){stack.push(token.value)}}},Twig.expression.definitions=[{type:Twig.expression.type.test,regex:/^is\s+(not)?\s*([a-zA-Z_][a-zA-Z0-9_]*)/,next:Twig.expression.set.operations.concat([Twig.expression.type.parameter.start]),compile:function(token,stack,output){token.filter=token.match[2],token.modifier=token.match[1],delete token.match,delete token.value,output.push(token)},parse:function(token,stack,context){var value=stack.pop(),params=token.params&&Twig.expression.parse.apply(this,[token.params,context]),result=Twig.test(token.filter,value,params);"not"==token.modifier?stack.push(!result):stack.push(result)}},{type:Twig.expression.type.comma,regex:/^,/,next:Twig.expression.set.expressions.concat([Twig.expression.type.array.end,Twig.expression.type.object.end]),compile:function(token,stack,output){var stack_token,i=stack.length-1;for(delete token.match,delete token.value;i>=0;i--){if(stack_token=stack.pop(),stack_token.type===Twig.expression.type.object.start||stack_token.type===Twig.expression.type.parameter.start||stack_token.type===Twig.expression.type.array.start){stack.push(stack_token);break}output.push(stack_token)}output.push(token)}},{type:Twig.expression.type.operator.binary,regex:/(^[\+\-~%\?\:]|^[!=]==?|^[!<>]=?|^\*\*?|^\/\/?|^and\s+|^or\s+|^in\s+|^not in\s+|^\.\.)/,next:Twig.expression.set.expressions.concat([Twig.expression.type.operator.unary]),compile:function(token,stack,output){delete token.match,token.value=token.value.trim();var value=token.value,operator=Twig.expression.operator.lookup(value,token);for(Twig.log.trace("Twig.expression.compile: ","Operator: ",operator," from ",value);stack.length>0&&(stack[stack.length-1].type==Twig.expression.type.operator.unary||stack[stack.length-1].type==Twig.expression.type.operator.binary)&&(operator.associativity===Twig.expression.operator.leftToRight&&operator.precidence>=stack[stack.length-1].precidence||operator.associativity===Twig.expression.operator.rightToLeft&&operator.precidence>stack[stack.length-1].precidence);){var temp=stack.pop();output.push(temp)}if(":"===value){if(!stack[stack.length-1]||"?"!==stack[stack.length-1].value){var key_token=output.pop();if(key_token.type===Twig.expression.type.string||key_token.type===Twig.expression.type.variable)token.key=key_token.value;else if(key_token.type===Twig.expression.type.number)token.key=key_token.value.toString();else{if(key_token.type!==Twig.expression.type.parameter.end||!key_token.expression)throw new Twig.Error("Unexpected value before ':' of "+key_token.type+" = "+key_token.value);token.params=key_token.params}return void output.push(token)}}else stack.push(operator)},parse:function(token,stack,context){token.key?stack.push(token):token.params?(token.key=Twig.expression.parse.apply(this,[token.params,context]),stack.push(token),delete token.params):Twig.expression.operator.parse(token.value,stack)}},{type:Twig.expression.type.operator.unary,regex:/(^not\s+)/,next:Twig.expression.set.expressions,compile:function(token,stack,output){delete token.match,token.value=token.value.trim();var value=token.value,operator=Twig.expression.operator.lookup(value,token);for(Twig.log.trace("Twig.expression.compile: ","Operator: ",operator," from ",value);stack.length>0&&(stack[stack.length-1].type==Twig.expression.type.operator.unary||stack[stack.length-1].type==Twig.expression.type.operator.binary)&&(operator.associativity===Twig.expression.operator.leftToRight&&operator.precidence>=stack[stack.length-1].precidence||operator.associativity===Twig.expression.operator.rightToLeft&&operator.precidence>stack[stack.length-1].precidence);){var temp=stack.pop();output.push(temp)}stack.push(operator)},parse:function(token,stack,context){Twig.expression.operator.parse(token.value,stack)}},{type:Twig.expression.type.string,regex:/^(["'])(?:(?=(\\?))\2[\s\S])*?\1/,next:Twig.expression.set.operations,compile:function(token,stack,output){var value=token.value;delete token.match,value='"'===value.substring(0,1)?value.replace('\\"','"'):value.replace("\\'","'"),token.value=value.substring(1,value.length-1).replace(/\\n/g,"\n").replace(/\\r/g,"\r"),Twig.log.trace("Twig.expression.compile: ","String value: ",token.value),output.push(token)},parse:Twig.expression.fn.parse.push_value},{type:Twig.expression.type.parameter.start,regex:/^\(/,next:Twig.expression.set.expressions.concat([Twig.expression.type.parameter.end]),compile:Twig.expression.fn.compile.push_both,parse:Twig.expression.fn.parse.push},{type:Twig.expression.type.parameter.end,regex:/^\)/,next:Twig.expression.set.operations_extended,compile:function(token,stack,output){var stack_token,end_token=token;for(stack_token=stack.pop();stack.length>0&&stack_token.type!=Twig.expression.type.parameter.start;)output.push(stack_token),stack_token=stack.pop();for(var param_stack=[];token.type!==Twig.expression.type.parameter.start;)param_stack.unshift(token),token=output.pop();param_stack.unshift(token);token=output[output.length-1],void 0===token||token.type!==Twig.expression.type._function&&token.type!==Twig.expression.type.filter&&token.type!==Twig.expression.type.test&&token.type!==Twig.expression.type.key.brackets&&token.type!==Twig.expression.type.key.period?(end_token.expression=!0,param_stack.pop(),param_stack.shift(),end_token.params=param_stack,output.push(end_token)):(end_token.expression=!1,token.params=param_stack)},parse:function(token,stack,context){var new_array=[],array_ended=!1,value=null;if(token.expression)value=Twig.expression.parse.apply(this,[token.params,context]),stack.push(value);else{for(;stack.length>0;){if(value=stack.pop(),value&&value.type&&value.type==Twig.expression.type.parameter.start){array_ended=!0;break}new_array.unshift(value)}if(!array_ended)throw new Twig.Error("Expected end of parameter set.");stack.push(new_array)}}},{type:Twig.expression.type.array.start,regex:/^\[/,next:Twig.expression.set.expressions.concat([Twig.expression.type.array.end]),compile:Twig.expression.fn.compile.push_both,parse:Twig.expression.fn.parse.push},{type:Twig.expression.type.array.end,regex:/^\]/,next:Twig.expression.set.operations_extended,compile:function(token,stack,output){for(var stack_token,i=stack.length-1;i>=0&&(stack_token=stack.pop(),stack_token.type!==Twig.expression.type.array.start);i--)output.push(stack_token);output.push(token)},parse:function(token,stack,context){for(var new_array=[],array_ended=!1,value=null;stack.length>0;){if(value=stack.pop(),value.type&&value.type==Twig.expression.type.array.start){array_ended=!0;break}new_array.unshift(value)}if(!array_ended)throw new Twig.Error("Expected end of array.");stack.push(new_array)}},{type:Twig.expression.type.object.start,regex:/^\{/,next:Twig.expression.set.expressions.concat([Twig.expression.type.object.end]),compile:Twig.expression.fn.compile.push_both,parse:Twig.expression.fn.parse.push},{type:Twig.expression.type.object.end,regex:/^\}/,next:Twig.expression.set.operations_extended,compile:function(token,stack,output){for(var stack_token,i=stack.length-1;i>=0&&(stack_token=stack.pop(),!stack_token||stack_token.type!==Twig.expression.type.object.start);i--)output.push(stack_token);output.push(token)},parse:function(end_token,stack,context){for(var new_object={},object_ended=!1,token=null,has_value=!1,value=null;stack.length>0;){if(token=stack.pop(),token&&token.type&&token.type===Twig.expression.type.object.start){object_ended=!0;break}if(token&&token.type&&(token.type===Twig.expression.type.operator.binary||token.type===Twig.expression.type.operator.unary)&&token.key){if(!has_value)throw new Twig.Error("Missing value for key '"+token.key+"' in object definition.");new_object[token.key]=value,void 0===new_object._keys&&(new_object._keys=[]),new_object._keys.unshift(token.key),value=null,has_value=!1}else has_value=!0,value=token}if(!object_ended)throw new Twig.Error("Unexpected end of object.");stack.push(new_object)}},{type:Twig.expression.type.filter,regex:/^\|\s?([a-zA-Z_][a-zA-Z0-9_\-]*)/,next:Twig.expression.set.operations_extended.concat([Twig.expression.type.parameter.start]),compile:function(token,stack,output){token.value=token.match[1],output.push(token)},parse:function(token,stack,context){var input=stack.pop(),params=token.params&&Twig.expression.parse.apply(this,[token.params,context]);stack.push(Twig.filter.apply(this,[token.value,input,params]))}},{type:Twig.expression.type._function,regex:/^([a-zA-Z_][a-zA-Z0-9_]*)\s*\(/,next:Twig.expression.type.parameter.start,transform:function(match,tokens){return"("},compile:function(token,stack,output){var fn=token.match[1];token.fn=fn,delete token.match,delete token.value,output.push(token)},parse:function(token,stack,context){var value,params=token.params&&Twig.expression.parse.apply(this,[token.params,context]),fn=token.fn;if(Twig.functions[fn])value=Twig.functions[fn].apply(this,params);else{if("function"!=typeof context[fn])throw new Twig.Error(fn+" function does not exist and is not defined in the context");value=context[fn].apply(context,params)}stack.push(value)}},{type:Twig.expression.type.variable,regex:/^[a-zA-Z_][a-zA-Z0-9_]*/,next:Twig.expression.set.operations_extended.concat([Twig.expression.type.parameter.start]),compile:Twig.expression.fn.compile.push,validate:function(match,tokens){return Twig.indexOf(Twig.expression.reservedWords,match[0])<0},parse:function(token,stack,context){var value=Twig.expression.resolve(context[token.value],context);stack.push(value)}},{type:Twig.expression.type.key.period,regex:/^\.([a-zA-Z0-9_]+)/,next:Twig.expression.set.operations_extended.concat([Twig.expression.type.parameter.start]),compile:function(token,stack,output){token.key=token.match[1],delete token.match,delete token.value,output.push(token)},parse:function(token,stack,context){var value,params=token.params&&Twig.expression.parse.apply(this,[token.params,context]),key=token.key,object=stack.pop();if(null===object||void 0===object){
if(this.options.strict_variables)throw new Twig.Error("Can't access a key "+key+" on an null or undefined object.");return null}var capitalize=function(value){return value.substr(0,1).toUpperCase()+value.substr(1)};value="object"==typeof object&&key in object?object[key]:void 0!==object["get"+capitalize(key)]?object["get"+capitalize(key)]:void 0!==object["is"+capitalize(key)]?object["is"+capitalize(key)]:void 0,stack.push(Twig.expression.resolve(value,object,params))}},{type:Twig.expression.type.key.brackets,regex:/^\[([^\]]*)\]/,next:Twig.expression.set.operations_extended.concat([Twig.expression.type.parameter.start]),compile:function(token,stack,output){var match=token.match[1];delete token.value,delete token.match,token.stack=Twig.expression.compile({value:match}).stack,output.push(token)},parse:function(token,stack,context){var value,params=token.params&&Twig.expression.parse.apply(this,[token.params,context]),key=Twig.expression.parse.apply(this,[token.stack,context]),object=stack.pop();if(null===object||void 0===object){if(this.options.strict_variables)throw new Twig.Error("Can't access a key "+key+" on an null or undefined object.");return null}value="object"==typeof object&&key in object?object[key]:null,stack.push(Twig.expression.resolve(value,object,params))}},{type:Twig.expression.type._null,regex:/^(null|NULL|none|NONE)/,next:Twig.expression.set.operations,compile:function(token,stack,output){delete token.match,token.value=null,output.push(token)},parse:Twig.expression.fn.parse.push_value},{type:Twig.expression.type.context,regex:/^_context/,next:Twig.expression.set.operations_extended.concat([Twig.expression.type.parameter.start]),compile:Twig.expression.fn.compile.push,parse:function(token,stack,context){stack.push(context)}},{type:Twig.expression.type.number,regex:/^\-?\d+(\.\d+)?/,next:Twig.expression.set.operations,compile:function(token,stack,output){token.value=Number(token.value),output.push(token)},parse:Twig.expression.fn.parse.push_value},{type:Twig.expression.type.bool,regex:/^(true|TRUE|false|FALSE)/,next:Twig.expression.set.operations,compile:function(token,stack,output){token.value="true"===token.match[0].toLowerCase(),delete token.match,output.push(token)},parse:Twig.expression.fn.parse.push_value}],Twig.expression.resolve=function(value,context,params){return"function"==typeof value?value.apply(context,params||[]):value},Twig.expression.handler={},Twig.expression.extendType=function(type){Twig.expression.type[type]="Twig.expression.type."+type},Twig.expression.extend=function(definition){if(!definition.type)throw new Twig.Error("Unable to extend logic definition. No type provided for "+definition);Twig.expression.handler[definition.type]=definition};for(;Twig.expression.definitions.length>0;)Twig.expression.extend(Twig.expression.definitions.shift());return Twig.expression.tokenize=function(expression){var type,regex,regex_array,token_next,match_found,match_function,tokens=[],exp_offset=0,next=null,invalid_matches=[];for(match_function=function(){var match=Array.prototype.slice.apply(arguments);match.pop(),match.pop();return Twig.log.trace("Twig.expression.tokenize","Matched a ",type," regular expression of ",match),next&&Twig.indexOf(next,type)<0?(invalid_matches.push(type+" cannot follow a "+tokens[tokens.length-1].type+" at template:"+exp_offset+" near '"+match[0].substring(0,20)+"...'"),match[0]):Twig.expression.handler[type].validate&&!Twig.expression.handler[type].validate(match,tokens)?match[0]:(invalid_matches=[],tokens.push({type:type,value:match[0],match:match}),match_found=!0,next=token_next,exp_offset+=match[0].length,Twig.expression.handler[type].transform?Twig.expression.handler[type].transform(match,tokens):"")},Twig.log.debug("Twig.expression.tokenize","Tokenizing expression ",expression);expression.length>0;){expression=expression.trim();for(type in Twig.expression.handler)if(Twig.expression.handler.hasOwnProperty(type)){for(token_next=Twig.expression.handler[type].next,regex=Twig.expression.handler[type].regex,regex_array=regex instanceof Array?regex:[regex],match_found=!1;regex_array.length>0;)regex=regex_array.pop(),expression=expression.replace(regex,match_function);if(match_found)break}if(!match_found)throw invalid_matches.length>0?new Twig.Error(invalid_matches.join(" OR ")):new Twig.Error("Unable to parse '"+expression+"' at template position"+exp_offset)}return Twig.log.trace("Twig.expression.tokenize","Tokenized to ",tokens),tokens},Twig.expression.compile=function(raw_token){var expression=raw_token.value,tokens=Twig.expression.tokenize(expression),token=null,output=[],stack=[],token_template=null;for(Twig.log.trace("Twig.expression.compile: ","Compiling ",expression);tokens.length>0;)token=tokens.shift(),token_template=Twig.expression.handler[token.type],Twig.log.trace("Twig.expression.compile: ","Compiling ",token),token_template.compile&&token_template.compile(token,stack,output),Twig.log.trace("Twig.expression.compile: ","Stack is",stack),Twig.log.trace("Twig.expression.compile: ","Output is",output);for(;stack.length>0;)output.push(stack.pop());return Twig.log.trace("Twig.expression.compile: ","Final output is",output),raw_token.stack=output,delete raw_token.value,raw_token},Twig.expression.parse=function(tokens,context){var that=this;tokens instanceof Array||(tokens=[tokens]);var stack=[],token_template=null;return Twig.forEach(tokens,function(token){token_template=Twig.expression.handler[token.type],token_template.parse&&token_template.parse.apply(that,[token,stack,context])}),stack.pop()},Twig}(Twig||{}),Twig=function(Twig){"use strict";Twig.expression.operator={leftToRight:"leftToRight",rightToLeft:"rightToLeft"};var containment=function(a,b){if(void 0===b||null===b)return null;if(void 0!==b.indexOf)return a===b||""!==a&&b.indexOf(a)>-1;var el;for(el in b)if(b.hasOwnProperty(el)&&b[el]===a)return!0;return!1};return Twig.expression.operator.lookup=function(operator,token){switch(operator){case"..":case"not in":case"in":token.precidence=20,token.associativity=Twig.expression.operator.leftToRight;break;case",":token.precidence=18,token.associativity=Twig.expression.operator.leftToRight;break;case"?":case":":token.precidence=16,token.associativity=Twig.expression.operator.rightToLeft;break;case"or":token.precidence=14,token.associativity=Twig.expression.operator.leftToRight;break;case"and":token.precidence=13,token.associativity=Twig.expression.operator.leftToRight;break;case"==":case"!=":token.precidence=9,token.associativity=Twig.expression.operator.leftToRight;break;case"<":case"<=":case">":case">=":token.precidence=8,token.associativity=Twig.expression.operator.leftToRight;break;case"~":case"+":case"-":token.precidence=6,token.associativity=Twig.expression.operator.leftToRight;break;case"//":case"**":case"*":case"/":case"%":token.precidence=5,token.associativity=Twig.expression.operator.leftToRight;break;case"not":token.precidence=3,token.associativity=Twig.expression.operator.rightToLeft;break;default:throw new Twig.Error(operator+" is an unknown operator.")}return token.operator=operator,token},Twig.expression.operator.parse=function(operator,stack){Twig.log.trace("Twig.expression.operator.parse: ","Handling ",operator);var a,b,c;switch(operator){case":":break;case"?":c=stack.pop(),b=stack.pop(),a=stack.pop(),a?stack.push(b):stack.push(c);break;case"+":b=parseFloat(stack.pop()),a=parseFloat(stack.pop()),stack.push(a+b);break;case"-":b=parseFloat(stack.pop()),a=parseFloat(stack.pop()),stack.push(a-b);break;case"*":b=parseFloat(stack.pop()),a=parseFloat(stack.pop()),stack.push(a*b);break;case"/":b=parseFloat(stack.pop()),a=parseFloat(stack.pop()),stack.push(a/b);break;case"//":b=parseFloat(stack.pop()),a=parseFloat(stack.pop()),stack.push(parseInt(a/b));break;case"%":b=parseFloat(stack.pop()),a=parseFloat(stack.pop()),stack.push(a%b);break;case"~":b=stack.pop(),a=stack.pop(),stack.push((null!=a?a.toString():"")+(null!=b?b.toString():""));break;case"not":case"!":stack.push(!stack.pop());break;case"<":b=stack.pop(),a=stack.pop(),stack.push(a<b);break;case"<=":b=stack.pop(),a=stack.pop(),stack.push(a<=b);break;case">":b=stack.pop(),a=stack.pop(),stack.push(a>b);break;case">=":b=stack.pop(),a=stack.pop(),stack.push(a>=b);break;case"===":b=stack.pop(),a=stack.pop(),stack.push(a===b);break;case"==":b=stack.pop(),a=stack.pop(),stack.push(a==b);break;case"!==":b=stack.pop(),a=stack.pop(),stack.push(a!==b);break;case"!=":b=stack.pop(),a=stack.pop(),stack.push(a!=b);break;case"or":b=stack.pop(),a=stack.pop(),stack.push(a||b);break;case"and":b=stack.pop(),a=stack.pop(),stack.push(a&&b);break;case"**":b=stack.pop(),a=stack.pop(),stack.push(Math.pow(a,b));break;case"not in":b=stack.pop(),a=stack.pop(),stack.push(!containment(a,b));break;case"in":b=stack.pop(),a=stack.pop(),stack.push(containment(a,b));break;case"..":b=stack.pop(),a=stack.pop(),stack.push(Twig.functions.range(a,b));break;default:throw new Twig.Error(operator+" is an unknown operator.")}},Twig}(Twig||{}),Twig=function(Twig){function is(type,obj){var clas=Object.prototype.toString.call(obj).slice(8,-1);return void 0!==obj&&null!==obj&&clas===type}return Twig.filters={upper:function(value){return"string"!=typeof value?value:value.toUpperCase()},lower:function(value){return"string"!=typeof value?value:value.toLowerCase()},capitalize:function(value){return"string"!=typeof value?value:value.substr(0,1).toUpperCase()+value.toLowerCase().substr(1)},title:function(value){return"string"!=typeof value?value:value.toLowerCase().replace(/(^|\s)([a-z])/g,function(m,p1,p2){return p1+p2.toUpperCase()})},length:function(value){return Twig.lib.is("Array",value)||"string"==typeof value?value.length:Twig.lib.is("Object",value)?void 0===value._keys?Object.keys(value).length:value._keys.length:0},reverse:function(value){if(is("Array",value))return value.reverse();if(is("String",value))return value.split("").reverse().join("");if(is("Object",value)){var keys=value._keys||Object.keys(value).reverse();return value._keys=keys,value}},sort:function(value){if(is("Array",value))return value.sort();if(is("Object",value)){delete value._keys;var keys=Object.keys(value),sorted_keys=keys.sort(function(a,b){var a1;return value[a]>value[b]==!(value[a]<=value[b])?value[a]>value[b]?1:value[a]<value[b]?-1:0:isNaN(a1=parseFloat(value[a]))||isNaN(b1=parseFloat(value[b]))?"string"==typeof value[a]?value[a]>value[b].toString()?1:value[a]<value[b].toString()?-1:0:"string"==typeof value[b]?value[a].toString()>value[b]?1:value[a].toString()<value[b]?-1:0:null:a1>b1?1:a1<b1?-1:0});return value._keys=sorted_keys,value}},keys:function(value){if(void 0!==value&&null!==value){var keyset=value._keys||Object.keys(value),output=[];return Twig.forEach(keyset,function(key){"_keys"!==key&&value.hasOwnProperty(key)&&output.push(key)}),output}},url_encode:function(value){if(void 0!==value&&null!==value){var result=encodeURIComponent(value);return result=result.replace("'","%27")}},join:function(value,params){if(void 0!==value&&null!==value){var join_str="",output=[],keyset=null;return params&&params[0]&&(join_str=params[0]),is("Array",value)?output=value:(keyset=value._keys||Object.keys(value),Twig.forEach(keyset,function(key){"_keys"!==key&&value.hasOwnProperty(key)&&output.push(value[key])})),output.join(join_str)}},"default":function(value,params){if(void 0!==params&&params.length>1)throw new Twig.Error("default filter expects one argument");return void 0===value||null===value||""===value?void 0===params?"":params[0]:value},json_encode:function(value){if(void 0===value||null===value)return"null";if("object"==typeof value&&is("Array",value))return output=[],Twig.forEach(value,function(v){output.push(Twig.filters.json_encode(v))}),"["+output.join(",")+"]";if("object"==typeof value){var keyset=value._keys||Object.keys(value),output=[];return Twig.forEach(keyset,function(key){output.push(JSON.stringify(key)+":"+Twig.filters.json_encode(value[key]))}),"{"+output.join(",")+"}"}return JSON.stringify(value)},merge:function(value,params){var obj=[],arr_index=0,keyset=[];if(is("Array",value)?Twig.forEach(params,function(param){is("Array",param)||(obj={})}):obj={},is("Array",obj)||(obj._keys=[]),is("Array",value)?Twig.forEach(value,function(val){obj._keys&&obj._keys.push(arr_index),obj[arr_index]=val,arr_index++}):(keyset=value._keys||Object.keys(value),Twig.forEach(keyset,function(key){obj[key]=value[key],obj._keys.push(key);var int_key=parseInt(key,10);!isNaN(int_key)&&int_key>=arr_index&&(arr_index=int_key+1)})),Twig.forEach(params,function(param){is("Array",param)?Twig.forEach(param,function(val){obj._keys&&obj._keys.push(arr_index),obj[arr_index]=val,arr_index++}):(keyset=param._keys||Object.keys(param),Twig.forEach(keyset,function(key){obj[key]||obj._keys.push(key),obj[key]=param[key];var int_key=parseInt(key,10);!isNaN(int_key)&&int_key>=arr_index&&(arr_index=int_key+1)}))}),0===params.length)throw new Twig.Error("Filter merge expects at least one parameter");return obj},date:function(value,params){var date=Twig.functions.date(value),format=params&&params.length?params[0]:"F j, Y H:i";return Twig.lib.formatDate(date,format)},date_modify:function(value,params){if(void 0!==value&&null!==value){if(void 0===params||1!==params.length)throw new Twig.Error("date_modify filter expects 1 argument");var time,modifyText=params[0];return Twig.lib.is("Date",value)&&(time=Twig.lib.strtotime(modifyText,value.getTime()/1e3)),Twig.lib.is("String",value)&&(time=Twig.lib.strtotime(modifyText,Twig.lib.strtotime(value))),Twig.lib.is("Number",value)&&(time=Twig.lib.strtotime(modifyText,value)),new Date(1e3*time)}},replace:function(value,params){if(void 0!==value&&null!==value){var tag,pairs=params[0];for(tag in pairs)pairs.hasOwnProperty(tag)&&"_keys"!==tag&&(value=Twig.lib.replaceAll(value,tag,pairs[tag]));return value}},format:function(value,params){if(void 0!==value&&null!==value)return Twig.lib.vsprintf(value,params)},striptags:function(value){if(void 0!==value&&null!==value)return Twig.lib.strip_tags(value)},escape:function(value,params){if(void 0!==value&&null!==value){var strategy="html";if(params&&params.length&&params[0]!==!0&&(strategy=params[0]),"html"==strategy){var raw_value=value.toString().replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;");return Twig.Markup(raw_value,"html")}if("js"==strategy){for(var raw_value=value.toString(),result="",i=0;i<raw_value.length;i++)if(raw_value[i].match(/^[a-zA-Z0-9,\._]$/))result+=raw_value[i];else{var char_code=raw_value.charCodeAt(i);result+=char_code<128?"\\x"+char_code.toString(16).toUpperCase():Twig.lib.sprintf("\\u%04s",char_code.toString(16).toUpperCase())}return Twig.Markup(result,"js")}if("css"==strategy){for(var raw_value=value.toString(),result="",i=0;i<raw_value.length;i++)if(raw_value[i].match(/^[a-zA-Z0-9]$/))result+=raw_value[i];else{var char_code=raw_value.charCodeAt(i);result+="\\"+char_code.toString(16).toUpperCase()+" "}return Twig.Markup(result,"css")}if("url"==strategy){var result=Twig.filters.url_encode(value);return Twig.Markup(result,"url")}if("html_attr"==strategy){for(var raw_value=value.toString(),result="",i=0;i<raw_value.length;i++)if(raw_value[i].match(/^[a-zA-Z0-9,\.\-_]$/))result+=raw_value[i];else if(raw_value[i].match(/^[&<>"]$/))result+=raw_value[i].replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;");else{var char_code=raw_value.charCodeAt(i);result+=char_code<=31&&9!=char_code&&10!=char_code&&13!=char_code?"&#xFFFD;":char_code<128?Twig.lib.sprintf("&#x%02s;",char_code.toString(16).toUpperCase()):Twig.lib.sprintf("&#x%04s;",char_code.toString(16).toUpperCase())}return Twig.Markup(result,"html_attr")}throw new Twig.Error("escape strategy unsupported")}},e:function(value,params){return Twig.filters.escape(value,params)},nl2br:function(value){if(void 0!==value&&null!==value){var linebreak_tag="BACKSLASH_n_replace",br="<br />"+linebreak_tag;return value=Twig.filters.escape(value).replace(/\r\n/g,br).replace(/\r/g,br).replace(/\n/g,br),value=Twig.lib.replaceAll(value,linebreak_tag,"\n"),Twig.Markup(value)}},number_format:function(value,params){var number=value,decimals=params&&params[0]?params[0]:void 0,dec=params&&void 0!==params[1]?params[1]:".",sep=params&&void 0!==params[2]?params[2]:",";number=(number+"").replace(/[^0-9+\-Ee.]/g,"");var n=isFinite(+number)?+number:0,prec=isFinite(+decimals)?Math.abs(decimals):0,s="",toFixedFix=function(n,prec){var k=Math.pow(10,prec);return""+Math.round(n*k)/k};return s=(prec?toFixedFix(n,prec):""+Math.round(n)).split("."),s[0].length>3&&(s[0]=s[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,sep)),(s[1]||"").length<prec&&(s[1]=s[1]||"",s[1]+=new Array(prec-s[1].length+1).join("0")),s.join(dec)},trim:function(value,params){if(void 0!==value&&null!==value){var whitespace,str=Twig.filters.escape(""+value);whitespace=params&&params[0]?""+params[0]:" \n\r\t\f\x0B\u2028\u2029";for(var i=0;i<str.length;i++)if(whitespace.indexOf(str.charAt(i))===-1){str=str.substring(i);break}for(i=str.length-1;i>=0;i--)if(whitespace.indexOf(str.charAt(i))===-1){str=str.substring(0,i+1);break}return whitespace.indexOf(str.charAt(0))===-1?str:""}},truncate:function(value,params){var length=30,preserve=!1,separator="...";if(value+="",params&&(params[0]&&(length=params[0]),params[1]&&(preserve=params[1]),params[2]&&(separator=params[2])),value.length>length){if(preserve&&(length=value.indexOf(" ",length),length===-1))return value;value=value.substr(0,length)+separator}return value},slice:function(value,params){if(void 0!==value&&null!==value){if(void 0===params||params.length<1)throw new Twig.Error("slice filter expects at least 1 argument");var start=params[0]||0,length=params.length>1?params[1]:value.length,startIndex=start>=0?start:Math.max(value.length+start,0);if(Twig.lib.is("Array",value)){for(var output=[],i=startIndex;i<startIndex+length&&i<value.length;i++)output.push(value[i]);return output}if(Twig.lib.is("String",value))return value.substr(startIndex,length);throw new Twig.Error("slice filter expects value to be an array or string")}},abs:function(value){if(void 0!==value&&null!==value)return Math.abs(value)},first:function(value){if(is("Array",value))return value[0];if(is("Object",value)){if("_keys"in value)return value[value._keys[0]]}else if("string"==typeof value)return value.substr(0,1)},split:function(value,params){if(void 0!==value&&null!==value){if(void 0===params||params.length<1||params.length>2)throw new Twig.Error("split filter expects 1 or 2 argument");if(Twig.lib.is("String",value)){var delimiter=params[0],limit=params[1],split=value.split(delimiter);if(void 0===limit)return split;if(limit<0)return value.split(delimiter,split.length+limit);var limitedSplit=[];if(""==delimiter)for(;split.length>0;){for(var temp="",i=0;i<limit&&split.length>0;i++)temp+=split.shift();limitedSplit.push(temp)}else{for(var i=0;i<limit-1&&split.length>0;i++)limitedSplit.push(split.shift());split.length>0&&limitedSplit.push(split.join(delimiter))}return limitedSplit}throw new Twig.Error("split filter expects value to be a string")}},last:function(value){if(Twig.lib.is("Object",value)){var keys;return keys=void 0===value._keys?Object.keys(value):value._keys,value[keys[keys.length-1]]}return value[value.length-1]},raw:function(value){return Twig.Markup(value)},batch:function(items,params){var result,last,missing,size=params.shift(),fill=params.shift();if(!Twig.lib.is("Array",items))throw new Twig.Error("batch filter expects items to be an array");if(!Twig.lib.is("Number",size))throw new Twig.Error("batch filter expects size to be a number");if(size=Math.ceil(size),result=Twig.lib.chunkArray(items,size),fill&&items.length%size!=0){for(last=result.pop(),missing=size-last.length;missing--;)last.push(fill);result.push(last)}return result},round:function(value,params){params=params||[];var precision=params.length>0?params[0]:0,method=params.length>1?params[1]:"common";if(value=parseFloat(value),precision&&!Twig.lib.is("Number",precision))throw new Twig.Error("round filter expects precision to be a number");if("common"===method)return Twig.lib.round(value,precision);if(!Twig.lib.is("Function",Math[method]))throw new Twig.Error("round filter expects method to be 'floor', 'ceil', or 'common'");return Math[method](value*Math.pow(10,precision))/Math.pow(10,precision)}},Twig.filter=function(filter,value,params){if(!Twig.filters[filter])throw"Unable to find filter "+filter;return Twig.filters[filter].apply(this,[value,params])},Twig.filter.extend=function(filter,definition){Twig.filters[filter]=definition},Twig}(Twig||{}),Twig=function(Twig){var TEMPLATE_NOT_FOUND_MESSAGE='Template "{name}" is not defined.';return Twig.functions={range:function(low,high,step){var inival,endval,plus,matrix=[],walker=step||1,chars=!1;if(isNaN(low)||isNaN(high)?isNaN(low)&&isNaN(high)?(chars=!0,inival=low.charCodeAt(0),endval=high.charCodeAt(0)):(inival=isNaN(low)?0:low,endval=isNaN(high)?0:high):(inival=parseInt(low,10),endval=parseInt(high,10)),plus=!(inival>endval))for(;inival<=endval;)matrix.push(chars?String.fromCharCode(inival):inival),inival+=walker;else for(;inival>=endval;)matrix.push(chars?String.fromCharCode(inival):inival),inival-=walker;return matrix},cycle:function(arr,i){var pos=i%arr.length;return arr[pos]},dump:function(){var EOL="\n",indentChar="  ",indentTimes=0,out="",args=Array.prototype.slice.call(arguments),indent=function(times){for(var ind="";times>0;)times--,ind+=indentChar;return ind},displayVar=function(variable){out+=indent(indentTimes),"object"==typeof variable?dumpVar(variable):"function"==typeof variable?out+="function()"+EOL:"string"==typeof variable?out+="string("+variable.length+') "'+variable+'"'+EOL:"number"==typeof variable?out+="number("+variable+")"+EOL:"boolean"==typeof variable&&(out+="bool("+variable+")"+EOL)},dumpVar=function(variable){var i;if(null===variable)out+="NULL"+EOL;else if(void 0===variable)out+="undefined"+EOL;else if("object"==typeof variable){out+=indent(indentTimes)+typeof variable,indentTimes++,out+="("+function(obj){var key,size=0;for(key in obj)obj.hasOwnProperty(key)&&size++;return size}(variable)+") {"+EOL;for(i in variable)out+=indent(indentTimes)+"["+i+"]=> "+EOL,displayVar(variable[i]);indentTimes--,out+=indent(indentTimes)+"}"+EOL}else displayVar(variable)};return 0==args.length&&args.push(this.context),Twig.forEach(args,function(variable){dumpVar(variable)}),out},date:function(date,time){var dateObj;if(void 0===date)dateObj=new Date;else if(Twig.lib.is("Date",date))dateObj=date;else if(Twig.lib.is("String",date))dateObj=date.match(/^[0-9]+$/)?new Date(1e3*date):new Date(1e3*Twig.lib.strtotime(date));else{if(!Twig.lib.is("Number",date))throw new Twig.Error("Unable to parse date "+date);dateObj=new Date(1e3*date)}return dateObj},block:function(block){return this.originalBlockTokens[block]?Twig.logic.parse.apply(this,[this.originalBlockTokens[block],this.context]).output:this.blocks[block]},parent:function(){return Twig.placeholders.parent},attribute:function(object,method,params){return Twig.lib.is("Object",object)&&object.hasOwnProperty(method)?"function"==typeof object[method]?object[method].apply(void 0,params):object[method]:object[method]||void 0},max:function(values){return Twig.lib.is("Object",values)?(delete values._keys,Twig.lib.max(values)):Twig.lib.max.apply(null,arguments)},min:function(values){return Twig.lib.is("Object",values)?(delete values._keys,Twig.lib.min(values)):Twig.lib.min.apply(null,arguments)},template_from_string:function(template){return void 0===template&&(template=""),Twig.Templates.parsers.twig({options:this.options,data:template})},random:function(value){function getRandomNumber(n){var random=Math.floor(Math.random()*LIMIT_INT31),limits=[0,n],min=Math.min.apply(null,limits),max=Math.max.apply(null,limits);return min+Math.floor((max-min+1)*random/LIMIT_INT31)}var LIMIT_INT31=2147483648;if(Twig.lib.is("Number",value))return getRandomNumber(value);if(Twig.lib.is("String",value))return value.charAt(getRandomNumber(value.length-1));if(Twig.lib.is("Array",value))return value[getRandomNumber(value.length-1)];if(Twig.lib.is("Object",value)){var keys=Object.keys(value);return value[keys[getRandomNumber(keys.length-1)]]}return getRandomNumber(LIMIT_INT31-1)},source:function(name,ignore_missing){var templateSource,loader,path,templateFound=!1,isNodeEnvironment="undefined"!=typeof module&&"undefined"!=typeof module.exports&&"undefined"==typeof window;isNodeEnvironment?(loader="fs",path=__dirname+"/"+name):(loader="ajax",path=name);var params={id:name,path:path,method:loader,parser:"source",async:!1,fetchTemplateSource:!0};"undefined"==typeof ignore_missing&&(ignore_missing=!1);try{templateSource=Twig.Templates.loadRemote(name,params),"undefined"==typeof templateSource||null===templateSource?templateSource="":templateFound=!0}catch(e){Twig.log.debug("Twig.functions.source: ","Problem loading template  ",e)}return templateFound||ignore_missing?templateSource:TEMPLATE_NOT_FOUND_MESSAGE.replace("{name}",name)}},Twig._function=function(_function,value,params){if(!Twig.functions[_function])throw"Unable to find function "+_function;return Twig.functions[_function](value,params)},Twig._function.extend=function(_function,definition){Twig.functions[_function]=definition},Twig}(Twig||{}),Twig=function(Twig){"use strict";return Twig.path={},Twig.path.parsePath=function(template,file){var namespaces=null,file=file||"";if("object"==typeof template&&"object"==typeof template.options&&(namespaces=template.options.namespaces),"object"==typeof namespaces&&file.indexOf("::")>0||file.indexOf("@")>=0){for(var k in namespaces)namespaces.hasOwnProperty(k)&&(file=file.replace(k+"::",namespaces[k]),file=file.replace("@"+k,namespaces[k]));return file}return Twig.path.relativePath(template,file)},Twig.path.relativePath=function(template,file){var base,base_path,val,sep_chr="/",new_path=[],file=file||"";if(template.url)base="undefined"!=typeof template.base?template.base+("/"===template.base.charAt(template.base.length-1)?"":"/"):template.url;else if(template.path){var path=require("path"),sep=path.sep||sep_chr,relative=new RegExp("^\\.{1,2}"+sep.replace("\\","\\\\"));file=file.replace(/\//g,sep),void 0!==template.base&&null==file.match(relative)?(file=file.replace(template.base,""),base=template.base+sep):base=path.normalize(template.path),base=base.replace(sep+sep,sep),sep_chr=sep}else{if(!template.name&&!template.id||!template.method||"fs"===template.method||"ajax"===template.method)throw new Twig.Error("Cannot extend an inline template.");base=template.base||template.name||template.id}for(base_path=base.split(sep_chr),base_path.pop(),base_path=base_path.concat(file.split(sep_chr));base_path.length>0;)val=base_path.shift(),"."==val||(".."==val&&new_path.length>0&&".."!=new_path[new_path.length-1]?new_path.pop():new_path.push(val));return new_path.join(sep_chr)},Twig}(Twig||{}),Twig=function(Twig){"use strict";return Twig.tests={empty:function(value){if(null===value||void 0===value)return!0;if("number"==typeof value)return!1;if(value.length&&value.length>0)return!1;for(var key in value)if(value.hasOwnProperty(key))return!1;return!0},odd:function(value){return value%2===1},even:function(value){return value%2===0},divisibleby:function(value,params){return value%params[0]===0},defined:function(value){return void 0!==value},none:function(value){return null===value},"null":function(value){return this.none(value)},sameas:function(value,params){return value===params[0]},iterable:function(value){return value&&(Twig.lib.is("Array",value)||Twig.lib.is("Object",value))}},Twig.test=function(test,value,params){if(!Twig.tests[test])throw"Test "+test+" is not defined.";return Twig.tests[test](value,params)},Twig.test.extend=function(test,definition){Twig.tests[test]=definition},Twig}(Twig||{}),Twig=function(Twig){"use strict";return Twig.exports={VERSION:Twig.VERSION},Twig.exports.twig=function(params){var id=params.id,options={strict_variables:params.strict_variables||!1,autoescape:null!=params.autoescape&&params.autoescape||!1,allowInlineIncludes:params.allowInlineIncludes||!1,rethrow:params.rethrow||!1,namespaces:params.namespaces};if(Twig.cache&&id&&Twig.validateId(id),void 0!==params.debug&&(Twig.debug=params.debug),void 0!==params.trace&&(Twig.trace=params.trace),void 0!==params.data)return Twig.Templates.parsers.twig({data:params.data,path:params.hasOwnProperty("path")?params.path:void 0,module:params.module,id:id,options:options});if(void 0!==params.ref){if(void 0!==params.id)throw new Twig.Error("Both ref and id cannot be set on a twig.js template.");return Twig.Templates.load(params.ref)}if(void 0!==params.method){if(!Twig.Templates.isRegisteredLoader(params.method))throw new Twig.Error('Loader for "'+params.method+'" is not defined.');return Twig.Templates.loadRemote(params.name||params.href||params.path||id||void 0,{id:id,method:params.method,parser:params.parser||"twig",base:params.base,module:params.module,precompiled:params.precompiled,async:params.async,options:options},params.load,params.error)}return void 0!==params.href?Twig.Templates.loadRemote(params.href,{id:id,method:"ajax",parser:params.parser||"twig",base:params.base,module:params.module,precompiled:params.precompiled,async:params.async,options:options},params.load,params.error):void 0!==params.path?Twig.Templates.loadRemote(params.path,{id:id,method:"fs",parser:params.parser||"twig",base:params.base,module:params.module,precompiled:params.precompiled,async:params.async,options:options},params.load,params.error):void 0},Twig.exports.extendFilter=function(filter,definition){Twig.filter.extend(filter,definition)},Twig.exports.extendFunction=function(fn,definition){Twig._function.extend(fn,definition)},Twig.exports.extendTest=function(test,definition){Twig.test.extend(test,definition)},Twig.exports.extendTag=function(definition){Twig.logic.extend(definition)},Twig.exports.extend=function(fn){fn(Twig)},Twig.exports.compile=function(markup,options){var template,id=options.filename,path=options.filename;return template=new Twig.Template({data:markup,path:path,id:id,options:options.settings["twig options"]}),function(context){return template.render(context)}},Twig.exports.renderFile=function(path,options,fn){"function"==typeof options&&(fn=options,options={}),options=options||{};var settings=options.settings||{},params={path:path,base:settings.views,load:function(template){fn(null,template.render(options))}},view_options=settings["twig options"];if(view_options)for(var option in view_options)view_options.hasOwnProperty(option)&&(params[option]=view_options[option]);Twig.exports.twig(params)},Twig.exports.__express=Twig.exports.renderFile,Twig.exports.cache=function(cache){Twig.cache=cache},Twig.exports.path=Twig.path,Twig}(Twig||{}),Twig=function(Twig){return Twig.compiler={module:{}},Twig.compiler.compile=function(template,options){var output,tokens=JSON.stringify(template.tokens),id=template.id;if(options.module){if(void 0===Twig.compiler.module[options.module])throw new Twig.Error("Unable to find module type "+options.module);output=Twig.compiler.module[options.module](id,tokens,options.twig)}else output=Twig.compiler.wrap(id,tokens);return output},Twig.compiler.module={amd:function(id,tokens,pathToTwig){return'define(["'+pathToTwig+'"], function (Twig) {\n\tvar twig, templates;\ntwig = Twig.twig;\ntemplates = '+Twig.compiler.wrap(id,tokens)+"\n\treturn templates;\n});"},node:function(id,tokens){return'var twig = require("twig").twig;\nexports.template = '+Twig.compiler.wrap(id,tokens)},cjs2:function(id,tokens,pathToTwig){return'module.declare([{ twig: "'+pathToTwig+'" }], function (require, exports, module) {\n\tvar twig = require("twig").twig;\n\texports.template = '+Twig.compiler.wrap(id,tokens)+"\n});"}},Twig.compiler.wrap=function(id,tokens){return'twig({id:"'+id.replace('"','\\"')+'", data:'+tokens+", precompiled: true});\n"},Twig}(Twig||{});"undefined"!=typeof module&&module.declare?module.declare([],function(require,exports,module){
for(key in Twig.exports)Twig.exports.hasOwnProperty(key)&&(exports[key]=Twig.exports[key])}):"function"==typeof define&&define.amd?define(function(){return Twig.exports}):"undefined"!=typeof module&&module.exports?module.exports=Twig.exports:(window.twig=Twig.exports.twig,window.Twig=Twig.exports),function(oEnv,twig){"use strict";function checkFinish(callback){var fpCallback=void 0===callback?function(){}:callback;aDataCache.length===Object.keys(oModules).length&&(FrontendMediator.publish(["data:finish"]),setTimeout(function(){fpCallback()},100))}function asyncInnerHTML(targets,HTML,callback){for(var oTarget in targets)"object"==typeof targets[oTarget]&&(targets[oTarget].innerHTML=HTML,callback(targets[oTarget]))}function getChannels(oData){var aDataChannels=[];for(var key in oData)aDataChannels.push(key);return aDataChannels}function renderTemplate(sId,sData){var oData,aCurrentChannels;sData.indexOf("[")!==-1?(aCurrentChannels=sData.replace("[","").replace("]","").split(","),sData=sRoundTripData,oData=oBBDD[sData]):(oData=oBBDD[sData],aCurrentChannels=getChannels(oData));for(var nKey=0;nKey<aCurrentChannels.length;nKey++)void 0===oModulesChannels[aCurrentChannels[nKey]]&&(oModulesChannels[aCurrentChannels[nKey]]=[]),oModulesChannels[aCurrentChannels[nKey]].push(sId),oChannels[aCurrentChannels[nKey]]=oData[aCurrentChannels[nKey]];FrontendMediator.subscribe(sModule+sId,function(oTopic){var oData=void 0!==oTopic.data?oTopic.data:{},oTargetRenders=document.querySelectorAll('[data-fc-render*="'+sId+'"]');asyncInnerHTML(oTargetRenders,oTemplates[sId].render(oData),function(oTarget){var oTargetModules=oTarget.querySelectorAll("[data-fc-modules]");for(var nTarget in oTargetModules){var self=oTargetModules[nTarget];"object"==typeof self&&(""===self.id&&(self.id=FrontendTools.getSelector(self)),void 0===oFCModules[self.dataset.fcModules]&&FrontendCore.requireAndStart(self.dataset.fcModules),oFCModules[self.dataset.fcModules]=_true_)}})}),Object.keys(oModules).length===Object.keys(oTemplates).length&&FrontendMediator.publish(["templates:finish"],oChannels)}function forEachModule(sFunction){var oModule,sData,sUrlTemplate,sId;for(var sModule in oModules)oModule=oModules[sModule],sData=void 0!==oModules[sModule].dataset.fcData?oModules[sModule].dataset.fcData:sRoundTripData,sUrlTemplate=oModules[sModule].dataset.fcTemplate,sId=oModules[sModule].dataset.fcRender,"data"===sFunction?RoundTrip.Data(sData):"template"===sFunction&&RoundTrip.Template(oModule,sId,sUrlTemplate,sData)}var _null_=null,_true_=!0,aIds=[],oBBDD={},oTemplates={},oModules={},oFCModules={},aDataCache=[],oModulesChannels={},oChannels={},sRoundTripData="RoundTripData",sModule="module:",sChannel="data:",RoundTrip={version:"1.0.0",Bind:_null_,Data:_null_,Module:_null_,Template:_null_,Error:_null_};RoundTrip.Data=function(data,callback){var item,typeOfData=typeof data,aChannels=[];if("object"===typeOfData){var oData=data;for(item in oData)oChannels[item]=oData[item],FrontendMediator.publish([sChannel+item],oChannels);checkFinish(callback)}else if(data===sRoundTripData){aDataCache.push(sRoundTripData+Date.now()),oBBDD.RoundTripData=oGlobalSettings.RoundTripData;for(item in oBBDD.RoundTripData)oChannels[item]=oBBDD.RoundTripData[item],aChannels.push(sChannel+item);FrontendMediator.publish(aChannels,oChannels),checkFinish(callback)}else if(data.indexOf("[")!==-1){aDataCache.push(sRoundTripData+Date.now()),oBBDD[sRoundTripData]=oGlobalSettings.RoundTripData;var aCurrentChannels=data.replace("[","").replace("]","").split(",");for(item in oBBDD.RoundTripData)oChannels[item]=oBBDD.RoundTripData[item],aCurrentChannels.indexOf(item)!==-1&&aChannels.push(sChannel+item);FrontendMediator.publish(aChannels,oChannels),checkFinish(callback)}else{var sUrl=data;aDataCache.indexOf(sUrl)===-1&&(aDataCache.push(sUrl),$.ajax({url:sUrl,async:!1,success:function(oData){oBBDD[sUrl]=oData,checkFinish(callback)}}))}},RoundTrip.Template=function(oModule,sId,sHref,sData){aIds.indexOf(sId)===-1&&$.get(sHref,function(sTemplate){oTemplates[sId]=twig({id:sId,data:sTemplate}),renderTemplate(sId,sData),aIds.push(sId)})},RoundTrip.getModules=function(){return oModules},oEnv.RoundTrip=RoundTrip,oEnv.window.onload=function(){var oTempModules=oEnv.document.querySelectorAll("[data-fc-render]");void 0!==oGlobalSettings.RoundTripData&&RoundTrip.Data(oGlobalSettings.RoundTripData);for(var nKey=0;nKey<oTempModules.length;nKey++)oModules[oTempModules[nKey].dataset.fcRender]=oTempModules[nKey];FrontendMediator.subscribe(["data:finish"],function(oTopic){forEachModule("template"),FrontendMediator.unsubscribe(["data:finish"])}),FrontendMediator.subscribe(["templates:finish"],function(oTopic){var channel,oData;for(channel in oTopic.data){var sThisChannel=sChannel+channel;oData={},oData[channel]=oChannels[channel],FrontendMediator.subscribe(sThisChannel,function(data){var channel=data.name.toString().replace("data:","");for(var module in oModulesChannels[channel])FrontendMediator.publish(sModule+oModulesChannels[channel][module],oChannels)})}for(channel in oChannels)oData={},oData[channel]=oChannels[channel],FrontendMediator.publish(sChannel+channel,oData)}),forEachModule("data")}}(this,twig);