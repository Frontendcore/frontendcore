!function($,window){"use strict";function _init(opts){opts=$.extend({},options,opts||{}),null===$body&&($body=$("body"));for(var $items=$(this),i=0,count=$items.length;i<count;i++)_build($items.eq(i),opts);return $items}function _build($node,opts){if(!$node.hasClass("autocompleter-node")){opts=$.extend({},opts,$node.data("autocompleter-options")),"string"!=typeof opts.source||".json"!==opts.source.slice(-5)&&opts.asLocal!==!0||$.ajax({url:opts.source,type:"GET",dataType:"json",async:!1}).done(function(response){opts.source=response});var html='<div class="autocompleter '+opts.customClass.join(" ")+'" id="autocompleter-'+(guid+1)+'">';opts.hint&&(html+='<div class="autocompleter-hint"></div>'),html+='<ul class="autocompleter-list"></ul>',html+="</div>",$node.addClass("autocompleter-node").after(html);var $autocompleter=$node.next(".autocompleter").eq(0),originalAutocomplete=$node.attr("autocomplete");$node.attr("autocomplete","off");var data=$.extend({$node:$node,$autocompleter:$autocompleter,$selected:null,$list:null,index:-1,hintText:!1,source:!1,jqxhr:!1,response:null,focused:!1,query:"",originalAutocomplete:originalAutocomplete,guid:guid++},opts);data.$autocompleter.on("mousedown.autocompleter",".autocompleter-item",data,_select).data("autocompleter",data),data.$node.on("keyup.autocompleter",data,_onKeyup).on("keydown.autocompleter",data,_onKeydownHelper).on("focus.autocompleter",data,_onFocus).on("blur.autocompleter",data,_onBlur).on("mousedown.autocompleter",data,_onMousedown)}}function _search(query,source,data){var response=[];if(query=query.toUpperCase(),source.length)for(var i=0;i<2;i++)for(var item in source)if(response.length<data.limit){var label=data.customLabel&&source[item][data.customLabel]?source[item][data.customLabel]:source[item].label;switch(i){case 0:0===label.toUpperCase().search(query)&&(response.push(source[item]),delete source[item]);break;case 1:label.toUpperCase().search(query)!==-1&&(response.push(source[item]),delete source[item])}}return response}function _launch(data){return clearTimeout(delayTimeout),data.query=$.trim(data.$node.val()),!data.empty&&0===data.query.length||data.minLength&&data.query.length<data.minLength?void _clear(data):void(data.delay?delayTimeout=setTimeout(function(){_xhr(data)},data.delay):_xhr(data))}function _xhr(data){if("object"==typeof data.source){_clear(data);var search=_search(data.query,_clone(data.source),data);search.length&&_response(search,data)}else{data.jqxhr&&data.jqxhr.abort();var ajaxData=$.extend({limit:data.limit,query:data.query},data.combine());data.jqxhr=$.ajax({url:data.source,dataType:"json",data:ajaxData,beforeSend:function(xhr){if(data.$autocompleter.addClass("autocompleter-ajax"),_clear(data),data.cache){var stored=_getCache(this.url);stored&&(xhr.abort(),_response(stored,data))}}}).done(function(response){data.offset&&(response=_grab(response,data.offset)),data.cache&&_setCache(this.url,response),_response(response,data)}).always(function(){data.$autocompleter.removeClass("autocompleter-ajax")})}}function _clear(data){data.response=null,data.$list=null,data.$selected=null,data.index=0,data.$autocompleter.find(".autocompleter-list").empty(),data.$autocompleter.find(".autocompleter-hint").removeClass("autocompleter-hint-show").empty(),data.hintText=!1,_close(null,data)}function _response(response,data){_buildList(response,data),data.$autocompleter.hasClass("autocompleter-focus")&&_open(null,data)}function _buildList(list,data){for(var menu="",item=0,count=list.length;item<count;item++){var classes=["autocompleter-item"];data.selectFirst&&0===item&&!data.changeWhenSelect&&classes.push("autocompleter-item-selected");var highlightReg=new RegExp(data.query,"gi"),label=data.customLabel&&list[item][data.customLabel]?list[item][data.customLabel]:list[item].label,clear=label;label=data.highlightMatches?label.replace(highlightReg,"<strong>$&</strong>"):label;var value=data.customValue&&list[item][data.customValue]?list[item][data.customValue]:list[item].value;if(data.template){var template=data.template.replace(/({{ label }})/gi,label);for(var property in list[item])if(list[item].hasOwnProperty(property)){var regex=new RegExp("{{ "+property+" }}","gi");template=template.replace(regex,list[item][property])}label=template}menu+=value?'<li data-value="'+value+'" data-label="'+clear+'" class="'+classes.join(" ")+'">'+label+"</li>":'<li data-label="'+clear+'" class="'+classes.join(" ")+'">'+label+"</li>"}if(list.length&&data.hint){var hint=list[0].label.substr(0,data.query.length).toUpperCase()===data.query.toUpperCase()&&list[0].label;if(hint&&data.query!==list[0].label){var hintReg=new RegExp(data.query,"i"),hintText=hint.replace(hintReg,"<span>"+data.query+"</span>");data.$autocompleter.find(".autocompleter-hint").addClass("autocompleter-hint-show").html(hintText),data.hintText=hintText}}data.response=list,data.$autocompleter.find(".autocompleter-list").html(menu),data.$selected=data.$autocompleter.find(".autocompleter-item-selected").length?data.$autocompleter.find(".autocompleter-item-selected"):null,data.$list=list.length?data.$autocompleter.find(".autocompleter-item"):null,data.index=data.$selected?data.$list.index(data.$selected):-1,data.$autocompleter.find(".autocompleter-item").each(function(i,j){$(j).data(data.response[i])})}function _onKeyup(e){var data=e.data,code=e.keyCode?e.keyCode:e.which;if(40!==code&&38!==code||!data.$autocompleter.hasClass("autocompleter-show"))$.inArray(code,ignoredKeyCode)===-1&&$.inArray(code,data.ignoredKeyCode)===-1&&_launch(data);else{var next,prev,len=data.$list.length;len&&(len>1?data.index===len-1?(next=data.changeWhenSelect?-1:0,prev=data.index-1):0===data.index?(next=data.index+1,prev=data.changeWhenSelect?-1:len-1):data.index===-1?(next=0,prev=len-1):(next=data.index+1,prev=data.index-1):data.index===-1?(next=0,prev=0):(prev=-1,next=-1),data.index=40===code?next:prev,data.$list.removeClass("autocompleter-item-selected"),data.index!==-1&&data.$list.eq(data.index).addClass("autocompleter-item-selected"),data.$selected=data.$autocompleter.find(".autocompleter-item-selected").length?data.$autocompleter.find(".autocompleter-item-selected"):null,data.changeWhenSelect&&_setValue(data))}}function _onKeydownHelper(e){var code=e.keyCode?e.keyCode:e.which,data=e.data;if(40===code||38===code)e.preventDefault(),e.stopPropagation();else if(39===code){if(data.hint&&data.hintText&&data.$autocompleter.find(".autocompleter-hint").hasClass("autocompleter-hint-show")){e.preventDefault(),e.stopPropagation();var hintOrigin=!!data.$autocompleter.find(".autocompleter-item").length&&data.$autocompleter.find(".autocompleter-item").eq(0).attr("data-label");hintOrigin&&(data.query=hintOrigin,_setHint(data))}}else 13===code&&data.$autocompleter.hasClass("autocompleter-show")&&data.$selected&&_select(e)}function _onFocus(e,internal){if(!internal){var data=e.data;data.$autocompleter.addClass("autocompleter-focus"),data.$node.prop("disabled")||data.$autocompleter.hasClass("autocompleter-show")||data.focusOpen&&(_launch(data),data.focused=!0,setTimeout(function(){data.focused=!1},500))}}function _onBlur(e,internal){e.preventDefault(),e.stopPropagation();var data=e.data;internal||(data.$autocompleter.removeClass("autocompleter-focus"),_close(e))}function _onMousedown(e){if("mousedown"!==e.type||$.inArray(e.which,[2,3])===-1){var data=e.data;if(data.$list&&!data.focused&&!data.$node.is(":disabled"))if(isMobile&&!isFirefoxMobile){var el=data.$select[0];if(window.document.createEvent){var evt=window.document.createEvent("MouseEvents");evt.initMouseEvent("mousedown",!1,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),el.dispatchEvent(evt)}else el.fireEvent&&el.fireEvent("onmousedown")}else data.$autocompleter.hasClass("autocompleter-closed")?_open(e):data.$autocompleter.hasClass("autocompleter-show")&&_close(e)}}function _open(e,instanceData){var data=e?e.data:instanceData;!data.$node.prop("disabled")&&!data.$autocompleter.hasClass("autocompleter-show")&&data.$list&&data.$list.length&&(data.$autocompleter.removeClass("autocompleter-closed").addClass("autocompleter-show"),$body.on("click.autocompleter-"+data.guid,":not(.autocompleter-item)",data,_closeHelper))}function _closeHelper(e){$(e.target).hasClass("autocompleter-node")||0===$(e.currentTarget).parents(".autocompleter").length&&_close(e)}function _close(e,instanceData){var data=e?e.data:instanceData;data.$autocompleter.hasClass("autocompleter-show")&&(data.$autocompleter.removeClass("autocompleter-show").addClass("autocompleter-closed"),$body.off(".autocompleter-"+data.guid))}function _select(e){if("mousedown"!==e.type||$.inArray(e.which,[2,3])===-1){var data=e.data;e.preventDefault(),e.stopPropagation(),"mousedown"===e.type&&$(this).length&&(data.$selected=$(this),data.index=data.$list.index(data.$selected)),data.$node.prop("disabled")||(_close(e),_update(data),"click"===e.type&&data.$node.trigger("focus",[!0]))}}function _setHint(data){_setValue(data),_handleChange(data),_launch(data)}function _setValue(data){if(data.$selected){data.hintText&&data.$autocompleter.find(".autocompleter-hint").hasClass("autocompleter-hint-show")&&data.$autocompleter.find(".autocompleter-hint").removeClass("autocompleter-hint-show");var value=data.$selected.attr("data-value")?data.$selected.attr("data-value"):data.$selected.attr("data-label");data.$node.val(value)}else data.hintText&&!data.$autocompleter.find(".autocompleter-hint").hasClass("autocompleter-hint-show")&&data.$autocompleter.find(".autocompleter-hint").addClass("autocompleter-hint-show"),data.$node.val(data.query)}function _update(data){_setValue(data),_handleChange(data),_clear(data)}function _handleChange(data){data.callback.call(data.$autocompleter,data.$node.val(),data.index,data.response[data.index]),data.$node.trigger("change")}function _grab(response,offset){for(offset=offset.split(".");response&&offset.length;)response=response[offset.shift()];return response}function _setCache(url,data){if(supportLocalStorage&&url&&data){cache[url]={value:data};try{localStorage.setItem(localStorageKey,JSON.stringify(cache))}catch(e){var code=e.code||e.number||e.message;if(22!==code)throw e;_deleteCache()}}}function _getCache(url){if(url){var response=!(!cache[url]||!cache[url].value)&&cache[url].value;return response}}function _loadCache(){if(supportLocalStorage)return JSON.parse(localStorage.getItem(localStorageKey)||"{}")}function _deleteCache(){try{localStorage.removeItem(localStorageKey),cache=_loadCache()}catch(e){throw e}}function _clone(obj){if(null===obj||"object"!=typeof obj)return obj;var copy=obj.constructor();for(var attr in obj)obj.hasOwnProperty(attr)&&(copy[attr]=obj[attr]);return copy}var guid=0,ignoredKeyCode=[9,13,17,19,20,27,33,34,35,36,37,39,44,92,113,114,115,118,119,120,122,123,144,145],allowOptions=["source","empty","limit","cache","focusOpen","selectFirst","changeWhenSelect","highlightMatches","ignoredKeyCode","customLabel","customValue","template","offset","combine","callback","minLength","delay"],userAgent=window.navigator.userAgent||window.navigator.vendor||window.opera,isFirefox=/Firefox/i.test(userAgent),isMobile=/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(userAgent),isFirefoxMobile=isFirefox&&isMobile,$body=null,delayTimeout=null,localStorageKey="autocompleterCache",supportLocalStorage=function(){var supported="undefined"!=typeof window.localStorage;if(supported)try{localStorage.setItem("autocompleter","autocompleter"),localStorage.removeItem("autocompleter")}catch(e){supported=!1}return supported}(),options={source:null,asLocal:!1,empty:!0,limit:10,minLength:0,delay:0,customClass:[],cache:!0,focusOpen:!0,hint:!1,selectFirst:!1,changeWhenSelect:!0,highlightMatches:!1,ignoredKeyCode:[],customLabel:!1,customValue:!1,template:!1,offset:!1,combine:$.noop,callback:$.noop},publics={defaults:function(opts){return options=$.extend(options,opts||{}),"object"!=typeof this||$(this)},option:function(properties){return $(this).each(function(i,input){var data=$(input).next(".autocompleter").data("autocompleter");for(var property in properties)$.inArray(property,allowOptions)!==-1&&(data[property]=properties[property])})},open:function(){return $(this).each(function(i,input){var data=$(input).next(".autocompleter").data("autocompleter");data&&_open(null,data)})},close:function(){return $(this).each(function(i,input){var data=$(input).next(".autocompleter").data("autocompleter");data&&_close(null,data)})},clearCache:function(){_deleteCache()},destroy:function(){return $(this).each(function(i,input){var data=$(input).next(".autocompleter").data("autocompleter");data&&(data.jqxhr&&data.jqxhr.abort(),data.$autocompleter.hasClass("open")&&data.$autocompleter.find(".autocompleter-selected").trigger("click.autocompleter"),data.originalAutocomplete?data.$node.attr("autocomplete",data.originalAutocomplete):data.$node.removeAttr("autocomplete"),data.$node.off(".autocompleter").removeClass("autocompleter-node"),data.$autocompleter.off(".autocompleter").remove())})}},cache=_loadCache();$.fn.autocompleter=function(method){return publics[method]?publics[method].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof method&&method?this:_init.apply(this,arguments)},$.autocompleter=function(method){"defaults"===method?publics.defaults.apply(this,Array.prototype.slice.call(arguments,1)):"clearCache"===method&&publics.clearCache.apply(this,null)}}(jQuery,window),function(window,document,oGlobalSettings,FrontendTools,FrontendCore,$){"use strict";FrontendCore.define("autocomplete",[],function(){return{oDefault:{limit:12},onStart:function(){var aTargets=FrontendTools.getDataModules("autocomplete"),self=this;FrontendTools.loadCSS(oGlobalSettings.sPathCss+"secondary.css?v="+oGlobalSettings.sHash),FrontendTools.trackModule("JS_Libraries","call","autocomplete"),$(aTargets).each(function(){self.autobind(this)})},autobind:function(oTarget,sData){var oSettings,aValues,self=this,oOptions={},$Target=$(oTarget),sValues=oTarget.getAttribute("data-fc-values"),aTemp={};if(oOptions.source=[],void 0===sData&&null!==sValues){aValues=oTarget.getAttribute("data-fc-values").split(",");for(var nKey=0;aValues.length>nKey;nKey++)aTemp={},aTemp.value=aValues[nKey],aTemp.label=aValues[nKey],oOptions.source.push(aTemp),oOptions.source.push(aTemp)}oSettings=FrontendTools.mergeOptions(self.oDefault,oOptions),$Target.autocompleter(oSettings)},onStop:function(){this.sPathCss=null,this.oDefault=null},onDestroy:function(){delete this.sPathCss,delete this.oDefault}}})}(window,document,oGlobalSettings,FrontendTools,FrontendCore,$);