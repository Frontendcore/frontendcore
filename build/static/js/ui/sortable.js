!function($,window,pluginName,undefined){function d(a,b){var x=Math.max(0,a[0]-b[0],b[0]-a[1]),y=Math.max(0,a[2]-b[1],b[1]-a[3]);return x+y}function setDimensions(array,dimensions,tolerance,useOffset){var i=array.length,offsetMethod=useOffset?"offset":"position";for(tolerance=tolerance||0;i--;){var el=array[i].el?array[i].el:$(array[i]),pos=el[offsetMethod]();pos.left+=parseInt(el.css("margin-left"),10),pos.top+=parseInt(el.css("margin-top"),10),dimensions[i]=[pos.left-tolerance,pos.left+el.outerWidth()+tolerance,pos.top-tolerance,pos.top+el.outerHeight()+tolerance]}}function getRelativePosition(pointer,element){var offset=element.offset();return{left:pointer.left-offset.left,top:pointer.top-offset.top}}function sortByDistanceDesc(dimensions,pointer,lastPointer){pointer=[pointer.left,pointer.top],lastPointer=lastPointer&&[lastPointer.left,lastPointer.top];for(var dim,i=dimensions.length,distances=[];i--;)dim=dimensions[i],distances[i]=[i,d(dim,pointer),lastPointer&&d(dim,lastPointer)];return distances=distances.sort(function(a,b){return b[1]-a[1]||b[2]-a[2]||b[0]-a[0]})}function ContainerGroup(options){this.options=$.extend({},groupDefaults,options),this.containers=[],this.options.rootGroup||(this.scrollProxy=$.proxy(this.scroll,this),this.dragProxy=$.proxy(this.drag,this),this.dropProxy=$.proxy(this.drop,this),this.placeholder=$(this.options.placeholder),options.isValidTarget||(this.options.isValidTarget=undefined))}function Container(element,options){this.el=element,this.options=$.extend({},containerDefaults,options),this.group=ContainerGroup.get(this.options),this.rootGroup=this.options.rootGroup||this.group,this.handle=this.rootGroup.options.handle||this.rootGroup.options.itemSelector;var itemPath=this.rootGroup.options.itemPath;this.target=itemPath?this.el.find(itemPath):this.el,this.target.on(eventNames.start,this.handle,$.proxy(this.dragInit,this)),this.options.drop&&this.group.containers.push(this)}var eventNames,containerDefaults={drag:!0,drop:!0,exclude:"",nested:!0,vertical:!0},groupDefaults={afterMove:function($placeholder,container,$closestItemOrContainer){},containerPath:"",containerSelector:"ol, ul",distance:0,delay:0,handle:"",itemPath:"",itemSelector:"li",bodyClass:"dragging",draggedClass:"dragged",isValidTarget:function($item,container){return!0},onCancel:function($item,container,_super,event){},onDrag:function($item,position,_super,event){$item.css(position)},onDragStart:function($item,container,_super,event){$item.css({height:$item.outerHeight(),width:$item.outerWidth()}),$item.addClass(container.group.options.draggedClass),$("body").addClass(container.group.options.bodyClass)},onDrop:function($item,container,_super,event){$item.removeClass(container.group.options.draggedClass).removeAttr("style"),$("body").removeClass(container.group.options.bodyClass)},onMousedown:function($item,_super,event){if(!event.target.nodeName.match(/^(input|select|textarea)$/i))return event.preventDefault(),!0},placeholderClass:"placeholder",placeholder:'<li class="placeholder"></li>',pullPlaceholder:!0,serialize:function($parent,$children,parentIsContainer){var result=$.extend({},$parent.data());return parentIsContainer?[$children]:($children[0]&&(result.children=$children),delete result.subContainers,delete result.sortable,result)},tolerance:0},containerGroups={},groupCounter=0,emptyBox={left:0,top:0,bottom:0,right:0},eventNames={start:"touchstart.sortable mousedown.sortable",drop:"touchend.sortable touchcancel.sortable mouseup.sortable",drag:"touchmove.sortable mousemove.sortable",scroll:"scroll.sortable"},subContainerKey="subContainers";ContainerGroup.get=function(options){return containerGroups[options.group]||(options.group===undefined&&(options.group=groupCounter++),containerGroups[options.group]=new ContainerGroup(options)),containerGroups[options.group]},ContainerGroup.prototype={dragInit:function(e,itemContainer){this.$document=$(itemContainer.el[0].ownerDocument);var closestItem=$(e.target).closest(this.options.itemSelector);if(closestItem.length){if(this.item=closestItem,this.itemContainer=itemContainer,this.item.is(this.options.exclude)||!this.options.onMousedown(this.item,groupDefaults.onMousedown,e))return;this.setPointer(e),this.toggleListeners("on"),this.setupDelayTimer(),this.dragInitDone=!0}},drag:function(e){if(!this.dragging){if(!this.distanceMet(e)||!this.delayMet)return;this.options.onDragStart(this.item,this.itemContainer,groupDefaults.onDragStart,e),this.item.before(this.placeholder),this.dragging=!0}this.setPointer(e),this.options.onDrag(this.item,getRelativePosition(this.pointer,this.item.offsetParent()),groupDefaults.onDrag,e);var p=this.getPointer(e),box=this.sameResultBox,t=this.options.tolerance;(!box||box.top-t>p.top||box.bottom+t<p.top||box.left-t>p.left||box.right+t<p.left)&&(this.searchValidTarget()||(this.placeholder.detach(),this.lastAppendedItem=undefined))},drop:function(e){this.toggleListeners("off"),this.dragInitDone=!1,this.dragging&&(this.placeholder.closest("html")[0]?this.placeholder.before(this.item).detach():this.options.onCancel(this.item,this.itemContainer,groupDefaults.onCancel,e),this.options.onDrop(this.item,this.getContainer(this.item),groupDefaults.onDrop,e),this.clearDimensions(),this.clearOffsetParent(),this.lastAppendedItem=this.sameResultBox=undefined,this.dragging=!1)},searchValidTarget:function(pointer,lastPointer){pointer||(pointer=this.relativePointer||this.pointer,lastPointer=this.lastRelativePointer||this.lastPointer);for(var distances=sortByDistanceDesc(this.getContainerDimensions(),pointer,lastPointer),i=distances.length;i--;){var index=distances[i][0],distance=distances[i][1];if(!distance||this.options.pullPlaceholder){var container=this.containers[index];if(!container.disabled){if(!this.$getOffsetParent()){var offsetParent=container.getItemOffsetParent();pointer=getRelativePosition(pointer,offsetParent),lastPointer=getRelativePosition(lastPointer,offsetParent)}if(container.searchValidTarget(pointer,lastPointer))return!0}}}this.sameResultBox&&(this.sameResultBox=undefined)},movePlaceholder:function(container,item,method,sameResultBox){var lastAppendedItem=this.lastAppendedItem;!sameResultBox&&lastAppendedItem&&lastAppendedItem[0]===item[0]||(item[method](this.placeholder),this.lastAppendedItem=item,this.sameResultBox=sameResultBox,this.options.afterMove(this.placeholder,container,item))},getContainerDimensions:function(){return this.containerDimensions||setDimensions(this.containers,this.containerDimensions=[],this.options.tolerance,!this.$getOffsetParent()),this.containerDimensions},getContainer:function(element){return element.closest(this.options.containerSelector).data(pluginName)},$getOffsetParent:function(){if(this.offsetParent===undefined){var i=this.containers.length-1,offsetParent=this.containers[i].getItemOffsetParent();if(!this.options.rootGroup)for(;i--;)if(offsetParent[0]!=this.containers[i].getItemOffsetParent()[0]){offsetParent=!1;break}this.offsetParent=offsetParent}return this.offsetParent},setPointer:function(e){var pointer=this.getPointer(e);if(this.$getOffsetParent()){var relativePointer=getRelativePosition(pointer,this.$getOffsetParent());this.lastRelativePointer=this.relativePointer,this.relativePointer=relativePointer}this.lastPointer=this.pointer,this.pointer=pointer},distanceMet:function(e){var currentPointer=this.getPointer(e);return Math.max(Math.abs(this.pointer.left-currentPointer.left),Math.abs(this.pointer.top-currentPointer.top))>=this.options.distance},getPointer:function(e){var o=e.originalEvent||e.originalEvent.touches&&e.originalEvent.touches[0];return{left:e.pageX||o.pageX,top:e.pageY||o.pageY}},setupDelayTimer:function(){var that=this;this.delayMet=!this.options.delay,this.delayMet||(clearTimeout(this._mouseDelayTimer),this._mouseDelayTimer=setTimeout(function(){that.delayMet=!0},this.options.delay))},scroll:function(e){this.clearDimensions(),this.clearOffsetParent()},toggleListeners:function(method){var that=this,events=["drag","drop","scroll"];$.each(events,function(i,event){that.$document[method](eventNames[event],that[event+"Proxy"])})},clearOffsetParent:function(){this.offsetParent=undefined},clearDimensions:function(){this.traverse(function(object){object._clearDimensions()})},traverse:function(callback){callback(this);for(var i=this.containers.length;i--;)this.containers[i].traverse(callback)},_clearDimensions:function(){this.containerDimensions=undefined},_destroy:function(){containerGroups[this.options.group]=undefined}},Container.prototype={dragInit:function(e){var rootGroup=this.rootGroup;!this.disabled&&!rootGroup.dragInitDone&&this.options.drag&&this.isValidDrag(e)&&rootGroup.dragInit(e,this)},isValidDrag:function(e){return 1==e.which||"touchstart"==e.type&&1==e.originalEvent.touches.length},searchValidTarget:function(pointer,lastPointer){var distances=sortByDistanceDesc(this.getItemDimensions(),pointer,lastPointer),i=distances.length,rootGroup=this.rootGroup,validTarget=!rootGroup.options.isValidTarget||rootGroup.options.isValidTarget(rootGroup.item,this);if(!i&&validTarget)return rootGroup.movePlaceholder(this,this.target,"append"),!0;for(;i--;){var index=distances[i][0],distance=distances[i][1];if(!distance&&this.hasChildGroup(index)){var found=this.getContainerGroup(index).searchValidTarget(pointer,lastPointer);if(found)return!0}else if(validTarget)return this.movePlaceholder(index,pointer),!0}},movePlaceholder:function(index,pointer){var item=$(this.items[index]),dim=this.itemDimensions[index],method="after",width=item.outerWidth(),height=item.outerHeight(),offset=item.offset(),sameResultBox={left:offset.left,right:offset.left+width,top:offset.top,bottom:offset.top+height};if(this.options.vertical){var yCenter=(dim[2]+dim[3])/2,inUpperHalf=pointer.top<=yCenter;inUpperHalf?(method="before",sameResultBox.bottom-=height/2):sameResultBox.top+=height/2}else{var xCenter=(dim[0]+dim[1])/2,inLeftHalf=pointer.left<=xCenter;inLeftHalf?(method="before",sameResultBox.right-=width/2):sameResultBox.left+=width/2}this.hasChildGroup(index)&&(sameResultBox=emptyBox),this.rootGroup.movePlaceholder(this,item,method,sameResultBox)},getItemDimensions:function(){return this.itemDimensions||(this.items=this.$getChildren(this.el,"item").filter(":not(."+this.group.options.placeholderClass+", ."+this.group.options.draggedClass+")").get(),setDimensions(this.items,this.itemDimensions=[],this.options.tolerance)),this.itemDimensions},getItemOffsetParent:function(){var offsetParent,el=this.el;return offsetParent="relative"===el.css("position")||"absolute"===el.css("position")||"fixed"===el.css("position")?el:el.offsetParent()},hasChildGroup:function(index){return this.options.nested&&this.getContainerGroup(index)},getContainerGroup:function(index){var childGroup=$.data(this.items[index],subContainerKey);if(childGroup===undefined){var childContainers=this.$getChildren(this.items[index],"container");if(childGroup=!1,childContainers[0]){var options=$.extend({},this.options,{rootGroup:this.rootGroup,group:groupCounter++});childGroup=childContainers[pluginName](options).data(pluginName).group}$.data(this.items[index],subContainerKey,childGroup)}return childGroup},$getChildren:function(parent,type){var options=this.rootGroup.options,path=options[type+"Path"],selector=options[type+"Selector"];return parent=$(parent),path&&(parent=parent.find(path)),parent.children(selector)},_serialize:function(parent,isContainer){var that=this,childType=isContainer?"item":"container",children=this.$getChildren(parent,childType).not(this.options.exclude).map(function(){return that._serialize($(this),!isContainer)}).get();return this.rootGroup.options.serialize(parent,children,isContainer)},traverse:function(callback){$.each(this.items||[],function(item){var group=$.data(this,subContainerKey);group&&group.traverse(callback)}),callback(this)},_clearDimensions:function(){this.itemDimensions=undefined},_destroy:function(){var that=this;this.target.off(eventNames.start,this.handle),this.el.removeData(pluginName),this.options.drop&&(this.group.containers=$.grep(this.group.containers,function(val){return val!=that})),$.each(this.items||[],function(){$.removeData(this,subContainerKey)})}};var API={enable:function(){this.traverse(function(object){object.disabled=!1})},disable:function(){this.traverse(function(object){object.disabled=!0})},serialize:function(){return this._serialize(this.el,!0)},refresh:function(){this.traverse(function(object){object._clearDimensions()})},destroy:function(){this.traverse(function(object){object._destroy()})}};$.extend(Container.prototype,API),$.fn[pluginName]=function(methodOrOptions){var args=Array.prototype.slice.call(arguments,1);return this.map(function(){var $t=$(this),object=$t.data(pluginName);return object&&API[methodOrOptions]?API[methodOrOptions].apply(object,args)||this:(object||methodOrOptions!==undefined&&"object"!=typeof methodOrOptions||$t.data(pluginName,new Container($t,methodOrOptions)),this)})}}(jQuery,window,"sortable"),function(window,document,oGlobalSettings,FrontendTools,FrontendCore,$){"use strict";FrontendCore.define("sortable",[],function(){return{sInput:null,oTarget:[],delay:500,placeholer:'<li class="placeholder" data-fc-modules="va">',oDefault:{oldContainer:null,group:"this",nested:!1},afterMove:function(placeholder,container){var oTarget=$(container.el).closest("ol[data-fc-modules=sortable]")[0];this.oldContainer!=container&&(this.oldContainer&&this.oldContainer.el.removeClass("active"),container.el.addClass("active"),this.oldContainer=container),this.showEmptyList(oTarget),this.hideEmptyList(oTarget),$(oTarget).sortable("refresh")},onDrop:function(item,container,_super){var oReturn,oTarget=$(container.el).closest("ol[data-fc-modules=sortable]")[0]?$(container.el).closest("ol[data-fc-modules=sortable]")[0]:$(container.el)[0];void 0!==oTarget&&(oReturn="json"===oTarget.getAttribute("data-fc-output")?this.serialize(oTarget):this.arraylize(oTarget),null!==oTarget.getAttribute("data-fc-input")&&this.fillInput(oTarget.getAttribute("data-fc-input"),oReturn),null!==oTarget.getAttribute("data-fc-url")&&this.sendAjax(oTarget.getAttribute("data-fc-url"),oReturn)),container.el.removeClass("active");var $item=$(item);$item.removeClass("dragged").removeAttr("style"),$("body").removeClass("dragging"),this.hideEmptyList(oTarget),_super(item)},onDrag:function($item,position,_super,event){$item.offset($(".placeholder").offset())},onDragStart:function($item,container,_super,event){$($item.context).closest("ol[data-fc-modules=sortable]")[0];$item.addClass("dragged"),$("body").addClass("dragging")},isValidTarget:function($item,container){var oTarget=$($item.context).closest("ol[data-fc-modules=sortable]")[0];if(void 0!==oTarget){var nDepth=$(container.el.context,"#"+oTarget.id).parents("ol").length+1,nTotalDepth=null!==oTarget.getAttribute("data-fc-depth")?oTarget.getAttribute("data-fc-depth"):2;return!(nDepth>nTotalDepth)&&!(void 0!==$(".dragged").find("li")[0]&&nDepth>nTotalDepth-1)}return!0},addEmptyList:function(oTarget){void 0!==oTarget&&$("li",oTarget).each(function(){void 0===$("ol",this)[0]&&$(this).append('<ol class="sub-sortable"></ol>')}),$(oTarget).sortable("refresh")},hideEmptyList:function(oTarget){if(void 0!==oTarget){var nDepth,nTotalDepth=null!==oTarget.getAttribute("data-fc-depth")?oTarget.getAttribute("data-fc-depth"):2;$("li",oTarget).each(function(){nDepth=$(this,"#"+oTarget.id).parents("ol").length,nDepth>=nTotalDepth&&$("ol",this).css({height:"1px",padding:"0px",margin:"0px",background:"transparent",position:"absolute"})})}},showEmptyList:function(oTarget){void 0!==oTarget&&$("li",oTarget).each(function(){void 0===$("ol li",this)[0]&&$("ol",this).removeAttr("style")}),$(oTarget).sortable("refresh")},onStart:function(){var aTargets=document.querySelectorAll('[data-fc-modules="sortable"]'),self=this;FrontendTools.loadCSS(oGlobalSettings.sPathCss+"secondary.css?v="+oGlobalSettings.sHash),FrontendTools.trackModule("JS_Libraries","call","sortable"),$(aTargets).each(function(index){self.autobind(this,index)})},arraylize:function(oTarget){var nTotal=$("li",oTarget).length,sValue="";return $("li",oTarget).each(function(nIndex){""!==this.id&&(sValue+=this.id?this.id:this.innerHTML),nIndex!==nTotal-1&&""!==this.id&&(sValue+=",")}),sValue},getSubTree:function($Target){var oTree={},self=this;return $Target.each(function(nLi){oTree[nLi]={order:nLi+1,id:null!==this.getAttribute("data-fc-id")?this.getAttribute("data-fc-id"):this.id,name:null!==this.getAttribute("data-fc-name")?this.getAttribute("data-fc-name"):this.id,subtree:self.getSubTree($(this).find("> ol").find("> li"))}}),oTree},serialize:function(oTarget){return this.getSubTree($("#"+oTarget.id+"> li"))},fillInput:function(sInput,oReturn){"object"==typeof oReturn&&(oReturn=JSON.stringify(oReturn)),document.getElementById(sInput).value=oReturn},sendAjax:function(sUrl,oReturn){var sJson=JSON.stringify(oReturn);$.ajax({url:sUrl,type:"POST",data:{data:sJson},dataType:"json"})},autobind:function(oTarget,index){var oSettings,oOptions={},sDate=Math.random(1e3).toString(),self=this;""===oTarget.id&&(oTarget.id="sortable-"+sDate.replace(".","")),"nested"===oTarget.getAttribute("data-fc-type")&&($(oTarget).addClass("js-sortable"),oOptions.nested=!0),this.addEmptyList(oTarget),this.hideEmptyList(oTarget),oOptions.isValidTarget=this.isValidTarget,oOptions.addEmptyList=this.addEmptyList,oOptions.showEmptyList=this.showEmptyList,oOptions.hideEmptyList=this.hideEmptyList,oOptions.afterMove=this.afterMove,oOptions.onDrop=this.onDrop,oOptions.onDrag=this.onDrag,oOptions.onDragStart=this.onDragStart,null!==oTarget.getAttribute("data-fc-handle")&&(oOptions.handle=oTarget.getAttribute("data-fc-handle")),oSettings=FrontendTools.mergeOptions(self.oDefault,oOptions),self.oTarget[index]=$(oTarget).sortable(oSettings),FrontendTools.removeLoading(oTarget)}}})}(window,document,oGlobalSettings,FrontendTools,FrontendCore,$);