!function($){function defaultRowWriter(rowIndex,record,columns,cellWriter){for(var tr="",i=0,len=columns.length;i<len;i++)tr+=cellWriter(columns[i],record);return"<tr>"+tr+"</tr>"}function defaultCellWriter(column,record){var html=column.attributeWriter(record),td="<td";return(column.hidden||column.textAlign)&&(td+=' style="',column.hidden&&(td+="display: none;"),column.textAlign&&(td+="text-align: "+column.textAlign+";"),td+='"'),td+">"+html+"</td>"}function defaultAttributeWriter(record){return record[this.id]}function defaultAttributeReader(cell,record){return $(cell).html()}function Dom(obj,settings){this.update=function(){var rows="",columns=settings.table.columns,rowWriter=settings.writers._rowWriter,cellWriter=settings.writers._cellWriter;obj.$element.trigger("dynatable:beforeUpdate",rows);for(var i=0,len=settings.dataset.records.length;i<len;i++){var record=settings.dataset.records[i],tr=rowWriter(i,record,columns,cellWriter);rows+=tr}if(settings.features.recordCount&&$("#dynatable-record-count-"+obj.element.id).replaceWith(obj.recordsCount.create()),settings.features.paginate&&($("#dynatable-pagination-links-"+obj.element.id).replaceWith(obj.paginationLinks.create()),settings.features.perPageSelect&&$("#dynatable-per-page-"+obj.element.id).val(parseInt(settings.dataset.perPage))),settings.features.sort&&columns){obj.sortsHeaders.removeAllArrows();for(var i=0,len=columns.length;i<len;i++){var column=columns[i],sortedByColumn=utility.allMatch(settings.dataset.sorts,column.sorts,function(sorts,sort){return sort in sorts}),value=settings.dataset.sorts[column.sorts[0]];sortedByColumn&&obj.$element.find('[data-dynatable-column="'+column.id+'"]').find(".dynatable-sort-header").each(function(){1==value?obj.sortsHeaders.appendArrowUp($(this)):obj.sortsHeaders.appendArrowDown($(this))})}}if(settings.inputs.queries||settings.features.search){var allQueries=settings.inputs.queries||$();settings.features.search&&(allQueries=allQueries.add("#dynatable-query-search-"+obj.element.id)),allQueries.each(function(){var $this=$(this),q=settings.dataset.queries[$this.data("dynatable-query")];$this.val(q||"")})}obj.$element.find(settings.table.bodyRowSelector).remove(),obj.$element.append(rows),obj.$element.trigger("dynatable:afterUpdate",rows)}}function DomColumns(obj,settings){var _this=this;this.initOnLoad=function(){return obj.$element.is("table")},this.init=function(){settings.table.columns=[],this.getFromTable()},this.getFromTable=function(){var $columns=obj.$element.find(settings.table.headRowSelector).children("th,td");return $columns.length?void $columns.each(function(index){_this.add($(this),index,!0)}):$.error("Couldn't find any columns headers in '"+settings.table.headRowSelector+" th,td'. If your header row is different, specify the selector in the table: headRowSelector option.")},this.add=function($column,position,skipAppend,skipUpdate){var columns=settings.table.columns,label=$column.text(),id=$column.data("dynatable-column")||utility.normalizeText(label,settings.table.defaultColumnIdStyle),dataSorts=$column.data("dynatable-sorts"),sorts=dataSorts?$.map(dataSorts.split(","),function(text){return $.trim(text)}):[id];if(id||(this.generate($column),id=$column.data("dynatable-column")),columns.splice(position,0,{index:position,label:label,id:id,attributeWriter:settings.writers[id]||settings.writers._attributeWriter,attributeReader:settings.readers[id]||settings.readers._attributeReader,sorts:sorts,hidden:"none"===$column.css("display"),textAlign:$column.css("text-align")}),$column.attr("data-dynatable-column",id).addClass("dynatable-head"),settings.table.headRowClass&&$column.addClass(settings.table.headRowClass),!skipAppend){var domPosition=position+1,$sibling=obj.$element.find(settings.table.headRowSelector).children("th:nth-child("+domPosition+"),td:nth-child("+domPosition+")").first(),columnsAfter=columns.slice(position+1,columns.length);if($sibling.length?$sibling.before($column):obj.$element.find(settings.table.headRowSelector).append($column),obj.sortsHeaders.attachOne($column.get()),columnsAfter.length)for(var i=0,len=columnsAfter.length;i<len;i++)columnsAfter[i].index+=1;skipUpdate||obj.dom.update()}return dt},this.remove=function(columnIndexOrId){var columns=settings.table.columns;columns.length;if("number"==typeof columnIndexOrId){var column=columns[columnIndexOrId];this.removeFromTable(column.id),this.removeFromArray(columnIndexOrId)}else for(var i=columns.length-1;i>=0;i--){var column=columns[i];column.id===columnIndexOrId&&(this.removeFromTable(columnIndexOrId),this.removeFromArray(i))}obj.dom.update()},this.removeFromTable=function(columnId){obj.$element.find(settings.table.headRowSelector).children('[data-dynatable-column="'+columnId+'"]').first().remove()},this.removeFromArray=function(index){var adjustColumns,columns=settings.table.columns;columns.splice(index,1),adjustColumns=columns.slice(index,columns.length);for(var i=0,len=adjustColumns.length;i<len;i++)adjustColumns[i].index-=1},this.generate=function($cell){var cell=void 0===$cell?$("<th></th>"):$cell;return this.attachGeneratedAttributes(cell)},this.attachGeneratedAttributes=function($cell){var increment=obj.$element.find(settings.table.headRowSelector).children("th[data-dynatable-generated]").length;return $cell.attr("data-dynatable-column","dynatable-generated-"+increment).attr("data-dynatable-no-sort","true").attr("data-dynatable-generated",increment)}}function Records(obj,settings){this.initOnLoad=function(){return!settings.dataset.ajax},this.init=function(){null===settings.dataset.records&&(settings.dataset.records=this.getFromTable(),settings.dataset.queryRecordCount||(settings.dataset.queryRecordCount=this.count()),settings.dataset.totalRecordCount||(settings.dataset.totalRecordCount=settings.dataset.queryRecordCount)),settings.dataset.originalRecords=$.extend(!0,[],settings.dataset.records)},this.updateFromJson=function(data){var records;if("_root"===settings.params.records?records=data:settings.params.records in data&&(records=data[settings.params.records]),settings.params.record)for(var len=records.length-1,i=0;i<len;i++)records[i]=records[i][settings.params.record];settings.params.queryRecordCount in data&&(settings.dataset.queryRecordCount=data[settings.params.queryRecordCount]),settings.params.totalRecordCount in data&&(settings.dataset.totalRecordCount=data[settings.params.totalRecordCount]),settings.dataset.records=records},this.sort=function(){var sort=[].sort,sorts=settings.dataset.sorts,sortsKeys=settings.dataset.sortsKeys,sortTypes=settings.dataset.sortTypes,sortFunction=function(a,b){var comparison;if($.isEmptyObject(sorts))comparison=obj.sorts.functions.originalPlacement(a,b);else for(var i=0,len=sortsKeys.length;i<len;i++){var attr=sortsKeys[i],direction=sorts[attr],sortType=sortTypes[attr]||obj.sorts.guessType(a,b,attr);if(comparison=obj.sorts.functions[sortType](a,b,attr,direction),0!==comparison)break}return comparison};return sort.call(settings.dataset.records,sortFunction)},this.paginate=function(){var bounds=this.pageBounds(),first=bounds[0],last=bounds[1];settings.dataset.records=settings.dataset.records.slice(first,last)},this.resetOriginal=function(){settings.dataset.records=settings.dataset.originalRecords||[]},this.pageBounds=function(){var page=settings.dataset.page||1,first=(page-1)*settings.dataset.perPage,last=Math.min(first+settings.dataset.perPage,settings.dataset.queryRecordCount);return[first,last]},this.getFromTable=function(){var records=[],columns=settings.table.columns,tableRecords=obj.$element.find(settings.table.bodyRowSelector);return tableRecords.each(function(index){var record={};record["dynatable-original-index"]=index,$(this).find("th,td").each(function(index){void 0===columns[index]&&obj.domColumns.add(obj.domColumns.generate(),columns.length,!1,!0);var value=columns[index].attributeReader(this,record),attr=columns[index].id;"string"==typeof value&&value.match(/\s*\<.+\>/)&&(record["dynatable-sortable-text"]||(record["dynatable-sortable-text"]={}),record["dynatable-sortable-text"][attr]=$.trim($("<div></div>").html(value).text())),record[attr]=value}),"function"==typeof settings.readers._rowReader&&settings.readers._rowReader(index,this,record),records.push(record)}),records},this.count=function(){return settings.dataset.records.length}}function RecordsCount(obj,settings){this.initOnLoad=function(){return settings.features.recordCount},this.init=function(){this.attach()},this.create=function(){var recordsShown=obj.records.count(),recordsQueryCount=settings.dataset.queryRecordCount,recordsTotal=settings.dataset.totalRecordCount,text=settings.inputs.recordCountText,collection_name=settings.params.records;if(recordsShown<recordsQueryCount&&settings.features.paginate){var bounds=obj.records.pageBounds();text+="<span class='dynatable-record-bounds'>"+(bounds[0]+1)+" to "+bounds[1]+"</span> of "}else recordsShown===recordsQueryCount&&settings.features.paginate&&(text+=recordsShown+" of ");return text+=recordsQueryCount+" "+collection_name,recordsQueryCount<recordsTotal&&(text+=" (filtered from "+recordsTotal+" total records)"),$("<span></span>",{id:"dynatable-record-count-"+obj.element.id,"class":"dynatable-record-count",html:text})},this.attach=function(){var $target=settings.inputs.recordCountTarget?$(settings.inputs.recordCountTarget):obj.$element;$target[settings.inputs.recordCountPlacement](this.create())}}function ProcessingIndicator(obj,settings){this.init=function(){this.attach()},this.create=function(){var $processing=$("<div></div>",{html:"<span>"+settings.inputs.processingText+"</span>",id:"dynatable-processing-"+obj.element.id,"class":"dynatable-processing",style:"position: absolute; display: none;"});return $processing},this.position=function(){var $processing=$("#dynatable-processing-"+obj.element.id),$span=$processing.children("span"),spanHeight=$span.outerHeight(),spanWidth=$span.outerWidth(),$covered=obj.$element,offset=$covered.offset(),height=$covered.outerHeight(),width=$covered.outerWidth();return $processing.offset({left:offset.left,top:offset.top}).width(width).height(height),$span.offset({left:offset.left+(width-spanWidth)/2,top:offset.top+(height-spanHeight)/2}),$processing},this.attach=function(){obj.$element.before(this.create())},this.show=function(){$("#dynatable-processing-"+obj.element.id).show(),this.position()},this.hide=function(){$("#dynatable-processing-"+obj.element.id).hide()}}function State(obj,settings){this.initOnLoad=function(){return settings.features.pushState&&history.pushState},this.init=function(){window.onpopstate=function(event){event.state&&event.state.dynatable&&obj.state.pop(event)}},this.push=function(data){var urlOptions,path,params,hash,cacheStr,cache,urlString=window.location.search,firstPush=!(window.history.state&&window.history.state.dynatable),pushFunction=firstPush?"replaceState":"pushState";urlString&&/^\?/.test(urlString)&&(urlString=urlString.substring(1)),$.extend(urlOptions,data),params=utility.refreshQueryString(urlString,data,settings),params&&(params="?"+params),hash=window.location.hash,path=window.location.pathname,obj.$element.trigger("dynatable:push",data),cache={dynatable:{dataset:settings.dataset}},firstPush||(cache.dynatable.scrollTop=$(window).scrollTop()),cacheStr=JSON.stringify(cache),cache.dynatable.dataset.perPageOptions=$.makeArray(cache.dynatable.dataset.perPageOptions);try{window.history[pushFunction](cache,"Dynatable state",path+params+hash)}catch(error){cache.dynatable.dataset.records=null,window.history[pushFunction](cache,"Dynatable state",path+params+hash)}},this.pop=function(event){var data=event.state.dynatable;settings.dataset=data.dataset,data.scrollTop&&$(window).scrollTop(data.scrollTop),data.dataset.records?obj.dom.update():obj.process(!0)}}function Sorts(obj,settings){this.initOnLoad=function(){return settings.features.sort},this.init=function(){var sortsUrl=window.location.search.match(new RegExp(settings.params.sorts+"[^&=]*=[^&]*","g"));settings.dataset.sorts=sortsUrl?utility.deserialize(sortsUrl)[settings.params.sorts]:{},settings.dataset.sortsKeys=sortsUrl?utility.keysFromObject(settings.dataset.sorts):[]},this.add=function(attr,direction){var sortsKeys=settings.dataset.sortsKeys,index=$.inArray(attr,sortsKeys);return settings.dataset.sorts[attr]=direction,index===-1&&sortsKeys.push(attr),dt},this.remove=function(attr){var sortsKeys=settings.dataset.sortsKeys,index=$.inArray(attr,sortsKeys);return delete settings.dataset.sorts[attr],index!==-1&&sortsKeys.splice(index,1),dt},this.clear=function(){settings.dataset.sorts={},settings.dataset.sortsKeys.length=0},this.guessType=function(a,b,attr){var types={string:"string",number:"number","boolean":"number",object:"number"},attrType=a[attr]?typeof a[attr]:typeof b[attr],type=types[attrType]||"number";return type},this.functions={number:function(a,b,attr,direction){return a[attr]===b[attr]?0:direction>0?a[attr]-b[attr]:b[attr]-a[attr]},string:function(a,b,attr,direction){var comparison,aAttr=a["dynatable-sortable-text"]&&a["dynatable-sortable-text"][attr]?a["dynatable-sortable-text"][attr]:a[attr],bAttr=b["dynatable-sortable-text"]&&b["dynatable-sortable-text"][attr]?b["dynatable-sortable-text"][attr]:b[attr];return aAttr=aAttr.toLowerCase(),bAttr=bAttr.toLowerCase(),comparison=aAttr===bAttr?0:direction>0?aAttr>bAttr:bAttr>aAttr,comparison===!1?-1:comparison-0},originalPlacement:function(a,b){return a["dynatable-original-index"]-b["dynatable-original-index"]}}}function SortsHeaders(obj,settings){var _this=this;this.initOnLoad=function(){return settings.features.sort},this.init=function(){this.attach()},this.create=function(cell){var $cell=$(cell),$link=$("<a></a>",{"class":"dynatable-sort-header",href:"#",html:$cell.html()}),id=$cell.data("dynatable-column"),column=utility.findObjectInArray(settings.table.columns,{id:id});return $link.bind("click",function(e){_this.toggleSort(e,$link,column),obj.process(),e.preventDefault()}),this.sortedByColumn($link,column)&&(1==this.sortedByColumnValue(column)?this.appendArrowUp($link):this.appendArrowDown($link)),$link},this.removeAll=function(){obj.$element.find(settings.table.headRowSelector).children("th,td").each(function(){_this.removeAllArrows(),_this.removeOne(this)})},this.removeOne=function(cell){var $cell=$(cell),$link=$cell.find(".dynatable-sort-header");if($link.length){var html=$link.html();$link.remove(),$cell.html($cell.html()+html)}},this.attach=function(){obj.$element.find(settings.table.headRowSelector).children("th,td").each(function(){_this.attachOne(this)})},this.attachOne=function(cell){var $cell=$(cell);$cell.data("dynatable-no-sort")||$cell.html(this.create(cell))},this.appendArrowUp=function($link){this.removeArrow($link),$link.append("<span class='dynatable-arrow'> &#9650;</span>")},this.appendArrowDown=function($link){this.removeArrow($link),$link.append("<span class='dynatable-arrow'> &#9660;</span>")},this.removeArrow=function($link){$link.find(".dynatable-arrow").remove()},this.removeAllArrows=function(){obj.$element.find(".dynatable-arrow").remove()},this.toggleSort=function(e,$link,column){var sortedByColumn=this.sortedByColumn($link,column),value=this.sortedByColumnValue(column);if(settings.inputs.multisort&&utility.anyMatch(e,settings.inputs.multisort,function(evt,key){return e[key]})||(this.removeAllArrows(),obj.sorts.clear()),sortedByColumn)if(1==value){for(var i=0,len=column.sorts.length;i<len;i++)obj.sorts.add(column.sorts[i],-1);this.appendArrowDown($link)}else{for(var i=0,len=column.sorts.length;i<len;i++)obj.sorts.remove(column.sorts[i]);this.removeArrow($link)}else{for(var i=0,len=column.sorts.length;i<len;i++)obj.sorts.add(column.sorts[i],1);this.appendArrowUp($link)}},this.sortedByColumn=function($link,column){return utility.allMatch(settings.dataset.sorts,column.sorts,function(sorts,sort){return sort in sorts})},this.sortedByColumnValue=function(column){return settings.dataset.sorts[column.sorts[0]]}}function Queries(obj,settings){var _this=this;this.initOnLoad=function(){return settings.inputs.queries||settings.features.search},this.init=function(){var queriesUrl=window.location.search.match(new RegExp(settings.params.queries+"[^&=]*=[^&]*","g"));settings.dataset.queries=queriesUrl?utility.deserialize(queriesUrl)[settings.params.queries]:{},""===settings.dataset.queries&&(settings.dataset.queries={}),settings.inputs.queries&&this.setupInputs()},this.add=function(name,value){return settings.features.paginate&&(settings.dataset.page=1),settings.dataset.queries[name]=value,dt},this.remove=function(name){return delete settings.dataset.queries[name],dt},this.run=function(){for(query in settings.dataset.queries)if(settings.dataset.queries.hasOwnProperty(query)){var value=settings.dataset.queries[query];if(void 0===_this.functions[query]){var queryColumn=utility.findObjectInArray(settings.table.columns,{id:query});if(!queryColumn){$.error("Query named '"+query+"' called, but not defined in queries.functions");continue}_this.functions[query]=function(record,queryValue){return record[query]==queryValue}}settings.dataset.records=$.map(settings.dataset.records,function(record){return _this.functions[query](record,value)?record:null})}settings.dataset.queryRecordCount=obj.records.count()},this.runSearch=function(q){var origQueries=$.extend({},settings.dataset.queries);q?this.add("search",q):this.remove("search"),utility.objectsEqual(settings.dataset.queries,origQueries)||obj.process()},this.setupInputs=function(){settings.inputs.queries.each(function(){var $this=$(this),event=$this.data("dynatable-query-event")||settings.inputs.queryEvent,query=$this.data("dynatable-query")||$this.attr("name")||this.id,queryFunction=function(e){var q=$(this).val();return""===q&&(q=void 0),q!==settings.dataset.queries[query]&&(q?_this.add(query,q):_this.remove(query),obj.process(),void e.preventDefault())};$this.attr("data-dynatable-query",query).bind(event,queryFunction).bind("keypress",function(e){13==e.which&&queryFunction.call(this,e)}),settings.dataset.queries[query]&&$this.val(decodeURIComponent(settings.dataset.queries[query]))})},this.functions={search:function(record,queryValue){var contains=!1;for(attr in record)if(record.hasOwnProperty(attr)){var attrValue=record[attr];if("string"==typeof attrValue&&attrValue.toLowerCase().indexOf(queryValue.toLowerCase())!==-1){contains=!0;break}}else;return contains}}}function InputsSearch(obj,settings){this.initOnLoad=function(){return settings.features.search},this.init=function(){this.attach()},this.create=function(){var $search=$("<input />",{type:"search",id:"dynatable-query-search-"+obj.element.id,"data-dynatable-query":"search",value:settings.dataset.queries.search}),$searchSpan=$("<span></span>",{id:"dynatable-search-"+obj.element.id,"class":"dynatable-search",text:"Search: "}).append($search);return $search.bind(settings.inputs.queryEvent,function(){obj.queries.runSearch($(this).val())}).bind("keypress",function(e){13==e.which&&(obj.queries.runSearch($(this).val()),e.preventDefault())}),$searchSpan},this.attach=function(){var $target=settings.inputs.searchTarget?$(settings.inputs.searchTarget):obj.$element;$target[settings.inputs.searchPlacement](this.create())}}function PaginationPage(obj,settings){this.initOnLoad=function(){return settings.features.paginate},this.init=function(){var pageUrl=window.location.search.match(new RegExp(settings.params.page+"=([^&]*)"));pageUrl&&settings.features.pushState?this.set(pageUrl[1]):this.set(1)},this.set=function(page){settings.dataset.page=parseInt(page,10)}}function PaginationPerPage(obj,settings){var _this=this;this.initOnLoad=function(){return settings.features.paginate},this.init=function(){var perPageUrl=window.location.search.match(new RegExp(settings.params.perPage+"=([^&]*)"));perPageUrl&&settings.features.pushState?this.set(perPageUrl[1],!0):this.set(settings.dataset.perPageDefault,!0),settings.features.perPageSelect&&this.attach()},this.create=function(){for(var $select=$("<select>",{id:"dynatable-per-page-"+obj.element.id,"class":"dynatable-per-page-select"}),i=0,len=settings.dataset.perPageOptions.length;i<len;i++){var number=settings.dataset.perPageOptions[i],selected=settings.dataset.perPage==number?'selected="selected"':"";$select.append('<option value="'+number+'" '+selected+">"+number+"</option>")}return $select.bind("change",function(e){_this.set($(this).val()),obj.process()}),$("<span />",{"class":"dynatable-per-page"}).append("<span class='dynatable-per-page-label'>"+settings.inputs.perPageText+"</span>").append($select)},this.attach=function(){var $target=settings.inputs.perPageTarget?$(settings.inputs.perPageTarget):obj.$element;$target[settings.inputs.perPagePlacement](this.create())},this.set=function(number,skipResetPage){skipResetPage||obj.paginationPage.set(1),settings.dataset.perPage=parseInt(number)}}function PaginationLinks(obj,settings){this.initOnLoad=function(){return settings.features.paginate},this.init=function(){this.attach()},this.create=function(){var pageLinks='<ul id="dynatable-pagination-links-'+obj.element.id+'" class="'+settings.inputs.paginationClass+'">',pageLinkClass=settings.inputs.paginationLinkClass,activePageClass=settings.inputs.paginationActiveClass,disabledPageClass=settings.inputs.paginationDisabledClass,pages=Math.ceil(settings.dataset.queryRecordCount/settings.dataset.perPage),page=settings.dataset.page,breaks=[settings.inputs.paginationGap[0],settings.dataset.page-settings.inputs.paginationGap[1],settings.dataset.page+settings.inputs.paginationGap[2],pages+1-settings.inputs.paginationGap[3]];pageLinks+="<li><span>Pages: </span></li>";for(var i=1;i<=pages;i++)if(!(i>breaks[0]&&i<breaks[1]||i>breaks[2]&&i<breaks[3])){var breakIndex,nextBreak,li=obj.paginationLinks.buildLink(i,i,pageLinkClass,page==i,activePageClass);if(breakIndex=$.inArray(i,breaks),nextBreak=breaks[breakIndex+1],breakIndex>0&&1!==i&&nextBreak&&nextBreak>i+1){var ellip='<li><span class="dynatable-page-break">&hellip;</span></li>';li=breakIndex<2?ellip+li:li+ellip}if(settings.inputs.paginationPrev&&1===i){var prevLi=obj.paginationLinks.buildLink(page-1,settings.inputs.paginationPrev,pageLinkClass+" "+settings.inputs.paginationPrevClass,1===page,disabledPageClass);li=prevLi+li}if(settings.inputs.paginationNext&&i===pages){var nextLi=obj.paginationLinks.buildLink(page+1,settings.inputs.paginationNext,pageLinkClass+" "+settings.inputs.paginationNextClass,page===pages,disabledPageClass);li+=nextLi}pageLinks+=li}pageLinks+="</ul>";var selector="#dynatable-pagination-links-"+obj.element.id+" a."+pageLinkClass+":not(."+activePageClass+",."+disabledPageClass+")";return $(document).undelegate(selector,"click.dynatable"),$(document).delegate(selector,"click.dynatable",function(e){$this=$(this),$this.closest(settings.inputs.paginationClass).find("."+activePageClass).removeClass(activePageClass),$this.addClass(activePageClass),obj.paginationPage.set($this.data("dynatable-page")),obj.process(),e.preventDefault()}),pageLinks},this.buildLink=function(page,label,linkClass,conditional,conditionalClass){var link="<a data-dynatable-page="+page+' class="'+linkClass,li="<li";return conditional&&(link+=" "+conditionalClass,li+=' class="'+conditionalClass+'"'),link+='">'+label+"</a>",li+=">"+link+"</li>"},this.attach=function(){var $target=settings.inputs.paginationLinkTarget?$(settings.inputs.paginationLinkTarget):obj.$element;$target[settings.inputs.paginationLinkPlacement](obj.paginationLinks.create())}}var defaults,mergeSettings,dt,Model,utility,build,processAll,defaultRowWriter,defaultCellWriter,defaultAttributeWriter,defaultAttributeReader,modelPrototypes={dom:Dom,domColumns:DomColumns,records:Records,recordsCount:RecordsCount,processingIndicator:ProcessingIndicator,state:State,sorts:Sorts,sortsHeaders:SortsHeaders,queries:Queries,inputsSearch:InputsSearch,paginationPage:PaginationPage,paginationPerPage:PaginationPerPage,paginationLinks:PaginationLinks};defaults={features:{paginate:!0,sort:!0,pushState:!0,search:!0,recordCount:!0,perPageSelect:!0},table:{defaultColumnIdStyle:"camelCase",columns:null,headRowSelector:"thead tr",bodyRowSelector:"tbody tr",headRowClass:null},inputs:{queries:null,sorts:null,multisort:["ctrlKey","shiftKey","metaKey"],page:null,queryEvent:"blur change",recordCountTarget:null,recordCountPlacement:"after",paginationLinkTarget:null,paginationLinkPlacement:"after",paginationClass:"dynatable-pagination-links",paginationLinkClass:"dynatable-page-link",paginationPrevClass:"dynatable-page-prev",paginationNextClass:"dynatable-page-next",paginationActiveClass:"dynatable-active-page",paginationDisabledClass:"dynatable-disabled-page",paginationPrev:"Previous",paginationNext:"Next",paginationGap:[1,2,2,1],searchTarget:null,searchPlacement:"before",perPageTarget:null,perPagePlacement:"before",perPageText:"Show: ",recordCountText:"Showing ",processingText:"Processing..."},dataset:{ajax:!1,ajaxUrl:null,ajaxCache:null,ajaxOnLoad:!1,ajaxMethod:"GET",ajaxDataType:"json",totalRecordCount:null,queries:{},queryRecordCount:null,page:null,perPageDefault:10,perPageOptions:[10,20,50,100],sorts:{},sortsKeys:null,sortTypes:{},records:null},writers:{_rowWriter:defaultRowWriter,_cellWriter:defaultCellWriter,_attributeWriter:defaultAttributeWriter},readers:{_rowReader:null,_attributeReader:defaultAttributeReader},params:{dynatable:"dynatable",queries:"queries",sorts:"sorts",page:"page",perPage:"perPage",offset:"offset",records:"records",record:null,queryRecordCount:"queryRecordCount",totalRecordCount:"totalRecordCount"}},dt={init:function(element,options){return this.settings=mergeSettings(options),this.element=element,this.$element=$(element),build.call(this),this},process:function(skipPushState){processAll.call(this,skipPushState)}},mergeSettings=function(options){var newOptions=$.extend(!0,{},defaults,options);return options&&(options.inputs&&(options.inputs.multisort&&(newOptions.inputs.multisort=options.inputs.multisort),options.inputs.paginationGap&&(newOptions.inputs.paginationGap=options.inputs.paginationGap)),options.dataset&&options.dataset.perPageOptions&&(newOptions.dataset.perPageOptions=options.dataset.perPageOptions)),newOptions},build=function(){this.$element.trigger("dynatable:preinit",this);for(model in modelPrototypes)if(modelPrototypes.hasOwnProperty(model)){var modelInstance=this[model]=new modelPrototypes[model](this,this.settings);modelInstance.initOnLoad()&&modelInstance.init()}this.$element.trigger("dynatable:init",this),(!this.settings.dataset.ajax||this.settings.dataset.ajax&&this.settings.dataset.ajaxOnLoad||this.settings.features.paginate)&&this.process()},processAll=function(skipPushState){var data={};if(this.$element.trigger("dynatable:beforeProcess",data),$.isEmptyObject(this.settings.dataset.queries)||(data[this.settings.params.queries]=this.settings.dataset.queries),this.processingIndicator.show(),this.settings.features.sort&&!$.isEmptyObject(this.settings.dataset.sorts)&&(data[this.settings.params.sorts]=this.settings.dataset.sorts),this.settings.features.paginate&&this.settings.dataset.page){var page=this.settings.dataset.page,perPage=this.settings.dataset.perPage;data[this.settings.params.page]=page,data[this.settings.params.perPage]=perPage,data[this.settings.params.offset]=(page-1)*perPage}if(this.settings.dataset.ajaxData&&$.extend(data,this.settings.dataset.ajaxData),this.settings.dataset.ajax){var _this=this,options={type:_this.settings.dataset.ajaxMethod,dataType:_this.settings.dataset.ajaxDataType,data:data,error:function(xhr,error){},success:function(response){_this.$element.trigger("dynatable:ajax:success",response),_this.records.updateFromJson(response),_this.dom.update(),!skipPushState&&_this.state.initOnLoad()&&_this.state.push(data)},complete:function(){_this.processingIndicator.hide()}};this.settings.dataset.ajaxUrl?options.url=this.settings.dataset.ajaxUrl:options.url=utility.refreshQueryString(window.location.href,{},this.settings),null!==this.settings.dataset.ajaxCache&&(options.cache=this.settings.dataset.ajaxCache),$.ajax(options)}else this.records.resetOriginal(),this.queries.run(),this.settings.features.sort&&this.records.sort(),this.settings.features.paginate&&this.records.paginate(),this.dom.update(),this.processingIndicator.hide(),!skipPushState&&this.state.initOnLoad()&&this.state.push(data);this.$element.trigger("dynatable:afterProcess",data)},Model={initOnLoad:function(){return!0},init:function(){}};for(model in modelPrototypes)if(modelPrototypes.hasOwnProperty(model)){var modelPrototype=modelPrototypes[model];modelPrototype.prototype=Model}utility=dt.utility={normalizeText:function(text,style){return text=this.textTransform[style](text)},textTransform:{trimDash:function(text){return text.replace(/^\s+|\s+$/g,"").replace(/\s+/g,"-")},camelCase:function(text){return text=this.trimDash(text),text.replace(/(\-[a-zA-Z])/g,function($1){return $1.toUpperCase().replace("-","")}).replace(/([A-Z])([A-Z]+)/g,function($1,$2,$3){return $2+$3.toLowerCase()}).replace(/^[A-Z]/,function($1){return $1.toLowerCase()})},dashed:function(text){return text=this.trimDash(text),this.lowercase(text)},underscore:function(text){return text=this.trimDash(text),this.lowercase(text.replace(/(-)/g,"_"))},lowercase:function(text){return text.replace(/([A-Z])/g,function($1){return $1.toLowerCase()})}},deserialize:function(query){if(!query)return{};"object"==typeof query&&(query=query.join("&"));for(var hash={},vars=query.split("&"),i=0;i<vars.length;i++){var v,m,pair=vars[i].split("="),k=decodeURIComponent(pair[0]);if(pair[1]){for(v=decodeURIComponent(pair[1].replace(/\+/g," "));m=k.match(/([^&=]+)\[([^&=]+)\]$/);){var origV=v;k=m[1],v={},"]["==m[2].substr(m[2].length-2)?v[m[2].substr(0,m[2].length-2)]=[origV]:v[m[2]]=origV}"undefined"==typeof hash[k]?"[]"!=k.substr(k.length-2)?hash[k]=v:hash[k]=[v]:"string"==typeof hash[k]?hash[k]=v:"object"==typeof hash[k]?hash[k]=$.extend({},hash[k],v):hash[k].push(v)}}return hash},refreshQueryString:function(urlString,data,settings){var urlOptions,_this=this,queryString=urlString.split("?");queryString.shift();urlOptions=this.deserialize(urlString);for(attr in settings.params)if(settings.params.hasOwnProperty(attr)){var label=settings.params[attr];if(!settings.features.sort&&"sorts"==attr||!settings.features.paginate&&_this.anyMatch(attr,["page","perPage","offset"],function(attr,param){return attr==param}))continue;if(("page"===attr||"offset"===attr)&&1===data.page){urlOptions[label]&&delete urlOptions[label];continue}if("perPage"===attr&&data[label]==settings.dataset.perPageDefault){urlOptions[label]&&delete urlOptions[label];continue}if("queries"==attr&&data[label]){var queries=settings.inputs.queries||[],inputQueries=$.makeArray(queries.map(function(){return $(this).attr("name")}));settings.features.search&&inputQueries.push("search");for(var i=0,len=inputQueries.length;i<len;i++){var attr=inputQueries[i];data[label][attr]?("undefined"==typeof urlOptions[label]&&(urlOptions[label]={}),urlOptions[label][attr]=data[label][attr]):delete urlOptions[label][attr]}continue}data[label]?urlOptions[label]=data[label]:delete urlOptions[label]}return decodeURI($.param(urlOptions))},keysFromObject:function(obj){var keys=[];for(var key in obj)keys.push(key);return keys},findObjectInArray:function(array,objectAttr){for(var foundObject,_this=this,i=0,len=array.length;i<len;i++){var item=array[i];if(_this.allMatch(item,objectAttr,function(item,key,value){return item[key]==value})){foundObject=item;break}}return foundObject},allMatch:function(item,arrayOrObject,test){var match=!0,isArray=$.isArray(arrayOrObject);return $.each(arrayOrObject,function(key,value){var result=isArray?test(item,value):test(item,key,value);if(!result)return match=!1}),match},anyMatch:function(item,arrayOrObject,test){var match=!1,isArray=$.isArray(arrayOrObject);return $.each(arrayOrObject,function(key,value){var result=isArray?test(item,value):test(item,key,value);if(result)return match=!0,!1}),match},objectsEqual:function(a,b){for(attr in a)if(a.hasOwnProperty(attr)&&(!b.hasOwnProperty(attr)||a[attr]!==b[attr]))return!1;
for(attr in b)if(b.hasOwnProperty(attr)&&!a.hasOwnProperty(attr))return!1;return!0},randomHash:function(){return(65536*(1+Math.random())|0).toString(16).substring(1)}},"function"!=typeof Object.create&&(Object.create=function(o){function F(){}return F.prototype=o,new F}),$.dynatableSetup=function(options){defaults=mergeSettings(options)},$.dynatable=function(object){$.fn.dynatable=function(options){return this.each(function(){$.data(this,"dynatable")||$.data(this,"dynatable",Object.create(object).init(this,options))})}},$.dynatable(dt)}(jQuery),function(window,document,oGlobalSettings,FrontendTools,FrontendCore,$){"use strict";FrontendCore.define("table-dynamic",[],function(){return{oTable:[],oDefault:{features:{paginate:!0,sort:!0,pushState:!0,search:!0,recordCount:!0,perPageSelect:!0},inputs:{queries:null,sorts:null,multisort:["ctrlKey","shiftKey","metaKey"],page:null,queryEvent:"blur change",recordCountTarget:null,recordCountPlacement:"after",paginationLinkTarget:null,paginationLinkPlacement:"after",paginationClass:"pagination dynatable-pagination",paginationLinkClass:"dynatable-page-link",paginationPrevClass:"dynatable-page-prev",paginationNextClass:"dynatable-page-next",paginationActiveClass:"dynatable-active-page",paginationDisabledClass:"dynatable-disabled-page",paginationPrev:'<i class="icon-step-backward"></i>',paginationNext:'<i class="icon-step-forward"></i>',paginationGap:[1,2,2,1],searchTarget:null,searchPlacement:"before",perPageTarget:null,perPagePlacement:"before",perPageText:'<i class="icon-table"></i> ',recordCountText:"",processingText:"Processing..."},params:{dynatable:"table",queries:"queries",sorts:"sorts",page:"",perPage:"perPage",offset:"offset",records:"",record:null,queryRecordCount:"queryRecordCount",totalRecordCount:"totalRecordCount"}},wrap:function(oTarget){$(oTarget).wrap('<div class="table-dynamic-wrapper"></div>')},onStart:function(){var aTargets=FrontendTools.getDataModules("table-dynamic"),self=this;FrontendTools.loadCSS(oGlobalSettings.sPathCss+"secondary.css?v="+oGlobalSettings.sHash),FrontendTools.trackModule("JS_Libraries","call","table-dynamic"),$(aTargets).each(function(nIndex){self.wrap(this),self.autobind(this,nIndex)})},autobind:function(oTarget,nIndex){var self=this,$Target=$(oTarget),sClass="";"false"===oTarget.getAttribute("data-fc-pagination")&&(self.oDefault.features.paginate=!1,self.oDefault.features.perPageSelect=!1,self.oDefault.features.recordCount=!1),"false"===oTarget.getAttribute("data-fc-sort")&&(self.oDefault.features.sort=!1),"false"===oTarget.getAttribute("data-fc-search")&&(self.oDefault.features.search=!1),(self.oDefault.features.search||self.oDefault.features.paginate)&&(sClass="table-dynamic"),$Target.addClass(sClass),FrontendTools.removeLoading(oTarget),self.oTable[nIndex]=$Target.dynatable(self.oDefault),$("input",".dynatable-search").keyup(function(){$(this).blur().focus()})},onStop:function(){this.sPathCss=null,this.oDefault=null},onDestroy:function(){delete this.sPathCss,delete this.oDefault}}})}(window,document,oGlobalSettings,FrontendTools,FrontendCore,$);