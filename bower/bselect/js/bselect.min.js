(function(e,t){"use strict";function s(t){return e.isPlainObject(e(t).data(h))}function i(e,s){return f[s]!==t?f[s].apply(e,u.call(arguments,2)):e}function n(t){return i(t,"option","placeholder")||t.data("placeholder")||e.bselect.i18n.selectAnOption}function a(e){var t=e.find(".bselect-option-list"),s=t.find("li:visible").length;t.innerHeight(1.5*parseInt(t.css("line-height"),10)*(5>s?s:5))}function l(t,s,n){var a=i(t,"element");e.each(s,function(t,s){if(n[t]!==s&&"size"===t){var i=e.map(b.slice(0),function(e){return"bselect-"+e}).join(" ");a.removeClass(i),b.indexOf(n.size)>-1&&a.addClass("bselect-"+n.size)}})}function o(t){var s=i(t,"element");s.find(".bselect-message").text(e.bselect.i18n.noOptionsAvailable).show()}function r(t){if(38===t.keyCode||40===t.keyCode||13===t.keyCode){var s=e(this),i=s.is(".bselect-search-input");switch(t.keyCode){case 38:i?e(t.delegateTarget).find(".bselect-option:visible:last").focus():s.prevAll(".bselect-option:visible").eq(0).focus();break;case 40:i?e(t.delegateTarget).find(".bselect-option:visible:first").focus():s.nextAll(".bselect-option:visible").eq(0).focus();break;case 13:i||s.trigger("click")}return!1}}function c(s,a){var o,c,b,u,v,g=e(s);if(u=++d,b=e("<div class='bselect' />",{id:"bselect-"+u}),v=e("<div class='bselect-dropdown' />"),a.searchInput===!0){var m=e("<div class='bselect-search' />");e("<input type='text' class='bselect-search-input' />").attr({role:"combobox",tabindex:1,"aria-expanded":"false","aria-owns":"bselect-option-list-"+u}).appendTo(m),e("<span class='bselect-search-icon' />").append("<i class='icon-search'></i>").appendTo(m),m.appendTo(v)}e("<div class='bselect-message' role='status' />").appendTo(v),e("<ul class='bselect-option-list' />").attr({id:"bselect-option-list-"+u,role:"listbox"}).appendTo(v),b.append(v).insertAfter(g),g.data(h,{options:a,element:b,open:!1}),l(g,e.bselect.defaults,a),i(g,"refresh"),g.bind("bselectselect.bselect",a.select),g.bind("bselectselected.bselect",a.selected),g.bind("bselectsearch.bselect",a.search),c=e("<span />").addClass("bselect-label").text(n(g)),o=e("<button type='button' />").addClass("bselect-caret").html("<span class='caret'></span>"),b.prepend(o).prepend(c),c.outerWidth(g.outerWidth()-o.outerWidth()),g.addClass("bselect-inaccessible"),p.push(g),b.find(".bselect-search-input").keyup(e.proxy(f.search,g)),b.on("click",".bselect-option",e.proxy(f.select,g)),b.on("click",".bselect-caret, .bselect-label",e.proxy(f.toggle,g)),b.on("keydown",".bselect-option, .bselect-search-input",r),g.bind("change.bselect",function(){var e=g.data(h),s=e.itemsMap[this.value];return e.tempDisable?(e.tempDisable=!1,t):(i(g,"select",s),t)}).trigger("change.bselect")}var d=0,h="bselect",p=[],b=["mini","small","large"],u=Array.prototype.slice,f={option:function(s,i){var n=this.data(h).options||{},a=e.extend({},n);return"string"==typeof s&&"_"!==s[0]?i===t?n[s]:(n[s]=i,l(this,a,n),this):(e.isPlainObject(s)&&(e.extend(n,s),l(this,a,n),this.data(h).options=n),n)},element:function(){return this.data(h).element},toggle:function(t){if(this[0].disabled)return this;var s=i(this,"element");if(t instanceof e.Event){var n=i(this,"option","showOn");if(e(t.target).is(".bselect-label")&&"both"!==n)return this}return s.find(".bselect-dropdown").is(":hidden")?i(this,"show"):i(this,"hide"),this},show:function(){var t,s,n,l,o,r=this.data(h);if(this[0].disabled||r.open)return this;if(n=r.element,l=n.find(".bselect-dropdown"),l.css("left","-9999em").show(),a(n),s=n.find(".bselect-option.active"),s.length){var c=n.find(".bselect-option-list"),d=s.position().top,p=c.position().top;c.height()>d-p?c.scrollTop(0):c.scrollTop(d-p)}return l.hide().css("left","auto"),l.slideDown(i(this,"option","animationDuration")),this.data(h,e.extend(r,{open:!0})),n.addClass("open"),t=n.find(".bselect-search-input").focus(),o=t.parent().width()-t.next().outerWidth(),t.innerWidth(o),n.find(".bselect-search-input").attr("aria-expanded","true"),this},hide:function(s){var n=this.data(h);if(this[0].disabled||!n.open)return this;var a=n.options,l=n.element;return s=s===t?!0:s,this.data(h,e.extend(n,{open:!1})),l.find(".bselect-dropdown").slideUp(a.animationDuration),l.removeClass("open"),s&&a.clearSearchOnExit&&i(this,"clearSearch"),l.find(".bselect-search-input").attr("aria-expanded","false"),this},select:function(t){var s,n,a=i(this,"element");if(t instanceof e.Event)s=e(t.currentTarget);else if(s=a.find("li").eq(t),!s.length)return this;var l=a.find("li").removeClass("active").attr("aria-selected","false").index(s),o=this.find("option[value!='']").get(l);return this.trigger("bselectselect",[o]),n=s.addClass("active").data("value"),s.attr("aria-selected","true"),a.find(".bselect-label").text(s.text()),i(this,"hide"),this.data(h).tempDisable=!0,this.val(n).trigger("change"),this.trigger("bselectselected",[n,o]),this},search:function(t){var s,n,l,r,c,d=i(this,"option"),h=t instanceof e.Event?t.target.value:t,p=i(this,"element");if(this[0].disabled)return this;if(""===h&&i(this,"clearSearch"),t instanceof e.Event||p.find(".bselect-search").val(h),!(h===d.lastSearch||h.length<d.minSearchInput)){for(c=e(),s=p.find("li").hide(),l=0,r=s.length;r>l;l++)n=s[l],n.textContent.toLowerCase().indexOf(h.toLowerCase())>-1&&(c=c.add(e(n).show()));return 0===c.length?o(this):p.find(".bselect-message").hide(),this.trigger("bselectsearch",[h,c]),a(s.end()),this}},clearSearch:function(){var e=i(this,"element");return e.find(".bselect-search-input").val(""),e.find("li").show(),e.find(".bselect-message").hide(),a(e),this},disable:function(){return this[0].disabled||(i(this,"element").addClass("disabled"),this.prop("disabled",!0)),this},enable:function(){return this[0].disabled&&(i(this,"element").removeClass("disabled"),this.prop("disabled",!1)),this},refresh:function(){var t=i(this,"element"),s=t.find(".bselect-option-list").empty(),n={},a=0;return t.toggleClass("disabled",this.prop("disabled")),this.find("option, > optgroup").each(function(){var t,i,l=e(this).is("option");(!l||this.value)&&(l?(t="bselect-option",e(this).closest("optgroup").length&&(t+=" grouped")):t="bselect-option-group",i=e("<li />").attr({"class":t,role:"option",tabindex:l?2:-1,"aria-selected":"false"}),l?(i.data("value",this.value),n[this.value]=a,i.html("<a href='#'>"+this.text+"</a>")):i.text(this.label),i.appendTo(s),a++)}),0===a&&o(this),this.data(h).itemsMap=n,this},destroy:function(){var e=i(this,"element");return this.data(h,null),p.splice(p.indexOf(this),1),e.remove(),this.removeClass("bselect-inaccessible").unbind(".bselect"),this}};e.fn.bselect=function(i){return"string"==typeof i&&this[0]?s(this[0])&&f[i]!==t?f[i].apply(e(this[0]),u.call(arguments,1)):this:this.each(function(){s(this)||(i=e.isPlainObject(i)?i:{},i=e.extend({},e.bselect.defaults,i),c(this,i))})},e.bselect={defaults:{size:"normal",showOn:"both",clearSearchOnExit:!0,minSearchInput:0,animationDuration:300,searchInput:!0,search:null,select:null,selected:null},i18n:{selectAnOption:"Select an option",noOptionsAvailable:"No options available."}},e(document).on("click.bselect","label",function(t){var s,n,a;for(s=0,n=p.length;n>s;s++)if(a=p[s][0].id,a&&e(t.target).attr("for")===a)return i(p[s],"show"),!1}).on("click.bselect",function(e){var t,s,n;for(t=0,s=p.length;s>t;t++)n=p[t].data(h),n.open&&!n.element.has(e.target).length&&i(p[t],"hide")}),e(window).resize(function(){var e,t,s,i;for(e=0,t=p.length;t>e;e++)s=p[e].data(h),i=s.element.find(".bselect-caret"),s.element.find(".bselect-label").outerWidth(p[e].outerWidth()-i.outerWidth())})})(jQuery);